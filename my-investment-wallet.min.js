!function(e){var t={};function o(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){const n=React.createElement,{HashRouter:a,NavLink:r,Route:l,Switch:i,useLocation:c,useParams:s,useHistory:u}=window.ReactRouterDOM,{AppBar:d,Box:p,Button:m,createMuiTheme:v,Chip:h,Divider:y,Drawer:f,Icon:g,IconButton:b,Grid:C,ListItem:R,ListItemText:w,Menu:x,MenuItem:k,Paper:S,Snackbar:P,Table:T,TableBody:_,TableCell:A,TableContainer:B,TableHead:I,TableRow:E,TextField:z,ThemeProvider:O,Toolbar:D,Typography:N}=MaterialUI,M="https://seuvitor.github.io",L="/my-investment-wallet/";console.log("APP_HOST",M),console.log("APP_BASE_PATH",L);const $="7s3vb9runcfjvgetrvhdfd97at",F="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",j=`${M}${L}?auth-redirect`,V=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${$}&response_type=code&scope=email+openid+profile&redirect_uri=${j}`,Q=({children:e})=>{const[t]=React.useState(v({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"}}}));return n(O,{theme:t},e)},W=React.createContext(),U=({children:e})=>{const[t,o]=React.useState(""),[a,r]=React.useState(!1),l=React.useCallback(e=>{o(e),r(!0)},[]),i=()=>{o(""),r(!1)};return n(W.Provider,{value:{showMessage:l}},e,n(P,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:a,autoHideDuration:5e3,onClose:i,message:t,action:n(b,{color:"inherit",onClick:i},n(g,null,"close"))},null))},G=React.createContext(),H=({children:e})=>{const[t,o]=React.useState({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[a,r]=React.useState(void 0),[l,i]=React.useState(void 0),[c]=React.useState(15e5),[s,u]=React.useState(void 0),d=React.useCallback(()=>new Promise(e=>{o({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),i(void 0),e()}),[]);React.useEffect(()=>{i(s?e=>e?(e.update({credentials:s}),e):new AWS.Config({region:"us-east-1",credentials:s}):void 0)},[s]);const p=React.useCallback((e,t)=>{const n=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((a,r)=>{n.clearCachedId(),n.getPromise().then(()=>{u(n),o(o=>{const n=e&&JSON.parse(atob(e.split(".")[1]));return o.id=n&&n.sub,o.name=n?n.name:"Usuário não logado",o.email=n&&n.email,o.groups=n&&n["cognito:groups"],o.idToken=e,o.accessToken=t,o}),a()}).catch(e=>{u(void 0),o({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),m=React.useCallback(e=>new Promise((t,o)=>{e?fetch(F,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${$}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{p(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),o(e)})}).catch(e=>{console.error("Could not decode authentication response",e),o(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),o(e)}):(console.warn("No refreshToken available"),o(new Error("No refreshToken available")))}),[p]);((e,t)=>{const o=React.useRef(),n=React.useCallback(()=>{const e=o.current;e&&(o.current=void 0,clearInterval(e))},[o]);React.useEffect(()=>(o.current=setInterval(e,t),n),[e,t,n])})(React.useCallback(()=>{m(a).catch(e=>{console.error("Could not refresh tokens",e)})},[a,m]),c);const v=React.useCallback(()=>p(),[p]),h=React.useCallback(e=>new Promise((t,o)=>{fetch(F,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${$}&code=${e}&redirect_uri=${j}`}).then(e=>{e.json().then(e=>{m(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),o(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),o(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),o(e)})}),[m]);return n(G.Provider,{value:{user:t,awsConfig:l,awsCredentials:s,loginAnonymously:v,loginWithAuthorizationCode:h,logoff:d}},e)},q=React.createContext(),J=({children:e})=>{const{awsConfig:t,awsCredentials:o}=React.useContext(G),[a,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{o&&r(e=>(e&&e.service.config.update({credentials:o}),e))},[o]),n(q.Provider,{value:{documentDB:a}},e)},K=React.createContext(),X=({children:e})=>{const{user:{accessToken:t},awsConfig:o,awsCredentials:a}=React.useContext(G),[r,l]=React.useState();React.useEffect(()=>{l(o?new AWS.Lambda(o):void 0)},[o]),React.useEffect(()=>{a&&l(e=>(e&&e.config.update({credentials:a}),e))},[a]);const i=React.useCallback((e,o)=>{const n={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return o&&(n.Payload=JSON.stringify(o)),new Promise((e,t)=>{r.invoke(n).promise().then(o=>{o.StatusCode&&200===o.StatusCode&&o.Payload||t(o);const n=JSON.parse(o.Payload);n&&n.statusCode&&200===n.statusCode||t(o),e(n.body)}).catch(e=>{t(e)})})},[r,t]);return n(K.Provider,{value:{invokeLambda:r&&i}},e)},Y=({children:e})=>n(Q,null,n(U,null,n(H,null,n(J,null,n(X,null,e))))),Z=()=>{const{user:{name:e}}=React.useContext(G);return e?null:n(React.Fragment,null,n(m,{color:"inherit",href:V},"Login"))},ee=()=>{const{showMessage:e}=React.useContext(W),{user:{name:t},logoff:o}=React.useContext(G),[a,r]=React.useState(!1),l=React.useRef(null);return t?n(React.Fragment,null,n(b,{color:"inherit",ref:l,onClick:()=>{r(!0)}},n(g,null,"account_circle")),n(x,{open:a,onClose:()=>{r(!1)},anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},n(k,{disabled:!0},t),n(y,null,null),n(k,{onClick:()=>{o().then(()=>{e("Logoff succesful")}).catch(()=>{e("Logoff failed")}),r(!1)}},"Logoff"))):null},te=({setDrawerOpen:e,routes:t})=>{const o=c(),a=t.find(e=>e.path===o.pathname);return n(d,null,n(D,null,n(b,{edge:"start",color:"inherit",onClick:()=>e(!0)},n(g,null,"menu")),n(N,{style:{flexGrow:1}},a?a.label:""),n(Z,null,null),n(ee,null,null)))},oe=({routes:e,drawerOpen:t,setDrawerOpen:o})=>{const{user:{groups:a}}=React.useContext(G),l=()=>o(!1);return n(f,{open:t,onClose:l},n(D,{onClick:l,style:{padding:"inherit"}},n(R,{button:!0,style:{justifyContent:"flex-end",height:"100%"}},n(g,null,"chevron_left"))),n(y,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!a&&t.some(e=>a.includes(e));var t}).map(e=>n(R,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:l,...e.options},n(w,{primary:e.label},null))))},ne=()=>n("div",null,null),ae=()=>{const{showMessage:e}=React.useContext(W),{loginWithAuthorizationCode:t}=React.useContext(G),{authorization_code:o}=s(),a=u();return React.useEffect(()=>{t(o).then(()=>{e("Usuário logado com sucesso"),a.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Não foi possível completar o login",t)})},[o,t,e,a]),n("div",null,null)},re=(e,t,o=2)=>new Big(e).plus(t).toFixed(null===o?void 0:o),le=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),ie=(e,t,o=2)=>new Big(e).times(new Big(t)).toFixed(null===o?void 0:o),ce=(e,t,o=Big.DP,n=Big.RM)=>new Big(e).div(new Big(t)).round(o,n).toFixed(o),se=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),ue=({setAvailableValue:e})=>{const[t,o]=React.useState(!0);return n("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},n(C,{container:!0,alignItems:"center",spacing:2},n(C,{item:!0,xs:12},n(N,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),n(C,{item:!0},n(z,{name:"availableValue",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),o(!0)}catch(e){o(!1)}},error:!t},null)),n(C,{item:!0},n(m,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},de=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:o}=React.useContext(q),[n,a]=React.useState(void 0);React.useEffect(()=>{if(o){const n=t.map(t=>`${t}/${e}`);Promise.all(n.map(e=>(async(e,t)=>{const o={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},n=await e.get(o).promise();if(!n.Item||!n.Item.prices)throw new Error("Price data not found");return n.Item.prices[t]})(o,e))).then(e=>{const o=e.reduce((e,o,n)=>({...e,[t[n]]:o}),{});a(o)}).catch(e=>{a(void 0),console.error("Could not get currency exchange rates",e)})}else a(void 0)},[o,e,t]);const r=React.useCallback((t,o)=>o===e?t:ie(t,n[o]),[n,e]),l=React.useCallback((t,o)=>o===e?t:ie(t,ce("1",n[o])),[n,e]);return{toDefaultCurrency:n&&r,backToAssetCurrency:n&&l}},pe=()=>{const{user:{id:e}}=React.useContext(G),{documentDB:t}=React.useContext(q),[o,a]=React.useState(void 0),[r,l]=React.useState(void 0),[i,c]=React.useState(void 0),[s]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=de(s);React.useEffect(()=>{t&&e?((e,t)=>{const o={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(o).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})})(t,e).then(e=>{a({assets:e})}).catch(()=>{a(void 0)}):a(void 0)},[t,e]),React.useEffect(()=>{if(o&&o.assets&&o.assets.length&&r&&u&&d){const e=se(o.assets.map(e=>u(e.value,e.currency))),t=re(e,r),n=[...o.assets];n.forEach(e=>{var o,n;e.idealFutureValue=d((o=t,n=e.targetPercent,ie(o,ce(n,100,Big.DP))),e.currency)}),n.forEach(e=>{var t,o;e.idealInvestment=(t="0.00",o=le(e.idealFutureValue,e.value),new Big(t).cmp(new Big(o))>=0?t:o)});const a=se(n.map(e=>u(e.idealInvestment,e.currency)));n.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,o,n=2)=>ie(e,ce(t,o,Big.DP),n))(u(e.idealInvestment,e.currency),r,a),e.currency)}),n.forEach(e=>{e.investmentQuantity=ie(e.minimum,ce(e.proportionalizedIdealInvestment,ie(e.price,e.minimum,Big.DP),0,0),null)}),n.forEach(e=>{e.investment=ie(e.investmentQuantity,e.price)});const l=se(n.map(e=>u(e.investment,e.currency))),i=le(r,l);n.forEach(e=>{e.futureQuantity=re(e.quantity,e.investmentQuantity,null)}),n.forEach(e=>{e.futureValue=ie(e.futureQuantity,e.price)});const s=se(n.map(e=>u(e.futureValue,e.currency)));n.forEach(e=>{e.futurePercent=ie("100.00",ce(u(e.futureValue,e.currency),s),4)}),c({assets:n,totalInvestment:l,remainingAvailableValue:i})}else c(void 0)},[o,r,u,d]);const m=i&&i.assets||o&&o.assets;return n(React.Fragment,null,n(ue,{setAvailableValue:l},null),n(y,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),m&&n(B,{component:p,style:{width:"fit-content"}},n(T,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},n(I,null,n(E,null,n(A,{style:{border:0}}),n(A,{style:{border:0}}),n(A,{align:"center",style:{border:0}},"Posição atual"),i&&n(A,{style:{border:0}}),i&&n(A,{align:"center",style:{border:0}},"Novo aporte"),i&&n(A,{style:{border:0}}),i&&n(A,{align:"center",style:{border:0}},"Posição futura"))),n(_,null,m.map(e=>n(E,{key:e.code},n(A,{style:{display:"contents"}},n(p,{component:S,p:2,style:{display:"table-cell",verticalAlign:"middle"}},n(C,{container:!0},n(C,{item:!0,xs:6},n(N,null,e.code)),n(C,{item:!0,xs:6,align:"right"},n(N,{variant:"caption",color:"textSecondary"},e.currency+" "),n(N,{display:"inline"},""+e.price)),n(C,{item:!0,xs:12},n(h,{size:"small",label:e.name}))))),n(A,{style:{display:"contents"}},n(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(N,{variant:"caption",color:"textSecondary"},"objetivo"),n(N,null,e.targetPercent+"%"))),n(A,{style:{display:"contents"}},n(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(N,{variant:"caption",display:"block"},e.quantity+" cotas"),n(N,{variant:"caption",color:"textSecondary"},e.currency+" "),n(N,{display:"inline"},""+e.value),n(N,{variant:"body2"},e.currentPercent+"%"))),i&&n(A,{padding:"none",align:"center",style:{border:0}},n(g,null,"chevron_right")),i&&n(A,{style:{display:"contents"}},n(p,{component:S,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},n(N,{variant:"caption"},e.code),n(N,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},e.investmentQuantity+" cotas"),n(N,{variant:"caption",color:"textSecondary"},e.currency+" "),n(N,{variant:"caption"},""+e.investment))),i&&n(A,{padding:"none",align:"center",style:{border:0}},n(g,null,"chevron_right")),i&&n(A,{style:{display:"contents"}},n(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(N,{variant:"caption",display:"block"},e.futureQuantity+" cotas"),n(N,{variant:"caption",color:"textSecondary"},e.currency+" "),n(N,{display:"inline"},""+e.futureValue),n(N,{variant:"body2"},e.futurePercent+"%"))))),n(E,null,n(A,{style:{border:0}}),n(A,{style:{border:0}}),n(A,{style:{border:0}}),i&&n(A,{style:{border:0}}),i&&n(A,{align:"center",padding:"none",style:{border:0}},n(p,{component:S,p:2,elevation:6,align:"center"},n(N,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),n(N,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(N,{display:"inline"},""+i.totalInvestment),n(y,{light:!0,variant:"fullWidth"},null),n(N,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),n(N,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(N,{display:"inline"},""+i.remainingAvailableValue))),i&&n(A,{style:{border:0}}),i&&n(A,{style:{border:0}}))))))},me=()=>{const{user:{id:e}}=React.useContext(G),{documentDB:t}=React.useContext(q),[o,a]=React.useState([]);return React.useEffect(()=>{t&&e?((e,t)=>{const o={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,n)=>{e.get(o).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{n(e)})})})(t,e).then(e=>{a(e)}).catch(()=>{a([])}):a([])},[t,e]),o&&0!==o.length?n(B,{component:S,style:{width:"fit-content"}},n(T,{style:{tableLayout:"auto"}},n(I,null,n(E,null,n(A,null,"Categoria"),n(A,null,"Moeda"),n(A,null,"Objetivo"))),n(_,null,o.map(({category:e,currency:t,percent:o})=>n(E,{key:`${e}|${t}`},n(A,null,e),n(A,null,t),n(A,null,o+"%")))))):null},ve=(e,t,o)=>{t("update_asset_allocation",{user_id:o}).then(()=>{e("Portfólio atualizado com sucesso")}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Não foi possível atualizar o portfólio",t)})},he=()=>{const{showMessage:e}=React.useContext(W),{user:t}=React.useContext(G),{invokeLambda:o}=React.useContext(K);return n("div",{},n(m,{variant:"contained",onClick:()=>{ve(e,o,t.id)},disabled:!o},"Atualizar Portfólio"))},ye=()=>{const{showMessage:e}=React.useContext(W),{user:t}=React.useContext(G),{invokeLambda:o}=React.useContext(K),a=React.useRef(),r=n=>{const a=n.target.result;let r;try{r=a.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[o,n]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[o]:n}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("Não foi possível carregar o arquivo",t)}r&&o("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),ve(e,o,t.id)}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Não foi possível atualizar os preços",t)})};return n("form",{ref:a},n("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>a.current.reset(),t.readAsText(e.target.files[0])},disabled:!o},null),n("label",{htmlFor:"contained-button-file"},n(m,{disabled:!o,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if(window.location.pathname===L){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"",`${L}#/authentication/${e.get("code")}`)}ReactDOM.render(n(()=>{const[e,t]=React.useState(!1),o=[{name:"main",label:"Main",path:"/",search:"?login-page=:page&code=:code",component:ne,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:me},{name:"suggestedAllocation",label:"Alocação Sugerida",path:"/suggested-allocation",component:pe},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",component:he},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:ye},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:ae}];return n(Y,null,n(a,null,n(te,{setDrawerOpen:t,routes:o},null),n(oe,{routes:o,drawerOpen:e,setDrawerOpen:t}),n(D,null,null),n(i,null,o.map(e=>n(l,{key:e.name+"-route",path:e.path,...e.options},n(e.component))))))},null,null),document.getElementById("app_container"))}]);
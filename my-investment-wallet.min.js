!function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){const n=React.createElement,{HashRouter:o,NavLink:r,Route:i,Switch:l,useLocation:c,useParams:s,useHistory:u}=window.ReactRouterDOM,{AppBar:d,Backdrop:m,Box:p,Button:y,CircularProgress:g,Container:h,Chip:v,Divider:f,Dialog:b,DialogActions:C,DialogContent:R,DialogTitle:w,Drawer:x,Icon:k,IconButton:S,Grid:P,ListItem:I,ListItemText:A,Menu:T,MenuItem:E,Paper:_,Snackbar:B,Table:D,TableBody:z,TableCell:M,TableContainer:N,TableHead:O,TableRow:V,TextField:F,ThemeProvider:W,Toolbar:j,Typography:L}=MaterialUI,$="7s3vb9runcfjvgetrvhdfd97at",Q="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",U="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",q=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${$}&response_type=code&scope=email+openid+profile&redirect_uri=${U}`,G=({children:e})=>{const[t]=React.useState(MaterialUI.createMuiTheme({palette:{primary:{main:"#556cd6"}}}));return n(W,{theme:t},e)},K=React.createContext(),H=({children:e})=>{const[t,a]=React.useState(""),[o,r]=React.useState(!1),i=React.useCallback(e=>{a(e),r(!0)},[]),l=()=>{a(""),r(!1)};return n(K.Provider,{value:{showMessage:i}},e,n(B,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:o,autoHideDuration:5e3,onClose:l,message:t,action:n(S,{color:"inherit",onClick:l},n(k,null,"close"))},null))},J=React.createContext(),X=({children:e})=>{const[t,a]=React.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[o,r]=React.useState(sessionStorage.getItem("my-investment-wallet-refresh-token")),[i,l]=React.useState(void 0),[c]=React.useState(15e5),[s,u]=React.useState(void 0);React.useEffect(()=>{o?sessionStorage.setItem("my-investment-wallet-refresh-token",o):sessionStorage.removeItem("my-investment-wallet-refresh-token")},[o]);const d=React.useCallback(()=>new Promise(e=>{a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),l(void 0),e()}),[]);React.useEffect(()=>{l(s?e=>e?(e.update({credentials:s}),e):new AWS.Config({region:"us-east-1",credentials:s}):void 0)},[s]);const m=React.useCallback((e,t)=>{const n=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((o,r)=>{n.clearCachedId(),n.getPromise().then(()=>{u(n),a(a=>{const o=e&&JSON.parse(atob(e.split(".")[1]));return a.identityId=n.identityId,a.id=o&&o.sub,a.name=o?o.name:"Usuário não logado",a.email=o&&o.email,a.groups=o&&o["cognito:groups"],a.idToken=e,a.accessToken=t,a}),o()}).catch(e=>{u(void 0),a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),p=React.useCallback(e=>new Promise((t,a)=>{e?fetch(Q,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${$}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{m(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),a(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),a(e)}):(console.warn("No refreshToken available"),a(new Error("No refreshToken available")))}),[m]);((e,t)=>{const a=React.useRef(),n=React.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);React.useEffect(()=>(a.current=setInterval(e,t),n),[e,t,n])})(React.useCallback(()=>{p(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,p]),c);const y=React.useCallback(()=>m(),[m]),g=React.useCallback(e=>new Promise((t,a)=>{fetch(Q,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${$}&code=${e}&redirect_uri=${U}`}).then(e=>{e.json().then(e=>{p(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),a(e)})}),[p]);return React.useEffect(()=>{o&&!s&&p(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,s,p]),n(J.Provider,{value:{user:t,awsConfig:i,awsCredentials:s,loginAnonymously:y,loginWithAuthorizationCode:g,logoff:d}},e)},Y=React.createContext(),Z=({children:e})=>{const{awsConfig:t,awsCredentials:a}=React.useContext(J),[o,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{a&&r(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),n(Y.Provider,{value:{documentDB:o}},e)},ee=React.createContext(),te=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:o}=React.useContext(J),[r,i]=React.useState();React.useEffect(()=>{i(a?new AWS.Lambda(a):void 0)},[a]),React.useEffect(()=>{o&&i(e=>(e&&e.config.update({credentials:o}),e))},[o]);const l=React.useCallback((e,a)=>{const n={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return a&&(n.Payload=JSON.stringify(a)),new Promise((e,t)=>{r.invoke(n).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const n=JSON.parse(a.Payload);n&&n.statusCode&&200===n.statusCode||t(a),e(n.body)}).catch(e=>{t(e)})})},[r,t]);return n(ee.Provider,{value:{invokeLambda:r&&l}},e)},ae=({children:e})=>n(G,null,n(H,null,n(X,null,n(Z,null,n(te,null,e))))),ne=()=>{const{user:{name:e}}=React.useContext(J);return e?null:n(React.Fragment,null,n(y,{color:"inherit",href:q},"Login"))},oe=()=>{const{showMessage:e}=React.useContext(K),{user:{name:t},logoff:a}=React.useContext(J),[o,r]=React.useState(!1),i=React.useRef(null);return t?n(React.Fragment,null,n(S,{color:"inherit",ref:i,onClick:()=>{r(!0)}},n(k,null,"account_circle")),n(T,{open:o,onClose:()=>{r(!1)},anchorEl:i.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},n(E,{disabled:!0},t),n(f,null,null),n(E,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),r(!1)}},"Logoff"))):null},re=({setDrawerOpen:e,routes:t})=>{const a=c(),o=t.find(e=>e.path===a.pathname);return n(d,null,n(j,null,n(S,{edge:"start",color:"inherit",onClick:()=>e(!0)},n(k,null,"menu")),n(L,{style:{flexGrow:1}},o?o.label:""),n(ne,null,null),n(oe,null,null)))},ie=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:o}}=React.useContext(J),i=()=>a(!1);return n(x,{open:t,onClose:i},n(j,{onClick:i,style:{padding:"inherit"}},n(I,{button:!0,style:{justifyContent:"flex-end",height:"100%"}},n(k,null,"chevron_left"))),n(f,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!o&&t.some(e=>o.includes(e));var t}).map(e=>n(I,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:i,...e.options},n(A,{primary:e.label},null))))},le=()=>n("div",null,null),ce=()=>{const{showMessage:e}=React.useContext(K),{loginWithAuthorizationCode:t}=React.useContext(J),{authorization_code:a}=s(),[o,r]=React.useState(!0),i=MaterialUI.useTheme(),l=u();return React.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),l.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t),r(!1)})},[a,t,e,l]),n(m,{open:o,style:{zIndex:1+i.zIndex.drawer}},n(g,null,null))},se=(e,t,a=2)=>new Big(e).plus(t).toFixed(null===a?void 0:a),ue=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),de=(e,t,a=2)=>new Big(e).times(new Big(t)).toFixed(null===a?void 0:a),me=(e,t,a=Big.DP,n=Big.RM)=>new Big(e).div(new Big(t)).round(a,n).toFixed(a),pe=(e,t)=>new Big(e).cmp(new Big(t))>=0?e:t,ye=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),ge=(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})},he=({setAvailableValue:e})=>{const[t,a]=React.useState(!0);return n("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},n(P,{container:!0,alignItems:"center",spacing:2},n(P,{item:!0,xs:12},n(L,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),n(P,{item:!0},n(F,{name:"availableValue",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),a(!0)}catch(e){a(!1)}},error:!t},null)),n(P,{item:!0},n(y,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},ve=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:a}=React.useContext(Y),[n,o]=React.useState(void 0);React.useEffect(()=>{if(a){const n=t.map(t=>`${t}/${e}`);Promise.all(n.map(e=>(async(e,t)=>{const a={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},n=await e.get(a).promise();if(!n.Item||!n.Item.prices)throw new Error("Price data not found");return n.Item.prices[t]})(a,e))).then(e=>{const a=e.reduce((e,a,n)=>({...e,[t[n]]:a}),{});o(a)}).catch(e=>{o(void 0),console.error("Could not get currency exchange rates",e)})}else o(void 0)},[a,e,t]);const r=React.useCallback((t,a)=>a===e?t:de(t,n[a]),[n,e]),i=React.useCallback((t,a)=>a===e?t:de(t,me("1",n[a])),[n,e]);return{toDefaultCurrency:n&&r,backToAssetCurrency:n&&i}},fe=()=>{const{user:{identityId:e}}=React.useContext(J),{documentDB:t}=React.useContext(Y),[a,o]=React.useState(void 0),[r,i]=React.useState(void 0),[l,c]=React.useState(void 0),[s]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=ve(s);React.useEffect(()=>{t&&e?ge(t,e).then(e=>{o({assets:e})}).catch(()=>{o(void 0)}):o(void 0)},[t,e]),React.useEffect(()=>{if(a&&a.assets&&a.assets.length&&r&&u&&d){const e=ye(a.assets.map(e=>u(e.value,e.currency))),t=se(e,r),n=[...a.assets];n.forEach(e=>{var a,n;e.idealFutureValue=d((a=t,n=e.targetPercent,de(a,me(n,100,Big.DP))),e.currency)}),n.forEach(e=>{e.idealInvestment=pe("0.00",ue(e.idealFutureValue,e.value))});const o=ye(n.map(e=>u(e.idealInvestment,e.currency)));n.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,a,n=2)=>de(e,me(t,a,Big.DP),n))(u(e.idealInvestment,e.currency),r,o),e.currency)}),n.forEach(e=>{e.investmentQuantity=de(e.minimum,me(e.proportionalizedIdealInvestment,de(e.price,e.minimum,Big.DP),0,0),null)}),n.forEach(e=>{e.investment=de(e.investmentQuantity,e.price)});const i=ye(n.map(e=>u(e.investment,e.currency))),l=ue(r,i);n.forEach(e=>{e.futureQuantity=se(e.quantity,e.investmentQuantity,null)}),n.forEach(e=>{e.futureValue=de(e.futureQuantity,e.price)});const s=ye(n.map(e=>u(e.futureValue,e.currency)));n.forEach(e=>{e.futurePercent=de("100.00",me(u(e.futureValue,e.currency),s),4)}),c({assets:n,totalInvestment:i,remainingAvailableValue:l})}else c(void 0)},[a,r,u,d]);const m=l&&l.assets||a&&a.assets;return n(React.Fragment,null,n(he,{setAvailableValue:i},null),n(f,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),m&&n(N,{component:p,style:{width:"fit-content"}},n(D,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},n(O,null,n(V,null,n(M,{style:{border:0}}),n(M,{style:{border:0}}),n(M,{align:"center",style:{border:0}},"Posição atual"),l&&n(M,{style:{border:0}}),l&&n(M,{align:"center",style:{border:0}},"Novo aporte"),l&&n(M,{style:{border:0}}),l&&n(M,{align:"center",style:{border:0}},"Posição futura"))),n(z,null,m.map(e=>n(V,{key:e.code},n(M,{style:{display:"contents"}},n(p,{component:_,p:2,style:{display:"table-cell",verticalAlign:"middle"}},n(P,{container:!0},n(P,{item:!0,xs:6},n(L,null,e.code)),n(P,{item:!0,xs:6,align:"right"},n(L,{variant:"caption",color:"textSecondary"},e.currency+" "),n(L,{display:"inline"},""+e.price)),n(P,{item:!0,xs:12},n(v,{size:"small",label:e.name}))))),n(M,{style:{display:"contents"}},n(p,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(L,{variant:"caption",color:"textSecondary"},"objetivo"),n(L,null,e.targetPercent+"%"))),n(M,{style:{display:"contents"}},n(p,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(L,{variant:"caption",display:"block"},e.quantity+" cotas"),n(L,{variant:"caption",color:"textSecondary"},e.currency+" "),n(L,{display:"inline"},""+e.value),n(L,{variant:"body2"},e.currentPercent+"%"))),l&&n(M,{padding:"none",align:"center",style:{border:0}},n(k,null,"chevron_right")),l&&n(M,{style:{display:"contents"}},n(p,{component:_,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},n(L,{variant:"caption"},e.code),n(L,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},e.investmentQuantity+" cotas"),n(L,{variant:"caption",color:"textSecondary"},e.currency+" "),n(L,{variant:"caption"},""+e.investment))),l&&n(M,{padding:"none",align:"center",style:{border:0}},n(k,null,"chevron_right")),l&&n(M,{style:{display:"contents"}},n(p,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(L,{variant:"caption",display:"block"},e.futureQuantity+" cotas"),n(L,{variant:"caption",color:"textSecondary"},e.currency+" "),n(L,{display:"inline"},""+e.futureValue),n(L,{variant:"body2"},e.futurePercent+"%"))))),n(V,null,n(M,{style:{border:0}}),n(M,{style:{border:0}}),n(M,{style:{border:0}}),l&&n(M,{style:{border:0}}),l&&n(M,{align:"center",padding:"none",style:{border:0}},n(p,{component:_,p:2,elevation:6,align:"center"},n(L,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),n(L,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(L,{display:"inline"},""+l.totalInvestment),n(f,{light:!0,variant:"fullWidth"},null),n(L,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),n(L,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(L,{display:"inline"},""+l.remainingAvailableValue))),l&&n(M,{style:{border:0}}),l&&n(M,{style:{border:0}}))))))},be=e=>e.reduce((e,t)=>{return void 0===e?t:(a=e,n=t,new Big(a).cmp(new Big(n))<0?a:n);var a,n},void 0),Ce=e=>e.reduce((e,t)=>void 0===e?t:pe(e,t),void 0),Re=e=>{return t=e.map(e=>e.weight),me(ye(t),t.length);var t},we=e=>ye(e.map(e=>e.weight)),xe=e=>0===e.length?"0":pe("0",ue(Re(e),de((10/e.length).toFixed(2),(e=>be(e.map(e=>e.weight)))(e)))),ke={"fixed-income":"renda fixa",reit:"imobiliário","stock-picking":"ações","stocks-fund":"fundo de ações",multistrategy:"multimercado"},Se=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),Pe=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:o}=React.useContext(K),{user:{identityId:r}}=React.useContext(J),{documentDB:i}=React.useContext(Y),l=()=>{a()};return n(b,{open:!0,onClose:l,fullWidth:!0,maxWidth:"md"},n("form",{onSubmit:n=>{n.preventDefault();const l=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:n.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const n={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(n).promise()})(i,r,l).then(()=>{o("Pesos atualizados com sucesso"),t(l),a()}).catch(e=>{o("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},n(w,null,"Alterar Pesos"),n(R,null,Se(e).map(t=>{const a=e.filter(e=>e.currency===t);return n(p,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},n(L,{variant:"subtitle1"},t),a.map(e=>n(p,{key:e.category,padding:1,width:e.widthPercent+"%"},n(F,{name:`weight-${t}-${e.category}`,defaultValue:e.weight,label:ke[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,style:{textAlign:"center"}}},null))))})),n(C,null,n(y,{onClick:l,variant:"contained",color:"secondary"},"Cancelar"),n(y,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Ie=()=>{const{user:{identityId:e}}=React.useContext(J),{documentDB:t}=React.useContext(Y),[a,o]=React.useState([]),[r,i]=React.useState([]),[l,c]=React.useState([]),[s,u]=React.useState(!1);React.useEffect(()=>{t&&e?(((e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{n(e)})})})(t,e).then(e=>{o(e)}).catch(()=>{o([])}),ge(t,e).then(e=>{i(e)}).catch(()=>{i([])})):(o([]),i([]))},[t,e]),React.useEffect(()=>{if(a&&r){let e=a.map(e=>({...e,currentPercent:ye(r.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const t=we(e);e=e.map(e=>({...e,targetPercent:me(de("100",e.weight),t,2)}));const n=Se(a),o=n.map(e=>xe(a.filter(t=>t.currency===e))),i=Ce(o),l=Ce(n.map(e=>{const t=a.filter(t=>t.currency===e);return se(we(t),de(i,t.length.toFixed(2)))}));e=e.map(e=>{const t=se(e.weight,i),a=me(de(t,"100"),l,2);return{...e,widthPercent:a}}),c(e)}else c([])},[a,r]);const d=React.useCallback(()=>{u(!1)},[]),m=React.useCallback(e=>{o(e)},[]);return l&&0!==l.length?n(React.Fragment,{},n(h,{maxWidth:!1},n(p,{align:"center",margin:1},n(y,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),Se(a).map(e=>{const t=l.filter(t=>t.currency===e);return n(p,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},n(L,{variant:"h6"},e),t.map(e=>n(p,{component:_,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},n(L,{},ke[e.category]),n(L,{variant:"subtitle1"},e.weight),n(P,{container:!0,justify:"space-evenly"},n(P,{item:!0},n(L,{variant:"caption"},e.currentPercent+"%"),n(L,{variant:"caption",display:"block",color:"textSecondary"},"atual")),n(P,{item:!0},n(L,{variant:"caption"},e.targetPercent+"%"),n(L,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),s&&n(Pe,{allocations:l,updatedAllocations:m,dismissAllocationEdition:d},null)):null},Ae=({selectedAsset:e,assetUpdated:t,dismissAssetEdition:a})=>{const{showMessage:o}=React.useContext(K),{user:{identityId:r}}=React.useContext(J),{documentDB:i}=React.useContext(Y),l=()=>{a()};return e?n(b,{open:!0,onClose:l},n("form",{onSubmit:n=>{n.preventDefault();const l={currency:n.target.currency.value,category:n.target.category.value,name:n.target.name.value,minimum:n.target.minimum.value,quantity:n.target.quantity.value,weight:n.target.weight.value};((e,t,a,n)=>{const o={TableName:"position",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":n}};return e.update(o).promise()})(i,r,e.code,l).then(()=>{o("Ativo atualizado com sucesso"),t({code:e.code,...l}),a()}).catch(e=>{o("Não foi possível atualizar o ativo"),console.error("Could not update asset position",e)})}},n(w,null,"Editar ativo: "+e.code),n(R,null,n(P,{container:!0,spacing:2},n(P,{item:!0,xs:2},n(F,{name:"currency",defaultValue:e.currency,label:"Moeda",variant:"filled",fullWidth:!0},null)),n(P,{item:!0,xs:4},n(F,{name:"category",defaultValue:e.category,label:"Categoria",variant:"filled",fullWidth:!0},null)),n(P,{item:!0,xs:6},n(F,{name:"name",defaultValue:e.name,label:"Nome",variant:"filled",fullWidth:!0},null)),n(P,{item:!0,xs:3},n(F,{name:"minimum",defaultValue:e.minimum,label:"Qtd mínima",variant:"filled",fullWidth:!0},null)),n(P,{item:!0,xs:3},n(F,{name:"quantity",defaultValue:e.quantity,label:"Qtd atual",variant:"filled",fullWidth:!0},null)),n(P,{item:!0,xs:2},n(F,{name:"weight",defaultValue:e.weight,label:"Peso",variant:"filled",fullWidth:!0},null)))),n(C,null,n(y,{onClick:l,variant:"contained",color:"secondary"},"Cancelar"),n(y,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},Te=()=>{const{user:{identityId:e}}=React.useContext(J),{documentDB:t}=React.useContext(Y),[a,o]=React.useState([]),[r,i]=React.useState(),[l,c]=React.useState(!1);React.useEffect(()=>{t&&e?((e,t)=>{const a={TableName:"position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.assets||n(new Error("no position found for this user id")),t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})})(t,e).then(e=>{o((e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency)))(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{o([])}):o([])},[t,e]);const s=React.useCallback(()=>{c(!1),i(void 0)},[]),u=React.useCallback(e=>{o(t=>t.map(t=>t.code===e.code?e:t))},[]);return a&&0!==a.length?n(N,{component:_,style:{width:"fit-content"}},n(D,{style:{tableLayout:"auto"}},n(O,null,n(V,null,n(M,null,"Moeda"),n(M,null,"Categoria"),n(M,null,"Código"),n(M,null,"Qtd mínima"),n(M,null,"Qtd atual"),n(M,null,"Peso"))),n(z,null,a.map(e=>n(V,{key:e.code,hover:!0,onClick:()=>(e=>{i(e),c(!0)})(e)},n(M,null,e.currency),n(M,null,ke[e.category]),n(M,null,e.code),n(M,null,e.minimum),n(M,null,e.quantity),n(M,null,e.weight))))),l&&n(Ae,{selectedAsset:r,assetUpdated:u,dismissAssetEdition:s},null)):null},Ee=(e,t,a)=>{t("update_asset_allocation",{user_id:a}).then(()=>{e("Portfólio atualizado com sucesso")}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t)})},_e=()=>{const{showMessage:e}=React.useContext(K),{user:{identityId:t}}=React.useContext(J),{invokeLambda:a}=React.useContext(ee);return n("div",{},n(y,{variant:"contained",onClick:()=>{Ee(e,a,t)},disabled:!a},"Atualizar Portfólio"))},Be=()=>{const{showMessage:e}=React.useContext(K),{user:{identityId:t}}=React.useContext(J),{invokeLambda:a}=React.useContext(ee),o=React.useRef(),r=n=>{const o=n.target.result;let r;try{r=o.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,n]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[a]:n}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&a("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),Ee(e,a,t)}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return n("form",{ref:o},n("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>o.current.reset(),t.readAsText(e.target.files[0])},disabled:!a},null),n("label",{htmlFor:"contained-button-file"},n(y,{disabled:!a,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(n(()=>{const[e,t]=React.useState(!1),a=[{name:"main",label:"Main",path:"/",search:"?login-page=:page&code=:code",component:le,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:Ie},{name:"position",label:"Posição",path:"/position",component:Te},{name:"suggestedAllocation",label:"Alocação Sugerida",path:"/suggested-allocation",component:fe},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",component:_e},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:Be},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:ce}];return n(ae,null,n(o,null,n(re,{setDrawerOpen:t,routes:a},null),n(ie,{routes:a,drawerOpen:e,setDrawerOpen:t}),n(j,null,null),n(l,null,a.map(e=>n(i,{key:e.name+"-route",path:e.path,...e.options},n(e.component))))))},null,null),document.getElementById("app_container"))}]);
!function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=5)}([function(e,t){e.exports=React},function(e,t){e.exports=MaterialUI},function(e,t){e.exports=Big},function(e,t){e.exports=AWS},function(e,t){e.exports=uuidv4},function(e,t,a){"use strict";a.r(t);var o=a(0),n=a.n(o),r=a(1);const l=n.a.createElement,{ThemeProvider:i}=r;var s=({children:e})=>{const[t]=n.a.useState(r.createMuiTheme({palette:{primary:{main:"#556cd6"}}}));return l(i,{theme:t},e)};const c=n.a.createElement,{Icon:u,IconButton:d,Snackbar:p}=r,m=n.a.createContext(),g=({children:e})=>{const[t,a]=n.a.useState([]),[o,r]=n.a.useState(void 0),[l,i]=n.a.useState(!1);n.a.useEffect(()=>{t.length&&!o?(r(t[0]),a(e=>e.slice(1)),i(!0)):t.length&&o&&l&&i(!1)},[t,o,l]);const s=n.a.useCallback(e=>{a(t=>[...t,e])},[]),g=(e,t)=>{"clickaway"!==t&&i(!1)};return c(m.Provider,{value:{showMessage:s}},e,c(p,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:l,autoHideDuration:5e3,onClose:g,onExited:()=>{r(void 0)},message:o,action:c(d,{color:"inherit",onClick:g},c(u,null,"close"))},null))};var y=m,h=a(3),v=a.n(h);const f="https://carteira-investimentos.auth.us-east-1.amazoncognito.com",b=f+"/oauth2/token",C="7s3vb9runcfjvgetrvhdfd97at",x="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",w=`${f}/login?client_id=${C}&response_type=code&scope=email+openid+profile&redirect_uri=${x}`,k=n.a.createElement,E=n.a.createContext(),T=({children:e})=>{const[t,a]=n.a.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[o,r]=n.a.useState(sessionStorage.getItem("my-investment-wallet-refresh-token")),[l,i]=n.a.useState(void 0),[s]=n.a.useState(15e5),[c,u]=n.a.useState(void 0);n.a.useEffect(()=>{o?sessionStorage.setItem("my-investment-wallet-refresh-token",o):sessionStorage.removeItem("my-investment-wallet-refresh-token")},[o]);const d=n.a.useCallback(()=>new Promise(e=>{a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),i(void 0),e()}),[]);n.a.useEffect(()=>{i(c?e=>e?(e.update({credentials:c}),e):new v.a.Config({region:"us-east-1",credentials:c}):void 0)},[c]);const p=n.a.useCallback((e,t)=>{const o=new v.a.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((n,r)=>{o.clearCachedId(),o.getPromise().then(()=>{u(o),a(a=>{const n=e&&JSON.parse(atob(e.split(".")[1]));return a.identityId=o.identityId,a.id=n&&n.sub,a.name=n?n.name:"Usuário não logado",a.email=n&&n.email,a.groups=n&&n["cognito:groups"],a.idToken=e,a.accessToken=t,a}),n()}).catch(e=>{u(void 0),a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),m=n.a.useCallback(e=>new Promise((t,a)=>{e?fetch(b,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${C}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{p(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),a(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),a(e)}):(console.warn("No refreshToken available"),a(new Error("No refreshToken available")))}),[p]);((e,t)=>{const a=n.a.useRef(),o=n.a.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);n.a.useEffect(()=>(a.current=setInterval(e,t),o),[e,t,o])})(n.a.useCallback(()=>{m(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,m]),s);const g=n.a.useCallback(()=>p(),[p]),y=n.a.useCallback(e=>new Promise((t,a)=>{fetch(b,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${C}&code=${e}&redirect_uri=${x}`}).then(e=>{e.json().then(e=>{m(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),a(e)})}),[m]);return n.a.useEffect(()=>{o&&!c&&m(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,c,m]),k(E.Provider,{value:{user:t,awsConfig:l,awsCredentials:c,loginAnonymously:g,loginWithAuthorizationCode:y,logoff:d}},e)};var P=E;const I=n.a.createElement,S=n.a.createContext(),D=({children:e})=>{const{awsConfig:t,awsCredentials:a}=n.a.useContext(P),[o,r]=n.a.useState();return n.a.useEffect(()=>{r(t?new v.a.DynamoDB.DocumentClient(t):void 0)},[t]),n.a.useEffect(()=>{a&&r(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),I(S.Provider,{value:{documentDB:o}},e)};var A=S;const _=n.a.createElement,N=n.a.createContext(),B=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:o}=n.a.useContext(P),[r,l]=n.a.useState();n.a.useEffect(()=>{l(a?new v.a.Lambda(a):void 0)},[a]),n.a.useEffect(()=>{o&&l(e=>(e&&e.config.update({credentials:o}),e))},[o]);const i=n.a.useCallback((e,a)=>{const o={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return a&&(o.Payload=JSON.stringify(a)),new Promise((e,t)=>{r.invoke(o).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const o=JSON.parse(a.Payload);o&&o.statusCode&&200===o.statusCode||t(a),e(o.body)}).catch(e=>{t(e)})})},[r,t]);return _(N.Provider,{value:{invokeLambda:r&&i}},e)};var O=N;const M=n.a.createElement,{useLocation:F}=window.ReactRouterDOM,{AppBar:V,Button:z,Divider:R,Icon:L,IconButton:j,Menu:$,MenuItem:W,Toolbar:U,Typography:q}=r,Q=()=>{const{user:{name:e}}=n.a.useContext(P);return e?null:M(n.a.Fragment,null,M(z,{color:"inherit",href:w},"Login"))},G=()=>{const{showMessage:e}=n.a.useContext(y),{user:{name:t},logoff:a}=n.a.useContext(P),[o,r]=n.a.useState(!1),l=n.a.useRef(null);return t?M(n.a.Fragment,null,M(j,{color:"inherit",ref:l,onClick:()=>{r(!0)}},M(L,null,"account_circle")),M($,{open:o,onClose:()=>{r(!1)},anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},M(W,{disabled:!0},t),M(R,null,null),M(W,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),r(!1)}},"Logoff"))):null};var K=({setDrawerOpen:e,routes:t})=>{const a=F(),o=t.find(e=>e.path===a.pathname);return M(V,null,M(U,null,M(j,{edge:"start",color:"inherit",onClick:()=>e(!0)},M(L,null,"menu")),M(q,{style:{flexGrow:1}},o?o.label:""),M(Q,null,null),M(G,null,null)))};const H=n.a.createElement,{NavLink:J}=window.ReactRouterDOM,{Box:X,Divider:Y,Drawer:Z,Icon:ee,ListItem:te,ListItemText:ae,Toolbar:oe}=r;var ne=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:o}}=n.a.useContext(P),r=()=>a(!1);return H(Z,{open:t,onClose:r},H(oe,{onClick:r,style:{padding:"inherit"}},H(te,{button:!0,style:{justifyContent:"space-between",height:"100%"}},H(X,{style:{flex:"auto",textAlign:"center"}},H("img",{src:"https://d3oia8etllorh5.cloudfront.net/us-east-1_SjfN8ExVX/ALL/20200706011733/assets/images/image.jpg",width:"70px",height:"70px"},null)),H(ee,null,"chevron_left"))),H(Y,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!o&&t.some(e=>o.includes(e));var t}).map(e=>H(te,{key:e.name+"-route-drawer-item",button:!0,component:J,activeClassName:"Mui-selected",to:e.path,onClick:r,...e.options},H(ae,{primary:e.label},null))))};const re=n.a.createElement,{Redirect:le}=window.ReactRouterDOM;var ie=()=>{const{user:{identityId:e}}=n.a.useContext(P);return e?re(le,{to:"/target-allocation"},null):null};const se=n.a.createElement,{useParams:ce,useHistory:ue}=window.ReactRouterDOM,{Backdrop:de,CircularProgress:pe}=r;var me=()=>{const{showMessage:e}=n.a.useContext(y),{loginWithAuthorizationCode:t}=n.a.useContext(P),{authorization_code:a}=ce(),[o,l]=n.a.useState(!0),i=r.useTheme(),s=ue();return n.a.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),s.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t),l(!1)})},[a,t,e,s]),se(de,{open:o,style:{zIndex:1+i.zIndex.drawer}},se(pe,null,null))},ge=a(2),ye=a.n(ge);const he=async(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]},o=await e.get(a).promise();return o.Item&&o.Item.assets||{}},ve=async(e,t)=>{const a={TableName:"asset",Key:{user_id:t},AttributesToGet:["assets"]},o=await e.get(a).promise();return o.Item&&o.Item.assets||{}},fe=(e,t,a=2)=>new ye.a(e).plus(t).toFixed(null===a?void 0:a),be=(e,t)=>new ye.a(e).minus(new ye.a(t)).toFixed(2),Ce=(e,t,a=2)=>new ye.a(e).times(new ye.a(t)).toFixed(null===a?void 0:a),xe=(e,t,a=ye.a.DP,o=ye.a.RM)=>new ye.a(e).div(new ye.a(t)).round(a,o).toFixed(a),we=(e,t)=>new ye.a(e).cmp(new ye.a(t))>=0?e:t,ke=e=>e.map(e=>new ye.a(e)).reduce((e,t)=>e.plus(t),new ye.a(0)).toFixed(2),Ee=e=>e.reduce((e,t)=>{return void 0===e?t:(a=e,o=t,new ye.a(a).cmp(new ye.a(o))<0?a:o);var a,o},void 0),Te=e=>e.reduce((e,t)=>void 0===e?t:we(e,t),void 0);var Pe=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:a}=n.a.useContext(A),[o,r]=n.a.useState(void 0);n.a.useEffect(()=>{if(a){const o=t.map(t=>`${t}/${e}`);Promise.all(o.map(e=>(async(e,t)=>{const a={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},o=await e.get(a).promise();return o.Item&&o.Item.prices&&o.Item.prices[t]})(a,e))).then(e=>{const a=e.reduce((e,a,o)=>({...e,[t[o]]:a}),{});r(a)}).catch(e=>{r(void 0),console.error("Could not get currency exchange rates",e)})}else r(void 0)},[a,e,t]);const l=n.a.useCallback((t,a)=>a===e?t:Ce(t,o[a]),[o,e]),i=n.a.useCallback((t,a)=>a===e?t:Ce(t,xe("1",o[a])),[o,e]);return{toDefaultCurrency:o&&l,backToAssetCurrency:o&&i}};const Ie=(e,t)=>parseFloat(e).toLocaleString("pt-BR",{maximumFractionDigits:20,minimumFractionDigits:t&&t}),Se=n.a.createElement,{Box:De,Button:Ae,Chip:_e,Divider:Ne,Icon:Be,Grid:Oe,Paper:Me,Table:Fe,TableBody:Ve,TableCell:ze,TableContainer:Re,TableHead:Le,TableRow:je,TextField:$e,Typography:We}=r,Ue=({setAvailableValue:e})=>{const[t,a]=n.a.useState(!0);return Se("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},Se(Oe,{container:!0,alignItems:"center",spacing:2},Se(Oe,{item:!0,xs:12},Se(We,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),Se(Oe,{item:!0},Se($e,{name:"availableValue",type:"number",label:"Valor disponível",variant:"filled",onChange:e=>{try{ye()(e.target.value),a(!0)}catch(e){a(!1)}},error:!t,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)),Se(Oe,{item:!0},Se(Ae,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))};var qe=()=>{const{user:{identityId:e}}=n.a.useContext(P),{documentDB:t}=n.a.useContext(A),[a,o]=n.a.useState(void 0),[r,l]=n.a.useState(void 0),[i,s]=n.a.useState(void 0),[c]=n.a.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=Pe(c);n.a.useEffect(()=>{t&&e?he(t,e).then(e=>{o({assets:e})}).catch(()=>{o(void 0)}):o(void 0)},[t,e]),n.a.useEffect(()=>{if(a&&a.assets&&a.assets.length&&r&&u&&d){const e=ke(a.assets.map(e=>u(e.value,e.currency))),t=fe(e,r),o=[...a.assets];o.forEach(e=>{var a,o;e.idealFutureValue=d((a=t,o=e.targetPercent,Ce(a,xe(o,100,ye.a.DP))),e.currency)}),o.forEach(e=>{e.idealInvestment=we("0.00",be(e.idealFutureValue,e.value))});const n=ke(o.map(e=>u(e.idealInvestment,e.currency)));o.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,a,o=2)=>Ce(e,xe(t,a,ye.a.DP),o))(u(e.idealInvestment,e.currency),r,n),e.currency)}),o.forEach(e=>{e.investmentQuantity=Ce(e.minimum,xe(e.proportionalizedIdealInvestment,Ce(e.price,e.minimum,ye.a.DP),0,0),null)}),o.forEach(e=>{e.investment=Ce(e.investmentQuantity,e.price)});const l=ke(o.map(e=>u(e.investment,e.currency))),i=be(r,l);o.forEach(e=>{e.futureQuantity=fe(e.quantity,e.investmentQuantity,null)}),o.forEach(e=>{e.futureValue=Ce(e.futureQuantity,e.price)});const c=ke(o.map(e=>u(e.futureValue,e.currency)));o.forEach(e=>{e.futurePercent=Ce("100.00",xe(u(e.futureValue,e.currency),c),4)}),s({assets:o,totalInvestment:l,remainingAvailableValue:i})}else s(void 0)},[a,r,u,d]);const p=i&&i.assets||a&&a.assets;return Se(n.a.Fragment,null,Se(Ue,{setAvailableValue:l},null),Se(Ne,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),p&&Se(Re,{component:De,style:{width:"fit-content"}},Se(Fe,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},Se(Le,null,Se(je,null,Se(ze,{style:{border:0}}),Se(ze,{style:{border:0}}),Se(ze,{align:"center",style:{border:0}},"Posição atual"),i&&Se(ze,{style:{border:0}}),i&&Se(ze,{align:"center",style:{border:0}},"Novo aporte"),i&&Se(ze,{style:{border:0}}),i&&Se(ze,{align:"center",style:{border:0}},"Posição futura"))),Se(Ve,null,p.map(e=>Se(je,{key:e.code},Se(ze,{style:{display:"contents"}},Se(De,{component:Me,p:2,style:{display:"table-cell",verticalAlign:"middle"}},Se(Oe,{container:!0},Se(Oe,{item:!0,xs:6},Se(We,null,e.code)),Se(Oe,{item:!0,xs:6,align:"right"},Se(We,{variant:"caption",color:"textSecondary"},e.currency+" "),Se(We,{display:"inline"},""+Ie(e.price))),Se(Oe,{item:!0,xs:12},Se(_e,{size:"small",label:e.name}))))),Se(ze,{style:{display:"contents"}},Se(De,{component:Me,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},Se(We,{variant:"caption",color:"textSecondary"},"objetivo"),Se(We,null,Ie(e.targetPercent)+"%"))),Se(ze,{style:{display:"contents"}},Se(De,{component:Me,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},Se(We,{variant:"caption",display:"block"},Ie(e.quantity)+" cotas"),Se(We,{variant:"caption",color:"textSecondary"},e.currency+" "),Se(We,{display:"inline"},""+Ie(e.value,2)),Se(We,{variant:"body2"},Ie(e.currentPercent)+"%"))),i&&Se(ze,{padding:"none",align:"center",style:{border:0}},Se(Be,null,"chevron_right")),i&&Se(ze,{style:{display:"contents"}},Se(De,{component:Me,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},Se(We,{variant:"caption"},e.code),Se(We,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},Ie(e.investmentQuantity)+" cotas"),Se(We,{variant:"caption",color:"textSecondary"},e.currency+" "),Se(We,{variant:"caption"},""+Ie(e.investment,2)))),i&&Se(ze,{padding:"none",align:"center",style:{border:0}},Se(Be,null,"chevron_right")),i&&Se(ze,{style:{display:"contents"}},Se(De,{component:Me,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},Se(We,{variant:"caption",display:"block"},Ie(e.futureQuantity)+" cotas"),Se(We,{variant:"caption",color:"textSecondary"},e.currency+" "),Se(We,{display:"inline"},""+Ie(e.futureValue,2)),Se(We,{variant:"body2"},Ie(e.futurePercent)+"%"))))),Se(je,null,Se(ze,{style:{border:0}}),Se(ze,{style:{border:0}}),Se(ze,{style:{border:0}}),i&&Se(ze,{style:{border:0}}),i&&Se(ze,{align:"center",padding:"none",style:{border:0}},Se(De,{component:Me,p:2,elevation:6,align:"center"},Se(We,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),Se(We,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),Se(We,{display:"inline"},""+Ie(i.totalInvestment,2)),Se(Ne,{light:!0,variant:"fullWidth"},null),Se(We,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),Se(We,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),Se(We,{display:"inline"},""+Ie(i.remainingAvailableValue,2)))),i&&Se(ze,{style:{border:0}}),i&&Se(ze,{style:{border:0}}))))))};var Qe=()=>{const{showMessage:e}=n.a.useContext(y),{user:{identityId:t}}=n.a.useContext(P),{invokeLambda:a}=n.a.useContext(O),o=n.a.useCallback(()=>new Promise((o,n)=>{a("update_asset_allocation",{user_id:t}).then(()=>{e("Portfólio atualizado com sucesso"),o()}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t),n(t)})}),[e,t,a]),r=n.a.useCallback(()=>new Promise((n,r)=>{a("update_target_allocation",{user_id:t}).then(()=>{e("Macro-alocação atualizada com sucesso"),o().then(()=>{n()}).catch(e=>{r(e)})}).catch(t=>{e("Não foi possível atualizar a macro-alocação"),console.error("Target allocation update failed",t),r(t)})}),[e,t,a,o]),l=n.a.useCallback(()=>new Promise((n,r)=>{a("update_position",{user_id:t}).then(()=>{e("Posição atualizada com sucesso"),o().then(()=>{n()}).catch(e=>{r(e)})}).catch(t=>{e("Não foi possível atualizar a posição"),console.error("Position update failed",t),r(t)})}),[e,t,a,o]);return{updatePosition:a&&l,updateTargetAllocation:a&&r,updatePortofolio:a&&o}};const Ge={"fixed-income":"Renda Fixa",reit:"Imobiliário","stock-picking":"Ações","stocks-fund":"Fundo de Ações",multistrategy:"Multimercado"},Ke={buy:"Compra",sell:"Venda"},He=n.a.createElement,{Box:Je,Button:Xe,Container:Ye,Dialog:Ze,DialogActions:et,DialogContent:tt,DialogTitle:at,Grid:ot,Paper:nt,TextField:rt,Typography:lt}=r,it=e=>{return t=e.map(e=>e.weight),xe(ke(t),t.length);var t},st=e=>ke(e.map(e=>e.weight)),ct=e=>0===e.length?"0":we("0",be(it(e),Ce((10/e.length).toFixed(2),(e=>Ee(e.map(e=>e.weight)))(e)))),ut=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),dt=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:o}=n.a.useContext(y),{user:{identityId:r}}=n.a.useContext(P),{documentDB:l}=n.a.useContext(A),{updatePortofolio:i}=Qe(),s=()=>{a()};return He(Ze,{open:!0,onClose:s,fullWidth:!0,maxWidth:"md"},He("form",{onSubmit:n=>{n.preventDefault();const s=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:n.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const o={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(o).promise()})(l,r,s).then(()=>{o("Pesos atualizados com sucesso"),t(s),a(),i()}).catch(e=>{o("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},He(at,null,"Alterar Pesos"),He(tt,null,ut(e).map(t=>{const a=e.filter(e=>e.currency===t);return He(Je,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},He(lt,{variant:"subtitle1"},t),a.map(e=>He(Je,{key:e.category,padding:1,width:e.widthPercent+"%"},He(rt,{name:`weight-${t}-${e.category}`,type:"number",defaultValue:e.weight,label:Ge[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"center"}}},null))))})),He(et,null,He(Xe,{onClick:s,variant:"contained",color:"secondary"},"Cancelar"),He(Xe,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))};var pt=()=>{const{user:{identityId:e}}=n.a.useContext(P),{documentDB:t}=n.a.useContext(A),[a,o]=n.a.useState([]),[r,l]=n.a.useState([]),[i,s]=n.a.useState([]),[c,u]=n.a.useState(!1);n.a.useEffect(()=>{t&&e?((async(e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]},o=await e.get(a).promise();return o.Item&&o.Item.allocations||[]})(t,e).then(e=>{o(e)}).catch(()=>{o([])}),he(t,e).then(e=>{l(e)}).catch(()=>{l([])})):(o([]),l([]))},[t,e]),n.a.useEffect(()=>{s(a&&r?((e,t)=>{let a=e.map(e=>({...e,currentPercent:ke(t.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const o=st(a);a=a.map(e=>({...e,targetPercent:"0.00"===o?"0.00":xe(Ce("100",e.weight),o,2)}));const n=ut(e),r=n.map(t=>ct(e.filter(e=>e.currency===t))),l=Te(r),i=Te(n.map(t=>{const a=e.filter(e=>e.currency===t);return fe(st(a),Ce(l,a.length.toFixed(2)))}));return a=a.map(e=>{const t=xe(Ce(n.length.toFixed(2),"100"),a.length.toFixed(2),2),o=fe(e.weight,l),r="0.00"===i?t:xe(Ce(o,"100"),i,2);return{...e,widthPercent:r}}),a})(a,r):[])},[a,r]);const d=n.a.useCallback(()=>{u(!1)},[]),p=n.a.useCallback(e=>{o(e)},[]);return i&&0!==i.length?He(n.a.Fragment,null,He(Ye,{maxWidth:!1},He(Je,{align:"center",margin:1},He(Xe,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),ut(i).map(e=>{const t=i.filter(t=>t.currency===e);return He(Je,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},He(lt,{variant:"h6"},e),t.map(e=>He(Je,{component:nt,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},He(lt,null,Ge[e.category]),He(lt,{variant:"subtitle1"},Ie(e.weight)),He(ot,{container:!0,justify:"space-evenly"},He(ot,{item:!0},He(lt,{variant:"caption"},Ie(e.currentPercent)+"%"),He(lt,{variant:"caption",display:"block",color:"textSecondary"},"atual")),He(ot,{item:!0},He(lt,{variant:"caption"},Ie(e.targetPercent)+"%"),He(lt,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),c&&He(dt,{allocations:i,updatedAllocations:p,dismissAllocationEdition:d},null)):null};const mt=n.a.createElement,{Box:gt,Button:yt,Dialog:ht,DialogActions:vt,DialogContent:ft,DialogTitle:bt,DialogContentText:Ct,FormControl:xt,InputLabel:wt,Grid:kt,MenuItem:Et,Paper:Tt,Select:Pt,Table:It,TableBody:St,TableCell:Dt,TableContainer:At,TableHead:_t,TableRow:Nt,TextField:Bt}=r,Ot=({selectedAsset:e,allAssetCodes:t,assetChanged:a,dismissAssetEdition:o})=>{const{showMessage:r}=n.a.useContext(y),{user:{identityId:l}}=n.a.useContext(P),{documentDB:i}=n.a.useContext(A),[s,c]=n.a.useState(!1),{updateTargetAllocation:u,updatePosition:d}=Qe(),p=null===e.code,m=()=>{o()};return e?mt(ht,{open:!0,onClose:m},mt("form",{onSubmit:t=>{t.preventDefault();const n={currency:t.target.currency.value,category:t.target.category.value,name:t.target.name.value,minimum:t.target.minimum.value,weight:t.target.weight.value},s=p?t.target.code.value:e.code;(async(e,t,a,o)=>{const n={TableName:"asset",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":o}};try{return await e.update(n).promise()}catch(n){if(n.message&&"The document path provided in the update expression is invalid for update"===n.message){const n={TableName:"asset",Key:{user_id:t},UpdateExpression:"set assets = :assets",ExpressionAttributeValues:{":assets":{[a]:o}}};return e.update(n).promise()}throw n}})(i,l,s,n).then(()=>{r(`Ativo ${p?"adicionado":"atualizado"} com sucesso`),a({code:s,...n},p?"DB_INSERT":"DB_UPDATE"),o(),u(),d()}).catch(e=>{r(`Não foi possível ${p?"adicionar":"atualizar"} o ativo`),console.error(`Could not ${p?"add":"update"} asset`,e)})}},mt(bt,null,""+(p?"Adicionar ativo":"Editar ativo: "+e.code)),mt(ft,null,mt(kt,{container:!0,spacing:2},p&&mt(kt,{item:!0,xs:6},mt(Bt,{name:"code",defaultValue:"",label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(t.includes(e.target.value)?"Código já existente":""),e.target.reportValidity()}},null)),mt(kt,{item:!0,xs:2},mt(Bt,{name:"currency",defaultValue:e.currency,label:"Moeda",required:!0,variant:"filled",fullWidth:!0},null)),mt(kt,{item:!0,xs:4},mt(xt,{fullWidth:!0},mt(wt,{id:"category-label"},"Categoria"),mt(Pt,{name:"category",defaultValue:e.category||"",labelId:"category-label",required:!0,variant:"filled"},Object.entries(Ge).map(([e,t])=>mt(Et,{key:e,value:e},t))))),mt(kt,{item:!0,xs:6},mt(Bt,{name:"name",defaultValue:e.name,label:"Nome",required:!0,variant:"filled",fullWidth:!0},null)),mt(kt,{item:!0,xs:4},mt(Bt,{name:"minimum",type:"number",defaultValue:e.minimum,label:"Qtd mínima",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.00000000000001",style:{textAlign:"right"}}},null)),mt(kt,{item:!0,xs:2},mt(Bt,{name:"weight",type:"number",defaultValue:e.weight,label:"Peso",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)))),mt(vt,null,mt(gt,{style:{flex:"auto"}},!p&&mt(yt,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&mt(ht,{open:!0,onClose:()=>c(!1)},mt(ft,null,mt(Ct,null,`Confirma exclusão do ativo ${e.code}?`)),mt(vt,null,mt(yt,{onClick:()=>c(!1)},"Não"),mt(yt,{onClick:()=>{((e,t,a)=>{const o={TableName:"asset",Key:{user_id:t},UpdateExpression:"REMOVE assets.#assetCode",ExpressionAttributeNames:{"#assetCode":a}};return e.update(o).promise()})(i,l,e.code).then(()=>{r("Ativo excluído com sucesso"),a(e,"DB_DELETE"),o(),u(),d()}).catch(e=>{r("Não foi possível excluir o ativo"),console.error("Could not delete asset",e)})},autoFocus:!0},"Sim")))),mt(yt,{onClick:m,variant:"contained",color:"secondary"},"Cancelar"),mt(yt,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},Mt=e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency));var Ft=()=>{const{user:{identityId:e}}=n.a.useContext(P),{documentDB:t}=n.a.useContext(A),[a,o]=n.a.useState([]),[l,i]=n.a.useState(),s=r.useTheme();n.a.useEffect(()=>{t&&e?ve(t,e).then(e=>{o(Mt(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{o([])}):o([])},[t,e]);const c=n.a.useCallback(()=>{i(void 0)},[]),u=n.a.useCallback((e,t)=>{"DB_INSERT"===t?o(t=>Mt([...t,e])):"DB_UPDATE"===t?o(t=>Mt(t.map(t=>t.code===e.code?e:t))):"DB_DELETE"===t&&o(t=>t.filter(t=>t.code!==e.code))},[]);return mt(n.a.Fragment,null,mt(gt,{margin:1},mt(yt,{onClick:()=>{i({code:null})},variant:"contained"},"Novo ativo")),a&&0!==a.length?mt(At,{component:Tt,style:{width:"fit-content"}},mt(It,{style:{tableLayout:"auto"}},mt(_t,{style:{backgroundColor:s.palette.background.default}},mt(Nt,null,mt(Dt,null,"Moeda"),mt(Dt,null,"Categoria"),mt(Dt,null,"Código"),mt(Dt,null,"Nome"),mt(Dt,{align:"right"},"Qtd mínima"),mt(Dt,{align:"right"},"Peso"))),mt(St,null,a.map(e=>mt(Nt,{key:e.code,hover:!0,onClick:()=>(e=>{i(e)})(e)},mt(Dt,null,e.currency),mt(Dt,null,Ge[e.category]),mt(Dt,null,e.code),mt(Dt,null,e.name),mt(Dt,{align:"right"},Ie(e.minimum)),mt(Dt,{align:"right"},Ie(e.weight))))))):null,l&&mt(Ot,{selectedAsset:l,allAssetCodes:a.map(({code:e})=>e),assetChanged:u,dismissAssetEdition:c},null))},Vt=a(4),zt=a.n(Vt);const Rt=n.a.createElement,{Box:Lt,Button:jt,Dialog:$t,DialogActions:Wt,DialogContent:Ut,DialogTitle:qt,DialogContentText:Qt,FormControl:Gt,InputLabel:Kt,Grid:Ht,MenuItem:Jt,Paper:Xt,Select:Yt,Table:Zt,TableBody:ea,TableCell:ta,TableContainer:aa,TableHead:oa,TableRow:na,TextField:ra}=r,la=e=>e.sort((e,t)=>t.type.localeCompare(e.type)).sort((e,t)=>t.code.localeCompare(e.code)).sort((e,t)=>t.date.localeCompare(e.date)),ia=({selectedOperation:e,operationChanged:t,dismissOperationEdition:a,assets:o})=>{const{showMessage:r}=n.a.useContext(y),{user:{identityId:l}}=n.a.useContext(P),{documentDB:i}=n.a.useContext(A),[s,c]=n.a.useState(!1),[u,d]=n.a.useState(),[p,m]=n.a.useState(),{updatePosition:g}=Qe(),h=null===e.operationId,v=n.a.useCallback(e=>{const t=Object.keys(o).includes(e)?o[e].minimum:"1";d(t),m(parseFloat(t)<1?t:"0.01")},[o]);n.a.useEffect(()=>{v(e.code)},[e.code,v]);const f=()=>{a()};return Rt($t,{open:!0,onClose:f},Rt("form",{onSubmit:o=>{o.preventDefault();const n={type:o.target.type.value,code:o.target.code.value,date:o.target.date.value,amount:o.target.amount.value,price:o.target.price.value,expenses:o.target.expenses.value},s=h?zt()():e.operationId;((e,t,a,o)=>{const n={TableName:"operation",Key:{user_id:t},UpdateExpression:"set operations.#operationId = :operation",ExpressionAttributeNames:{"#operationId":a},ExpressionAttributeValues:{":operation":o}};return e.update(n).promise()})(i,l,s,n).then(()=>{r(`Operação ${h?"adicionada":"atualizada"} com sucesso`),t({operationId:s,...n},h?"DB_INSERT":"DB_UPDATE"),a(),g()}).catch(e=>{r(`Não foi possível ${h?"adicionar":"atualizar"} a operação`),console.error(`Could not ${h?"add":"update"} operation`,e)})}},Rt(qt,null,(h?"Adicionar":"Editar")+" operação"),Rt(Ut,null,Rt(Ht,{container:!0,spacing:2},Rt(Ht,{item:!0,xs:3},Rt(Gt,{fullWidth:!0},Rt(Kt,{id:"type-label"},"Tipo"),Rt(Yt,{name:"type",defaultValue:e.type||"",labelId:"type-label",required:!0,variant:"filled"},Object.entries(Ke).map(([e,t])=>Rt(Jt,{key:e,value:e},t))))),Rt(Ht,{item:!0,xs:5},Rt(ra,{name:"code",defaultValue:e.code,label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(Object.keys(o).includes(e.target.value)?"":"Código inexistente"),v(e.target.value)}},null)),Rt(Ht,{item:!0,xs:4},Rt(ra,{name:"date",type:"date",defaultValue:e.date,label:"Data",InputLabelProps:{shrink:!0},required:!0,variant:"filled",fullWidth:!0},null)),Rt(Ht,{item:!0,xs:12},Rt(ra,{name:"amount",type:"number",defaultValue:e.amount,label:"Quantidade",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:u,style:{textAlign:"right"}}},null)),Rt(Ht,{item:!0,xs:12},Rt(ra,{name:"price",type:"number",defaultValue:e.price,label:"Preço",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)),Rt(Ht,{item:!0,xs:12},Rt(ra,{name:"expenses",type:"number",defaultValue:e.expenses,label:"Despesas",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)))),Rt(Wt,null,Rt(Lt,{style:{flex:"auto"}},!h&&Rt(jt,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&Rt($t,{open:!0,onClose:()=>c(!1)},Rt(Ut,null,Rt(Qt,null,"Confirma exclusão da operação?")),Rt(Wt,null,Rt(jt,{onClick:()=>c(!1)},"Não"),Rt(jt,{onClick:()=>{((e,t,a)=>{const o={TableName:"operation",Key:{user_id:t},UpdateExpression:"REMOVE operations.#operationId",ExpressionAttributeNames:{"#operationId":a}};return e.update(o).promise()})(i,l,e.operationId).then(()=>{r("Operação excluída com sucesso"),t(e,"DB_DELETE"),a(),g()}).catch(e=>{r("Não foi possível excluir a operação"),console.error("Could not delete operation",e)})},autoFocus:!0},"Sim")))),Rt(jt,{onClick:f,variant:"contained",color:"secondary"},"Cancelar"),Rt(jt,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))};var sa=()=>{const{user:{identityId:e}}=n.a.useContext(P),{documentDB:t}=n.a.useContext(A),[a,o]=n.a.useState([]),[r,l]=n.a.useState([]),[i,s]=n.a.useState(30),[c,u]=n.a.useState();n.a.useEffect(()=>{t&&e?((async(e,t)=>{const a={TableName:"operation",Key:{user_id:t},AttributesToGet:["operations"]},o=await e.get(a).promise();return o.Item&&o.Item.operations||{}})(t,e).then(e=>{l(la(Object.entries(e).map(([e,t])=>({operationId:e,...t}))))}).catch(e=>{console.error("Could not retrieve operations",e),l([])}),ve(t,e).then(e=>{o(e)}).catch(e=>{console.error("Could not retrieve assets",e),o([])})):(l([]),o([]))},[t,e]);const d=n.a.useCallback(()=>{u(void 0)},[]),p=n.a.useCallback((e,t)=>{"DB_INSERT"===t?l(t=>la([...t,e])):"DB_UPDATE"===t?l(t=>la(t.map(t=>t.operationId===e.operationId?e:t))):"DB_DELETE"===t&&l(t=>t.filter(t=>t.operationId!==e.operationId))},[]);return Rt(n.a.Fragment,null,Rt(Lt,{margin:1},Rt(jt,{onClick:()=>{u({operationId:null})},variant:"contained"},"Nova operação")),r&&r.length>0&&Rt(aa,{component:Xt,style:{width:"fit-content",maxHeight:"600px"},onScroll:e=>{e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&s(e=>Math.min(r.length,e+30))}},Rt(Zt,{stickyHeader:!0,style:{tableLayout:"auto"}},Rt(oa,null,Rt(na,null,Rt(ta,null,"Tipo"),Rt(ta,null,"Código"),Rt(ta,null,"Data"),Rt(ta,{align:"right"},"Quantidade"),Rt(ta,{align:"right"},"Preço"),Rt(ta,{align:"right"},"Despesas"))),Rt(ea,null,r.slice(0,i).map(e=>{return Rt(na,{key:e.operationId,hover:!0,onClick:()=>(e=>{u(e)})(e)},Rt(ta,null,Ke[e.type]),Rt(ta,null,e.code),Rt(ta,null,(t=e.date,new Date(t).toLocaleDateString())),Rt(ta,{align:"right"},Ie(e.amount)),Rt(ta,{align:"right"},Ie(e.price)),Rt(ta,{align:"right"},Ie(e.expenses)));var t})))),i>30&&i<r.length&&Rt(Lt,{margin:1},Rt(jt,{onClick:()=>{s(r.length)}},"Exibir todas")),c&&Rt(ia,{selectedOperation:c,operationChanged:p,dismissOperationEdition:d,assets:a},null))};const ca=n.a.createElement,{Button:ua,Grid:da}=r;var pa=()=>{const{updatePosition:e,updatePortofolio:t}=Qe();return ca(da,{container:!0,spacing:1},ca(da,{item:!0},ca(ua,{variant:"contained",onClick:()=>{e()},disabled:!e},"Atualizar Posição")),ca(da,{item:!0},ca(ua,{variant:"contained",onClick:()=>{t()},disabled:!t},"Atualizar Portfólio")))};const ma=n.a.createElement,{Button:ga}=r;var ya=[{name:"main",label:"Main",path:"/",hideFromMenu:!0,component:ie,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:pt},{name:"assets",label:"Meus Ativos",path:"/assets",component:Ft},{name:"suggestedAllocation",label:"Novo Aporte",path:"/suggested-allocation",component:qe},{name:"operations",label:"Registro de Operações",path:"/operations",component:sa},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",authorizedGroups:["admin"],component:pa},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:()=>{const{showMessage:e}=n.a.useContext(y),{invokeLambda:t}=n.a.useContext(O),a=n.a.useRef(),{updatePortofolio:o}=Qe(),r=a=>{const n=a.target.result;let r;try{r=n.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,o]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[a]:o}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&t("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),o()}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return ma("form",{ref:a},ma("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>a.current.reset(),t.readAsText(e.target.files[0])},disabled:!t},null),ma("label",{htmlFor:"contained-button-file"},ma(ga,{disabled:!t,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))}},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:me}];const ha=React.createElement,{HashRouter:va,Route:fa,Switch:ba}=window.ReactRouterDOM,{Toolbar:Ca}=MaterialUI,xa=({children:e})=>ha(s,null,ha(g,null,ha(T,null,ha(D,null,ha(B,null,e)))));if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(ha(()=>{const[e,t]=React.useState(!1);return ha(xa,null,ha(va,null,ha(K,{setDrawerOpen:t,routes:ya},null),ha(ne,{routes:ya,drawerOpen:e,setDrawerOpen:t}),ha(Ca,null,null),ha(ba,null,ya.map(e=>ha(fa,{key:e.name+"-route",path:e.path,...e.options},ha(e.component))))))},null,null),document.getElementById("app_container"))}]);
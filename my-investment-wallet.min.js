!function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){const o=React.createElement,{HashRouter:n,NavLink:r,Redirect:i,Route:l,Switch:s,useLocation:c,useParams:u,useHistory:d}=window.ReactRouterDOM,{AppBar:p,Backdrop:m,Box:g,Button:h,CircularProgress:y,Container:v,Chip:f,Divider:b,Dialog:C,DialogActions:x,DialogContent:R,DialogTitle:w,DialogContentText:k,Drawer:P,FormControl:S,Icon:I,IconButton:E,InputLabel:A,Grid:T,ListItem:D,ListItemText:_,Menu:B,MenuItem:N,Paper:O,Select:V,Snackbar:z,Table:M,TableBody:F,TableCell:L,TableContainer:j,TableHead:W,TableRow:$,TextField:U,ThemeProvider:q,Toolbar:Q,Typography:K}=MaterialUI,G="7s3vb9runcfjvgetrvhdfd97at",H="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",J="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",X=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${G}&response_type=code&scope=email+openid+profile&redirect_uri=${J}`,Y=({children:e})=>{const[t]=React.useState(MaterialUI.createMuiTheme({palette:{primary:{main:"#556cd6"}}}));return o(q,{theme:t},e)},Z=React.createContext(),ee=({children:e})=>{const[t,a]=React.useState([]),[n,r]=React.useState(void 0),[i,l]=React.useState(!1);React.useEffect(()=>{t.length&&!n?(r(t[0]),a(e=>e.slice(1)),l(!0)):t.length&&n&&i&&l(!1)},[t,n,i]);const s=React.useCallback(e=>{a(t=>[...t,e])},[]),c=(e,t)=>{"clickaway"!==t&&l(!1)};return o(Z.Provider,{value:{showMessage:s}},e,o(z,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:i,autoHideDuration:5e3,onClose:c,onExited:()=>{r(void 0)},message:n,action:o(E,{color:"inherit",onClick:c},o(I,null,"close"))},null))},te=React.createContext(),ae=({children:e})=>{const[t,a]=React.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[n,r]=React.useState(sessionStorage.getItem("my-investment-wallet-refresh-token")),[i,l]=React.useState(void 0),[s]=React.useState(15e5),[c,u]=React.useState(void 0);React.useEffect(()=>{n?sessionStorage.setItem("my-investment-wallet-refresh-token",n):sessionStorage.removeItem("my-investment-wallet-refresh-token")},[n]);const d=React.useCallback(()=>new Promise(e=>{a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),l(void 0),e()}),[]);React.useEffect(()=>{l(c?e=>e?(e.update({credentials:c}),e):new AWS.Config({region:"us-east-1",credentials:c}):void 0)},[c]);const p=React.useCallback((e,t)=>{const o=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((n,r)=>{o.clearCachedId(),o.getPromise().then(()=>{u(o),a(a=>{const n=e&&JSON.parse(atob(e.split(".")[1]));return a.identityId=o.identityId,a.id=n&&n.sub,a.name=n?n.name:"Usuário não logado",a.email=n&&n.email,a.groups=n&&n["cognito:groups"],a.idToken=e,a.accessToken=t,a}),n()}).catch(e=>{u(void 0),a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),m=React.useCallback(e=>new Promise((t,a)=>{e?fetch(H,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${G}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{p(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),a(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),a(e)}):(console.warn("No refreshToken available"),a(new Error("No refreshToken available")))}),[p]);((e,t)=>{const a=React.useRef(),o=React.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);React.useEffect(()=>(a.current=setInterval(e,t),o),[e,t,o])})(React.useCallback(()=>{m(n).catch(e=>{console.error("Could not refresh tokens",e)})},[n,m]),s);const g=React.useCallback(()=>p(),[p]),h=React.useCallback(e=>new Promise((t,a)=>{fetch(H,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${G}&code=${e}&redirect_uri=${J}`}).then(e=>{e.json().then(e=>{m(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),a(e)})}),[m]);return React.useEffect(()=>{n&&!c&&m(n).catch(e=>{console.error("Could not refresh tokens",e)})},[n,c,m]),o(te.Provider,{value:{user:t,awsConfig:i,awsCredentials:c,loginAnonymously:g,loginWithAuthorizationCode:h,logoff:d}},e)},oe=React.createContext(),ne=({children:e})=>{const{awsConfig:t,awsCredentials:a}=React.useContext(te),[n,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{a&&r(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),o(oe.Provider,{value:{documentDB:n}},e)},re=React.createContext(),ie=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:n}=React.useContext(te),[r,i]=React.useState();React.useEffect(()=>{i(a?new AWS.Lambda(a):void 0)},[a]),React.useEffect(()=>{n&&i(e=>(e&&e.config.update({credentials:n}),e))},[n]);const l=React.useCallback((e,a)=>{const o={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return a&&(o.Payload=JSON.stringify(a)),new Promise((e,t)=>{r.invoke(o).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const o=JSON.parse(a.Payload);o&&o.statusCode&&200===o.statusCode||t(a),e(o.body)}).catch(e=>{t(e)})})},[r,t]);return o(re.Provider,{value:{invokeLambda:r&&l}},e)},le=({children:e})=>o(Y,null,o(ee,null,o(ae,null,o(ne,null,o(ie,null,e))))),se=()=>{const{user:{name:e}}=React.useContext(te);return e?null:o(React.Fragment,null,o(h,{color:"inherit",href:X},"Login"))},ce=()=>{const{showMessage:e}=React.useContext(Z),{user:{name:t},logoff:a}=React.useContext(te),[n,r]=React.useState(!1),i=React.useRef(null);return t?o(React.Fragment,null,o(E,{color:"inherit",ref:i,onClick:()=>{r(!0)}},o(I,null,"account_circle")),o(B,{open:n,onClose:()=>{r(!1)},anchorEl:i.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o(N,{disabled:!0},t),o(b,null,null),o(N,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),r(!1)}},"Logoff"))):null},ue=({setDrawerOpen:e,routes:t})=>{const a=c(),n=t.find(e=>e.path===a.pathname);return o(p,null,o(Q,null,o(E,{edge:"start",color:"inherit",onClick:()=>e(!0)},o(I,null,"menu")),o(K,{style:{flexGrow:1}},n?n.label:""),o(se,null,null),o(ce,null,null)))},de=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:n}}=React.useContext(te),i=()=>a(!1);return o(P,{open:t,onClose:i},o(Q,{onClick:i,style:{padding:"inherit"}},o(D,{button:!0,style:{justifyContent:"space-between",height:"100%"}},o(g,{style:{flex:"auto",textAlign:"center"}},o("img",{src:"https://d3oia8etllorh5.cloudfront.net/us-east-1_SjfN8ExVX/ALL/20200706011733/assets/images/image.jpg",width:"70px",height:"70px"},null)),o(I,null,"chevron_left"))),o(b,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!n&&t.some(e=>n.includes(e));var t}).map(e=>o(D,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:i,...e.options},o(_,{primary:e.label},null))))},pe=()=>o(i,{to:"/target-allocation"},null),me=()=>{const{showMessage:e}=React.useContext(Z),{loginWithAuthorizationCode:t}=React.useContext(te),{authorization_code:a}=u(),[n,r]=React.useState(!0),i=MaterialUI.useTheme(),l=d();return React.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),l.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t),r(!1)})},[a,t,e,l]),o(m,{open:n,style:{zIndex:1+i.zIndex.drawer}},o(y,null,null))},ge=(e,t,a=2)=>new Big(e).plus(t).toFixed(null===a?void 0:a),he=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),ye=(e,t,a=2)=>new Big(e).times(new Big(t)).toFixed(null===a?void 0:a),ve=(e,t,a=Big.DP,o=Big.RM)=>new Big(e).div(new Big(t)).round(a,o).toFixed(a),fe=(e,t)=>new Big(e).cmp(new Big(t))>=0?e:t,be=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),Ce=(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,o)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{o(e)})})},xe=(e,t)=>{const a={TableName:"asset",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,o)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.assets||o(new Error("No assets found for this user id")),t(e.Item&&e.Item.assets)}).catch(e=>{o(e)})})},Re=()=>{const{showMessage:e}=React.useContext(Z),{user:{identityId:t}}=React.useContext(te),{invokeLambda:a}=React.useContext(re),o=React.useCallback(()=>new Promise((o,n)=>{a("update_asset_allocation",{user_id:t}).then(()=>{e("Portfólio atualizado com sucesso"),o()}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t),n(t)})}),[e,t,a]),n=React.useCallback(()=>new Promise((n,r)=>{a("update_position",{user_id:t}).then(()=>{e("Posição atualizada com sucesso"),o().then(()=>{n()}).catch(e=>{r(e)})}).catch(t=>{e("Não foi possível atualizar a posição"),console.error("Position update failed",t),r(t)})}),[e,t,a,o]);return{updatePosition:a&&n,updatePortofolio:a&&o}},we=({setAvailableValue:e})=>{const[t,a]=React.useState(!0);return o("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},o(T,{container:!0,alignItems:"center",spacing:2},o(T,{item:!0,xs:12},o(K,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),o(T,{item:!0},o(U,{name:"availableValue",type:"number",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),a(!0)}catch(e){a(!1)}},error:!t,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)),o(T,{item:!0},o(h,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},ke=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:a}=React.useContext(oe),[o,n]=React.useState(void 0);React.useEffect(()=>{if(a){const o=t.map(t=>`${t}/${e}`);Promise.all(o.map(e=>(async(e,t)=>{const a={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},o=await e.get(a).promise();if(!o.Item||!o.Item.prices)throw new Error("Price data not found");return o.Item.prices[t]})(a,e))).then(e=>{const a=e.reduce((e,a,o)=>({...e,[t[o]]:a}),{});n(a)}).catch(e=>{n(void 0),console.error("Could not get currency exchange rates",e)})}else n(void 0)},[a,e,t]);const r=React.useCallback((t,a)=>a===e?t:ye(t,o[a]),[o,e]),i=React.useCallback((t,a)=>a===e?t:ye(t,ve("1",o[a])),[o,e]);return{toDefaultCurrency:o&&r,backToAssetCurrency:o&&i}},Pe=(e,t)=>parseFloat(e).toLocaleString("pt-BR",{maximumFractionDigits:20,minimumFractionDigits:t&&t}),Se=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(oe),[a,n]=React.useState(void 0),[r,i]=React.useState(void 0),[l,s]=React.useState(void 0),[c]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=ke(c);React.useEffect(()=>{t&&e?Ce(t,e).then(e=>{n({assets:e})}).catch(()=>{n(void 0)}):n(void 0)},[t,e]),React.useEffect(()=>{if(a&&a.assets&&a.assets.length&&r&&u&&d){const e=be(a.assets.map(e=>u(e.value,e.currency))),t=ge(e,r),o=[...a.assets];o.forEach(e=>{var a,o;e.idealFutureValue=d((a=t,o=e.targetPercent,ye(a,ve(o,100,Big.DP))),e.currency)}),o.forEach(e=>{e.idealInvestment=fe("0.00",he(e.idealFutureValue,e.value))});const n=be(o.map(e=>u(e.idealInvestment,e.currency)));o.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,a,o=2)=>ye(e,ve(t,a,Big.DP),o))(u(e.idealInvestment,e.currency),r,n),e.currency)}),o.forEach(e=>{e.investmentQuantity=ye(e.minimum,ve(e.proportionalizedIdealInvestment,ye(e.price,e.minimum,Big.DP),0,0),null)}),o.forEach(e=>{e.investment=ye(e.investmentQuantity,e.price)});const i=be(o.map(e=>u(e.investment,e.currency))),l=he(r,i);o.forEach(e=>{e.futureQuantity=ge(e.quantity,e.investmentQuantity,null)}),o.forEach(e=>{e.futureValue=ye(e.futureQuantity,e.price)});const c=be(o.map(e=>u(e.futureValue,e.currency)));o.forEach(e=>{e.futurePercent=ye("100.00",ve(u(e.futureValue,e.currency),c),4)}),s({assets:o,totalInvestment:i,remainingAvailableValue:l})}else s(void 0)},[a,r,u,d]);const p=l&&l.assets||a&&a.assets;return o(React.Fragment,null,o(we,{setAvailableValue:i},null),o(b,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),p&&o(j,{component:g,style:{width:"fit-content"}},o(M,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},o(W,null,o($,null,o(L,{style:{border:0}}),o(L,{style:{border:0}}),o(L,{align:"center",style:{border:0}},"Posição atual"),l&&o(L,{style:{border:0}}),l&&o(L,{align:"center",style:{border:0}},"Novo aporte"),l&&o(L,{style:{border:0}}),l&&o(L,{align:"center",style:{border:0}},"Posição futura"))),o(F,null,p.map(e=>o($,{key:e.code},o(L,{style:{display:"contents"}},o(g,{component:O,p:2,style:{display:"table-cell",verticalAlign:"middle"}},o(T,{container:!0},o(T,{item:!0,xs:6},o(K,null,e.code)),o(T,{item:!0,xs:6,align:"right"},o(K,{variant:"caption",color:"textSecondary"},e.currency+" "),o(K,{display:"inline"},""+Pe(e.price))),o(T,{item:!0,xs:12},o(f,{size:"small",label:e.name}))))),o(L,{style:{display:"contents"}},o(g,{component:O,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(K,{variant:"caption",color:"textSecondary"},"objetivo"),o(K,null,Pe(e.targetPercent)+"%"))),o(L,{style:{display:"contents"}},o(g,{component:O,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(K,{variant:"caption",display:"block"},Pe(e.quantity)+" cotas"),o(K,{variant:"caption",color:"textSecondary"},e.currency+" "),o(K,{display:"inline"},""+Pe(e.value,2)),o(K,{variant:"body2"},Pe(e.currentPercent)+"%"))),l&&o(L,{padding:"none",align:"center",style:{border:0}},o(I,null,"chevron_right")),l&&o(L,{style:{display:"contents"}},o(g,{component:O,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},o(K,{variant:"caption"},e.code),o(K,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},Pe(e.investmentQuantity)+" cotas"),o(K,{variant:"caption",color:"textSecondary"},e.currency+" "),o(K,{variant:"caption"},""+Pe(e.investment,2)))),l&&o(L,{padding:"none",align:"center",style:{border:0}},o(I,null,"chevron_right")),l&&o(L,{style:{display:"contents"}},o(g,{component:O,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(K,{variant:"caption",display:"block"},Pe(e.futureQuantity)+" cotas"),o(K,{variant:"caption",color:"textSecondary"},e.currency+" "),o(K,{display:"inline"},""+Pe(e.futureValue,2)),o(K,{variant:"body2"},Pe(e.futurePercent)+"%"))))),o($,null,o(L,{style:{border:0}}),o(L,{style:{border:0}}),o(L,{style:{border:0}}),l&&o(L,{style:{border:0}}),l&&o(L,{align:"center",padding:"none",style:{border:0}},o(g,{component:O,p:2,elevation:6,align:"center"},o(K,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),o(K,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),o(K,{display:"inline"},""+Pe(l.totalInvestment,2)),o(b,{light:!0,variant:"fullWidth"},null),o(K,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),o(K,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),o(K,{display:"inline"},""+Pe(l.remainingAvailableValue,2)))),l&&o(L,{style:{border:0}}),l&&o(L,{style:{border:0}}))))))},Ie=e=>e.reduce((e,t)=>{return void 0===e?t:(a=e,o=t,new Big(a).cmp(new Big(o))<0?a:o);var a,o},void 0),Ee=e=>e.reduce((e,t)=>void 0===e?t:fe(e,t),void 0),Ae=e=>{return t=e.map(e=>e.weight),ve(be(t),t.length);var t},Te=e=>be(e.map(e=>e.weight)),De=e=>0===e.length?"0":fe("0",he(Ae(e),ye((10/e.length).toFixed(2),(e=>Ie(e.map(e=>e.weight)))(e)))),_e={"fixed-income":"Renda Fixa",reit:"Imobiliário","stock-picking":"Ações","stocks-fund":"Fundo de Ações",multistrategy:"Multimercado"},Be=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),Ne=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:n}=React.useContext(Z),{user:{identityId:r}}=React.useContext(te),{documentDB:i}=React.useContext(oe),{updatePortofolio:l}=Re(),s=()=>{a()};return o(C,{open:!0,onClose:s,fullWidth:!0,maxWidth:"md"},o("form",{onSubmit:o=>{o.preventDefault();const s=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:o.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const o={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(o).promise()})(i,r,s).then(()=>{n("Pesos atualizados com sucesso"),t(s),a(),l()}).catch(e=>{n("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},o(w,null,"Alterar Pesos"),o(R,null,Be(e).map(t=>{const a=e.filter(e=>e.currency===t);return o(g,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},o(K,{variant:"subtitle1"},t),a.map(e=>o(g,{key:e.category,padding:1,width:e.widthPercent+"%"},o(U,{name:`weight-${t}-${e.category}`,type:"number",defaultValue:e.weight,label:_e[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"center"}}},null))))})),o(x,null,o(h,{onClick:s,variant:"contained",color:"secondary"},"Cancelar"),o(h,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Oe=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(oe),[a,n]=React.useState([]),[r,i]=React.useState([]),[l,s]=React.useState([]),[c,u]=React.useState(!1);React.useEffect(()=>{t&&e?(((e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,o)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{o(e)})})})(t,e).then(e=>{n(e)}).catch(()=>{n([])}),Ce(t,e).then(e=>{i(e)}).catch(()=>{i([])})):(n([]),i([]))},[t,e]),React.useEffect(()=>{if(a&&r){let e=a.map(e=>({...e,currentPercent:be(r.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const t=Te(e);e=e.map(e=>({...e,targetPercent:ve(ye("100",e.weight),t,2)}));const o=Be(a),n=o.map(e=>De(a.filter(t=>t.currency===e))),i=Ee(n),l=Ee(o.map(e=>{const t=a.filter(t=>t.currency===e);return ge(Te(t),ye(i,t.length.toFixed(2)))}));e=e.map(e=>{const t=ge(e.weight,i),a=ve(ye(t,"100"),l,2);return{...e,widthPercent:a}}),s(e)}else s([])},[a,r]);const d=React.useCallback(()=>{u(!1)},[]),p=React.useCallback(e=>{n(e)},[]);return l&&0!==l.length?o(React.Fragment,null,o(v,{maxWidth:!1},o(g,{align:"center",margin:1},o(h,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),Be(a).map(e=>{const t=l.filter(t=>t.currency===e);return o(g,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},o(K,{variant:"h6"},e),t.map(e=>o(g,{component:O,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},o(K,null,_e[e.category]),o(K,{variant:"subtitle1"},Pe(e.weight)),o(T,{container:!0,justify:"space-evenly"},o(T,{item:!0},o(K,{variant:"caption"},Pe(e.currentPercent)+"%"),o(K,{variant:"caption",display:"block",color:"textSecondary"},"atual")),o(T,{item:!0},o(K,{variant:"caption"},Pe(e.targetPercent)+"%"),o(K,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),c&&o(Ne,{allocations:l,updatedAllocations:p,dismissAllocationEdition:d},null)):null},Ve=({selectedAsset:e,allAssetCodes:t,assetChanged:a,dismissAssetEdition:n})=>{const{showMessage:r}=React.useContext(Z),{user:{identityId:i}}=React.useContext(te),{documentDB:l}=React.useContext(oe),[s,c]=React.useState(!1),{updatePosition:u}=Re(),d=null===e.code,p=()=>{n()};return e?o(C,{open:!0,onClose:p},o("form",{onSubmit:t=>{t.preventDefault();const o={currency:t.target.currency.value,category:t.target.category.value,name:t.target.name.value,minimum:t.target.minimum.value,weight:t.target.weight.value},s=d?t.target.code.value:e.code;((e,t,a,o)=>{const n={TableName:"asset",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":o}};return e.update(n).promise()})(l,i,s,o).then(()=>{r(`Ativo ${d?"adicionado":"atualizado"} com sucesso`),a({code:s,...o},d?"DB_INSERT":"DB_UPDATE"),n(),u()}).catch(e=>{r(`Não foi possível ${d?"adicionar":"atualizar"} o ativo`),console.error(`Could not ${d?"add":"update"} asset`,e)})}},o(w,null,""+(d?"Adicionar ativo":"Editar ativo: "+e.code)),o(R,null,o(T,{container:!0,spacing:2},d&&o(T,{item:!0,xs:6},o(U,{name:"code",defaultValue:"",label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(t.includes(e.target.value)?"Código já existente":""),e.target.reportValidity()}},null)),o(T,{item:!0,xs:2},o(U,{name:"currency",defaultValue:e.currency,label:"Moeda",required:!0,variant:"filled",fullWidth:!0},null)),o(T,{item:!0,xs:4},o(S,{fullWidth:!0},o(A,{id:"category-label"},"Categoria"),o(V,{name:"category",defaultValue:e.category||"",labelId:"category-label",required:!0,variant:"filled"},Object.entries(_e).map(([e,t])=>o(N,{key:e,value:e},t))))),o(T,{item:!0,xs:6},o(U,{name:"name",defaultValue:e.name,label:"Nome",required:!0,variant:"filled",fullWidth:!0},null)),o(T,{item:!0,xs:4},o(U,{name:"minimum",type:"number",defaultValue:e.minimum,label:"Qtd mínima",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.00000000000001",style:{textAlign:"right"}}},null)),o(T,{item:!0,xs:2},o(U,{name:"weight",type:"number",defaultValue:e.weight,label:"Peso",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)))),o(x,null,o(g,{style:{flex:"auto"}},!d&&o(h,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&o(C,{open:!0,onClose:()=>c(!1)},o(R,null,o(k,null,`Confirma exclusão do ativo ${e.code}?`)),o(x,null,o(h,{onClick:()=>c(!1)},"Não"),o(h,{onClick:()=>{((e,t,a)=>{const o={TableName:"asset",Key:{user_id:t},UpdateExpression:"REMOVE assets.#assetCode",ExpressionAttributeNames:{"#assetCode":a}};return e.update(o).promise()})(l,i,e.code).then(()=>{r("Ativo excluído com sucesso"),a(e,"DB_DELETE"),n(),u()}).catch(e=>{r("Não foi possível excluir o ativo"),console.error("Could not delete asset",e)})},autoFocus:!0},"Sim")))),o(h,{onClick:p,variant:"contained",color:"secondary"},"Cancelar"),o(h,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},ze=e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency)),Me=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(oe),[a,n]=React.useState([]),[r,i]=React.useState(),l=MaterialUI.useTheme();React.useEffect(()=>{t&&e?xe(t,e).then(e=>{n(ze(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{n([])}):n([])},[t,e]);const s=React.useCallback(()=>{i(void 0)},[]),c=React.useCallback((e,t)=>{"DB_INSERT"===t?n(t=>ze([...t,e])):"DB_UPDATE"===t?n(t=>ze(t.map(t=>t.code===e.code?e:t))):"DB_DELETE"===t&&n(t=>t.filter(t=>t.code!==e.code))},[]);return o(React.Fragment,null,o(g,{margin:1},o(h,{onClick:()=>{i({code:null})},variant:"contained"},"Novo ativo")),a&&0!==a.length?o(j,{component:O,style:{width:"fit-content"}},o(M,{style:{tableLayout:"auto"}},o(W,{style:{backgroundColor:l.palette.background.default}},o($,null,o(L,null,"Moeda"),o(L,null,"Categoria"),o(L,null,"Código"),o(L,null,"Nome"),o(L,{align:"right"},"Qtd mínima"),o(L,{align:"right"},"Peso"))),o(F,null,a.map(e=>o($,{key:e.code,hover:!0,onClick:()=>(e=>{i(e)})(e)},o(L,null,e.currency),o(L,null,_e[e.category]),o(L,null,e.code),o(L,null,e.name),o(L,{align:"right"},Pe(e.minimum)),o(L,{align:"right"},Pe(e.weight)))))),r&&o(Ve,{selectedAsset:r,allAssetCodes:a.map(({code:e})=>e),assetChanged:c,dismissAssetEdition:s},null)):null)},Fe={buy:"Compra",sell:"Venda"},Le=e=>e.sort((e,t)=>t.type.localeCompare(e.type)).sort((e,t)=>t.code.localeCompare(e.code)).sort((e,t)=>t.date.localeCompare(e.date)),je=({selectedOperation:e,operationChanged:t,dismissOperationEdition:a,assets:n})=>{const{showMessage:r}=React.useContext(Z),{user:{identityId:i}}=React.useContext(te),{documentDB:l}=React.useContext(oe),[s,c]=React.useState(!1),[u,d]=React.useState(),[p,m]=React.useState(),{updatePosition:y}=Re(),v=null===e.operationId,f=React.useCallback(e=>{const t=Object.keys(n).includes(e)?n[e].minimum:"1";d(t),m(parseFloat(t)<1?t:"0.01")},[n]);React.useEffect(()=>{f(e.code)},[e.code,f]);const b=()=>{a()};return o(C,{open:!0,onClose:b},o("form",{onSubmit:o=>{o.preventDefault();const n={type:o.target.type.value,code:o.target.code.value,date:o.target.date.value,amount:o.target.amount.value,price:o.target.price.value,expenses:o.target.expenses.value},s=v?uuidv4():e.operationId;((e,t,a,o)=>{const n={TableName:"operation",Key:{user_id:t},UpdateExpression:"set operations.#operationId = :operation",ExpressionAttributeNames:{"#operationId":a},ExpressionAttributeValues:{":operation":o}};return e.update(n).promise()})(l,i,s,n).then(()=>{r(`Operação ${v?"adicionada":"atualizada"} com sucesso`),t({operationId:s,...n},v?"DB_INSERT":"DB_UPDATE"),a(),y()}).catch(e=>{r(`Não foi possível ${v?"adicionar":"atualizar"} a operação`),console.error(`Could not ${v?"add":"update"} operation`,e)})}},o(w,null,(v?"Adicionar":"Editar")+" operação"),o(R,null,o(T,{container:!0,spacing:2},o(T,{item:!0,xs:3},o(S,{fullWidth:!0},o(A,{id:"type-label"},"Tipo"),o(V,{name:"type",defaultValue:e.type||"",labelId:"type-label",required:!0,variant:"filled"},Object.entries(Fe).map(([e,t])=>o(N,{key:e,value:e},t))))),o(T,{item:!0,xs:5},o(U,{name:"code",defaultValue:e.code,label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(Object.keys(n).includes(e.target.value)?"":"Código inexistente"),f(e.target.value)}},null)),o(T,{item:!0,xs:4},o(U,{name:"date",type:"date",defaultValue:e.date,label:"Data",InputLabelProps:{shrink:!0},required:!0,variant:"filled",fullWidth:!0},null)),o(T,{item:!0,xs:12},o(U,{name:"amount",type:"number",defaultValue:e.amount,label:"Quantidade",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:u,style:{textAlign:"right"}}},null)),o(T,{item:!0,xs:12},o(U,{name:"price",type:"number",defaultValue:e.price,label:"Preço",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)),o(T,{item:!0,xs:12},o(U,{name:"expenses",type:"number",defaultValue:e.expenses,label:"Despesas",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)))),o(x,null,o(g,{style:{flex:"auto"}},!v&&o(h,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&o(C,{open:!0,onClose:()=>c(!1)},o(R,null,o(k,null,"Confirma exclusão da operação?")),o(x,null,o(h,{onClick:()=>c(!1)},"Não"),o(h,{onClick:()=>{((e,t,a)=>{const o={TableName:"operation",Key:{user_id:t},UpdateExpression:"REMOVE operations.#operationId",ExpressionAttributeNames:{"#operationId":a}};return e.update(o).promise()})(l,i,e.operationId).then(()=>{r("Operação excluída com sucesso"),t(e,"DB_DELETE"),a(),y()}).catch(e=>{r("Não foi possível excluir a operação"),console.error("Could not delete operation",e)})},autoFocus:!0},"Sim")))),o(h,{onClick:b,variant:"contained",color:"secondary"},"Cancelar"),o(h,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},We=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(oe),[a,n]=React.useState([]),[r,i]=React.useState([]),[l,s]=React.useState(30),[c,u]=React.useState();React.useEffect(()=>{t&&e?(((e,t)=>{const a={TableName:"operation",Key:{user_id:t},AttributesToGet:["operations"]};return new Promise((t,o)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.operations||o(new Error("no operations found for this user id")),t(e.Item&&e.Item.operations)}).catch(e=>{o(e)})})})(t,e).then(e=>{i(Le(Object.entries(e).map(([e,t])=>({operationId:e,...t}))))}).catch(e=>{console.error("Could not retrieve operations",e),i([])}),xe(t,e).then(e=>{n(e)}).catch(e=>{console.error("Could not retrieve assets",e),n([])})):(i([]),n([]))},[t,e]);const d=React.useCallback(()=>{u(void 0)},[]),p=React.useCallback((e,t)=>{"DB_INSERT"===t?i(t=>Le([...t,e])):"DB_UPDATE"===t?i(t=>Le(t.map(t=>t.operationId===e.operationId?e:t))):"DB_DELETE"===t&&i(t=>t.filter(t=>t.operationId!==e.operationId))},[]);return o(React.Fragment,null,o(g,{margin:1},o(h,{onClick:()=>{u({operationId:null})},variant:"contained"},"Nova operação")),r&&r.length>0&&o(j,{component:O,style:{width:"fit-content",maxHeight:"600px"},onScroll:e=>{e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&s(e=>Math.min(r.length,e+30))}},o(M,{stickyHeader:!0,style:{tableLayout:"auto"}},o(W,null,o($,null,o(L,null,"Tipo"),o(L,null,"Código"),o(L,null,"Data"),o(L,{align:"right"},"Quantidade"),o(L,{align:"right"},"Preço"),o(L,{align:"right"},"Despesas"))),o(F,null,r.slice(0,l).map(e=>{return o($,{key:e.operationId,hover:!0,onClick:()=>(e=>{u(e)})(e)},o(L,null,Fe[e.type]),o(L,null,e.code),o(L,null,(t=e.date,new Date(t).toLocaleDateString())),o(L,{align:"right"},Pe(e.amount)),o(L,{align:"right"},Pe(e.price)),o(L,{align:"right"},Pe(e.expenses)));var t})))),l>30&&l<r.length&&o(g,{margin:1},o(h,{onClick:()=>{s(r.length)}},"Exibir todas")),c&&o(je,{selectedOperation:c,operationChanged:p,dismissOperationEdition:d,assets:a},null))},$e=()=>{const{updatePosition:e,updatePortofolio:t}=Re();return o(T,{container:!0,spacing:1},o(T,{item:!0},o(h,{variant:"contained",onClick:()=>{e()},disabled:!e},"Atualizar Posição")),o(T,{item:!0},o(h,{variant:"contained",onClick:()=>{t()},disabled:!t},"Atualizar Portfólio")))},Ue=()=>{const{showMessage:e}=React.useContext(Z),{invokeLambda:t}=React.useContext(re),a=React.useRef(),{updatePortofolio:n}=Re(),r=a=>{const o=a.target.result;let r;try{r=o.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,o]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[a]:o}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&t("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),n()}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return o("form",{ref:a},o("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>a.current.reset(),t.readAsText(e.target.files[0])},disabled:!t},null),o("label",{htmlFor:"contained-button-file"},o(h,{disabled:!t,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(o(()=>{const[e,t]=React.useState(!1),a=[{name:"main",label:"Main",path:"/",hideFromMenu:!0,component:pe,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:Oe},{name:"assets",label:"Meus Ativos",path:"/assets",component:Me},{name:"suggestedAllocation",label:"Novo Aporte",path:"/suggested-allocation",component:Se},{name:"operations",label:"Registro de Operações",path:"/operations",component:We},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",authorizedGroups:["admin"],component:$e},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:Ue},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:me}];return o(le,null,o(n,null,o(ue,{setDrawerOpen:t,routes:a},null),o(de,{routes:a,drawerOpen:e,setDrawerOpen:t}),o(Q,null,null),o(s,null,a.map(e=>o(l,{key:e.name+"-route",path:e.path,...e.options},o(e.component))))))},null,null),document.getElementById("app_container"))}]);
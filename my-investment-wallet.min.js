!function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){const n=React.createElement,{HashRouter:o,NavLink:r,Route:i,Switch:l,useLocation:c,useParams:s,useHistory:u}=window.ReactRouterDOM,{AppBar:d,Box:m,Button:p,createMuiTheme:y,Container:g,Chip:h,Divider:v,Dialog:f,DialogActions:b,DialogContent:C,DialogTitle:R,Drawer:w,Icon:x,IconButton:k,Grid:S,ListItem:P,ListItemText:I,Menu:A,MenuItem:T,Paper:_,Snackbar:E,Table:B,TableBody:D,TableCell:z,TableContainer:N,TableHead:M,TableRow:O,TextField:V,ThemeProvider:F,Toolbar:W,Typography:j}=MaterialUI,L="7s3vb9runcfjvgetrvhdfd97at",$="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",Q="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",U=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${L}&response_type=code&scope=email+openid+profile&redirect_uri=${Q}`,q=({children:e})=>{const[t]=React.useState(y({palette:{primary:{main:"#556cd6"}}}));return n(F,{theme:t},e)},G=React.createContext(),K=({children:e})=>{const[t,a]=React.useState(""),[o,r]=React.useState(!1),i=React.useCallback(e=>{a(e),r(!0)},[]),l=()=>{a(""),r(!1)};return n(G.Provider,{value:{showMessage:i}},e,n(E,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:o,autoHideDuration:5e3,onClose:l,message:t,action:n(k,{color:"inherit",onClick:l},n(x,null,"close"))},null))},H=React.createContext(),J=({children:e})=>{const[t,a]=React.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[o,r]=React.useState(void 0),[i,l]=React.useState(void 0),[c]=React.useState(15e5),[s,u]=React.useState(void 0),d=React.useCallback(()=>new Promise(e=>{a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),l(void 0),e()}),[]);React.useEffect(()=>{l(s?e=>e?(e.update({credentials:s}),e):new AWS.Config({region:"us-east-1",credentials:s}):void 0)},[s]);const m=React.useCallback((e,t)=>{const n=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((o,r)=>{n.clearCachedId(),n.getPromise().then(()=>{u(n),a(a=>{const o=e&&JSON.parse(atob(e.split(".")[1]));return a.identityId=n.identityId,a.id=o&&o.sub,a.name=o?o.name:"Usuário não logado",a.email=o&&o.email,a.groups=o&&o["cognito:groups"],a.idToken=e,a.accessToken=t,a}),o()}).catch(e=>{u(void 0),a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),p=React.useCallback(e=>new Promise((t,a)=>{e?fetch($,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${L}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{m(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),a(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),a(e)}):(console.warn("No refreshToken available"),a(new Error("No refreshToken available")))}),[m]);((e,t)=>{const a=React.useRef(),n=React.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);React.useEffect(()=>(a.current=setInterval(e,t),n),[e,t,n])})(React.useCallback(()=>{p(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,p]),c);const y=React.useCallback(()=>m(),[m]),g=React.useCallback(e=>new Promise((t,a)=>{fetch($,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${L}&code=${e}&redirect_uri=${Q}`}).then(e=>{e.json().then(e=>{p(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),a(e)})}),[p]);return n(H.Provider,{value:{user:t,awsConfig:i,awsCredentials:s,loginAnonymously:y,loginWithAuthorizationCode:g,logoff:d}},e)},X=React.createContext(),Y=({children:e})=>{const{awsConfig:t,awsCredentials:a}=React.useContext(H),[o,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{a&&r(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),n(X.Provider,{value:{documentDB:o}},e)},Z=React.createContext(),ee=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:o}=React.useContext(H),[r,i]=React.useState();React.useEffect(()=>{i(a?new AWS.Lambda(a):void 0)},[a]),React.useEffect(()=>{o&&i(e=>(e&&e.config.update({credentials:o}),e))},[o]);const l=React.useCallback((e,a)=>{const n={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return a&&(n.Payload=JSON.stringify(a)),new Promise((e,t)=>{r.invoke(n).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const n=JSON.parse(a.Payload);n&&n.statusCode&&200===n.statusCode||t(a),e(n.body)}).catch(e=>{t(e)})})},[r,t]);return n(Z.Provider,{value:{invokeLambda:r&&l}},e)},te=({children:e})=>n(q,null,n(K,null,n(J,null,n(Y,null,n(ee,null,e))))),ae=()=>{const{user:{name:e}}=React.useContext(H);return e?null:n(React.Fragment,null,n(p,{color:"inherit",href:U},"Login"))},ne=()=>{const{showMessage:e}=React.useContext(G),{user:{name:t},logoff:a}=React.useContext(H),[o,r]=React.useState(!1),i=React.useRef(null);return t?n(React.Fragment,null,n(k,{color:"inherit",ref:i,onClick:()=>{r(!0)}},n(x,null,"account_circle")),n(A,{open:o,onClose:()=>{r(!1)},anchorEl:i.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},n(T,{disabled:!0},t),n(v,null,null),n(T,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),r(!1)}},"Logoff"))):null},oe=({setDrawerOpen:e,routes:t})=>{const a=c(),o=t.find(e=>e.path===a.pathname);return n(d,null,n(W,null,n(k,{edge:"start",color:"inherit",onClick:()=>e(!0)},n(x,null,"menu")),n(j,{style:{flexGrow:1}},o?o.label:""),n(ae,null,null),n(ne,null,null)))},re=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:o}}=React.useContext(H),i=()=>a(!1);return n(w,{open:t,onClose:i},n(W,{onClick:i,style:{padding:"inherit"}},n(P,{button:!0,style:{justifyContent:"flex-end",height:"100%"}},n(x,null,"chevron_left"))),n(v,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!o&&t.some(e=>o.includes(e));var t}).map(e=>n(P,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:i,...e.options},n(I,{primary:e.label},null))))},ie=()=>n("div",null,null),le=()=>{const{showMessage:e}=React.useContext(G),{loginWithAuthorizationCode:t}=React.useContext(H),{authorization_code:a}=s(),o=u();return React.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),o.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t)})},[a,t,e,o]),n("div",null,null)},ce=(e,t,a=2)=>new Big(e).plus(t).toFixed(null===a?void 0:a),se=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),ue=(e,t,a=2)=>new Big(e).times(new Big(t)).toFixed(null===a?void 0:a),de=(e,t,a=Big.DP,n=Big.RM)=>new Big(e).div(new Big(t)).round(a,n).toFixed(a),me=(e,t)=>new Big(e).cmp(new Big(t))>=0?e:t,pe=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),ye=(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})},ge=({setAvailableValue:e})=>{const[t,a]=React.useState(!0);return n("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},n(S,{container:!0,alignItems:"center",spacing:2},n(S,{item:!0,xs:12},n(j,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),n(S,{item:!0},n(V,{name:"availableValue",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),a(!0)}catch(e){a(!1)}},error:!t},null)),n(S,{item:!0},n(p,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},he=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:a}=React.useContext(X),[n,o]=React.useState(void 0);React.useEffect(()=>{if(a){const n=t.map(t=>`${t}/${e}`);Promise.all(n.map(e=>(async(e,t)=>{const a={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},n=await e.get(a).promise();if(!n.Item||!n.Item.prices)throw new Error("Price data not found");return n.Item.prices[t]})(a,e))).then(e=>{const a=e.reduce((e,a,n)=>({...e,[t[n]]:a}),{});o(a)}).catch(e=>{o(void 0),console.error("Could not get currency exchange rates",e)})}else o(void 0)},[a,e,t]);const r=React.useCallback((t,a)=>a===e?t:ue(t,n[a]),[n,e]),i=React.useCallback((t,a)=>a===e?t:ue(t,de("1",n[a])),[n,e]);return{toDefaultCurrency:n&&r,backToAssetCurrency:n&&i}},ve=()=>{const{user:{identityId:e}}=React.useContext(H),{documentDB:t}=React.useContext(X),[a,o]=React.useState(void 0),[r,i]=React.useState(void 0),[l,c]=React.useState(void 0),[s]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=he(s);React.useEffect(()=>{t&&e?ye(t,e).then(e=>{o({assets:e})}).catch(()=>{o(void 0)}):o(void 0)},[t,e]),React.useEffect(()=>{if(a&&a.assets&&a.assets.length&&r&&u&&d){const e=pe(a.assets.map(e=>u(e.value,e.currency))),t=ce(e,r),n=[...a.assets];n.forEach(e=>{var a,n;e.idealFutureValue=d((a=t,n=e.targetPercent,ue(a,de(n,100,Big.DP))),e.currency)}),n.forEach(e=>{e.idealInvestment=me("0.00",se(e.idealFutureValue,e.value))});const o=pe(n.map(e=>u(e.idealInvestment,e.currency)));n.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,a,n=2)=>ue(e,de(t,a,Big.DP),n))(u(e.idealInvestment,e.currency),r,o),e.currency)}),n.forEach(e=>{e.investmentQuantity=ue(e.minimum,de(e.proportionalizedIdealInvestment,ue(e.price,e.minimum,Big.DP),0,0),null)}),n.forEach(e=>{e.investment=ue(e.investmentQuantity,e.price)});const i=pe(n.map(e=>u(e.investment,e.currency))),l=se(r,i);n.forEach(e=>{e.futureQuantity=ce(e.quantity,e.investmentQuantity,null)}),n.forEach(e=>{e.futureValue=ue(e.futureQuantity,e.price)});const s=pe(n.map(e=>u(e.futureValue,e.currency)));n.forEach(e=>{e.futurePercent=ue("100.00",de(u(e.futureValue,e.currency),s),4)}),c({assets:n,totalInvestment:i,remainingAvailableValue:l})}else c(void 0)},[a,r,u,d]);const p=l&&l.assets||a&&a.assets;return n(React.Fragment,null,n(ge,{setAvailableValue:i},null),n(v,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),p&&n(N,{component:m,style:{width:"fit-content"}},n(B,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},n(M,null,n(O,null,n(z,{style:{border:0}}),n(z,{style:{border:0}}),n(z,{align:"center",style:{border:0}},"Posição atual"),l&&n(z,{style:{border:0}}),l&&n(z,{align:"center",style:{border:0}},"Novo aporte"),l&&n(z,{style:{border:0}}),l&&n(z,{align:"center",style:{border:0}},"Posição futura"))),n(D,null,p.map(e=>n(O,{key:e.code},n(z,{style:{display:"contents"}},n(m,{component:_,p:2,style:{display:"table-cell",verticalAlign:"middle"}},n(S,{container:!0},n(S,{item:!0,xs:6},n(j,null,e.code)),n(S,{item:!0,xs:6,align:"right"},n(j,{variant:"caption",color:"textSecondary"},e.currency+" "),n(j,{display:"inline"},""+e.price)),n(S,{item:!0,xs:12},n(h,{size:"small",label:e.name}))))),n(z,{style:{display:"contents"}},n(m,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(j,{variant:"caption",color:"textSecondary"},"objetivo"),n(j,null,e.targetPercent+"%"))),n(z,{style:{display:"contents"}},n(m,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(j,{variant:"caption",display:"block"},e.quantity+" cotas"),n(j,{variant:"caption",color:"textSecondary"},e.currency+" "),n(j,{display:"inline"},""+e.value),n(j,{variant:"body2"},e.currentPercent+"%"))),l&&n(z,{padding:"none",align:"center",style:{border:0}},n(x,null,"chevron_right")),l&&n(z,{style:{display:"contents"}},n(m,{component:_,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},n(j,{variant:"caption"},e.code),n(j,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},e.investmentQuantity+" cotas"),n(j,{variant:"caption",color:"textSecondary"},e.currency+" "),n(j,{variant:"caption"},""+e.investment))),l&&n(z,{padding:"none",align:"center",style:{border:0}},n(x,null,"chevron_right")),l&&n(z,{style:{display:"contents"}},n(m,{component:_,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(j,{variant:"caption",display:"block"},e.futureQuantity+" cotas"),n(j,{variant:"caption",color:"textSecondary"},e.currency+" "),n(j,{display:"inline"},""+e.futureValue),n(j,{variant:"body2"},e.futurePercent+"%"))))),n(O,null,n(z,{style:{border:0}}),n(z,{style:{border:0}}),n(z,{style:{border:0}}),l&&n(z,{style:{border:0}}),l&&n(z,{align:"center",padding:"none",style:{border:0}},n(m,{component:_,p:2,elevation:6,align:"center"},n(j,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),n(j,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(j,{display:"inline"},""+l.totalInvestment),n(v,{light:!0,variant:"fullWidth"},null),n(j,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),n(j,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),n(j,{display:"inline"},""+l.remainingAvailableValue))),l&&n(z,{style:{border:0}}),l&&n(z,{style:{border:0}}))))))},fe=e=>e.reduce((e,t)=>{return void 0===e?t:(a=e,n=t,new Big(a).cmp(new Big(n))<0?a:n);var a,n},void 0),be=e=>e.reduce((e,t)=>void 0===e?t:me(e,t),void 0),Ce=e=>{return t=e.map(e=>e.weight),de(pe(t),t.length);var t},Re=e=>pe(e.map(e=>e.weight)),we=e=>0===e.length?"0":me("0",se(Ce(e),ue((10/e.length).toFixed(2),(e=>fe(e.map(e=>e.weight)))(e)))),xe={"fixed-income":"renda fixa",reit:"imobiliário","stock-picking":"ações","stocks-fund":"fundo de ações",multistrategy:"multimercado"},ke=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),Se=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:o}=React.useContext(G),{user:{identityId:r}}=React.useContext(H),{documentDB:i}=React.useContext(X),l=()=>{a()};return n(f,{open:!0,onClose:l,fullWidth:!0,maxWidth:"md"},n("form",{onSubmit:n=>{n.preventDefault();const l=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:n.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const n={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(n).promise()})(i,r,l).then(()=>{o("Pesos atualizados com sucesso"),t(l),a()}).catch(e=>{o("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},n(R,null,"Alterar Pesos"),n(C,null,ke(e).map(t=>{const a=e.filter(e=>e.currency===t);return n(m,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},n(j,{variant:"subtitle1"},t),a.map(e=>n(m,{key:e.category,padding:1,width:e.widthPercent+"%"},n(V,{name:`weight-${t}-${e.category}`,defaultValue:e.weight,label:xe[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,style:{textAlign:"center"}}},null))))})),n(b,null,n(p,{onClick:l,variant:"contained",color:"secondary"},"Cancelar"),n(p,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Pe=()=>{const{user:{identityId:e}}=React.useContext(H),{documentDB:t}=React.useContext(X),[a,o]=React.useState([]),[r,i]=React.useState([]),[l,c]=React.useState([]),[s,u]=React.useState(!1);React.useEffect(()=>{t&&e?(((e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{n(e)})})})(t,e).then(e=>{o(e)}).catch(()=>{o([])}),ye(t,e).then(e=>{i(e)}).catch(()=>{i([])})):(o([]),i([]))},[t,e]),React.useEffect(()=>{if(a&&r){let e=a.map(e=>({...e,currentPercent:pe(r.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const t=Re(e);e=e.map(e=>({...e,targetPercent:de(ue("100",e.weight),t,2)}));const n=ke(a),o=n.map(e=>we(a.filter(t=>t.currency===e))),i=be(o),l=be(n.map(e=>{const t=a.filter(t=>t.currency===e);return ce(Re(t),ue(i,t.length.toFixed(2)))}));e=e.map(e=>{const t=ce(e.weight,i),a=de(ue(t,"100"),l,2);return{...e,widthPercent:a}}),c(e)}else c([])},[a,r]);const d=React.useCallback(()=>{u(!1)},[]),y=React.useCallback(e=>{o(e)},[]);return l&&0!==l.length?n(React.Fragment,{},n(g,{maxWidth:!1},n(m,{align:"center",margin:1},n(p,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),ke(a).map(e=>{const t=l.filter(t=>t.currency===e);return n(m,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},n(j,{variant:"h6"},e),t.map(e=>n(m,{component:_,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},n(j,{},xe[e.category]),n(j,{variant:"subtitle1"},e.weight),n(S,{container:!0,justify:"space-evenly"},n(S,{item:!0},n(j,{variant:"caption"},e.currentPercent+"%"),n(j,{variant:"caption",display:"block",color:"textSecondary"},"atual")),n(S,{item:!0},n(j,{variant:"caption"},e.targetPercent+"%"),n(j,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),s&&n(Se,{allocations:l,updatedAllocations:y,dismissAllocationEdition:d},null)):null},Ie=({selectedAsset:e,assetUpdated:t,dismissAssetEdition:a})=>{const{showMessage:o}=React.useContext(G),{user:{identityId:r}}=React.useContext(H),{documentDB:i}=React.useContext(X),l=()=>{a()};return e?n(f,{open:!0,onClose:l},n("form",{onSubmit:n=>{n.preventDefault();const l={currency:n.target.currency.value,category:n.target.category.value,name:n.target.name.value,minimum:n.target.minimum.value,quantity:n.target.quantity.value,weight:n.target.weight.value};((e,t,a,n)=>{const o={TableName:"position",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":n}};return e.update(o).promise()})(i,r,e.code,l).then(()=>{o("Ativo atualizado com sucesso"),t({code:e.code,...l}),a()}).catch(e=>{o("Não foi possível atualizar o ativo"),console.error("Could not update asset position",e)})}},n(R,null,"Editar ativo: "+e.code),n(C,null,n(S,{container:!0,spacing:2},n(S,{item:!0,xs:2},n(V,{name:"currency",defaultValue:e.currency,label:"Moeda",variant:"filled",fullWidth:!0},null)),n(S,{item:!0,xs:4},n(V,{name:"category",defaultValue:e.category,label:"Categoria",variant:"filled",fullWidth:!0},null)),n(S,{item:!0,xs:6},n(V,{name:"name",defaultValue:e.name,label:"Nome",variant:"filled",fullWidth:!0},null)),n(S,{item:!0,xs:3},n(V,{name:"minimum",defaultValue:e.minimum,label:"Qtd mínima",variant:"filled",fullWidth:!0},null)),n(S,{item:!0,xs:3},n(V,{name:"quantity",defaultValue:e.quantity,label:"Qtd atual",variant:"filled",fullWidth:!0},null)),n(S,{item:!0,xs:2},n(V,{name:"weight",defaultValue:e.weight,label:"Peso",variant:"filled",fullWidth:!0},null)))),n(b,null,n(p,{onClick:l,variant:"contained",color:"secondary"},"Cancelar"),n(p,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},Ae=()=>{const{user:{identityId:e}}=React.useContext(H),{documentDB:t}=React.useContext(X),[a,o]=React.useState([]),[r,i]=React.useState(),[l,c]=React.useState(!1);React.useEffect(()=>{t&&e?((e,t)=>{const a={TableName:"position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.assets||n(new Error("no position found for this user id")),t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})})(t,e).then(e=>{o((e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency)))(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{o([])}):o([])},[t,e]);const s=React.useCallback(()=>{c(!1),i(void 0)},[]),u=React.useCallback(e=>{o(t=>t.map(t=>t.code===e.code?e:t))},[]);return a&&0!==a.length?n(N,{component:_,style:{width:"fit-content"}},n(B,{style:{tableLayout:"auto"}},n(M,null,n(O,null,n(z,null,"Moeda"),n(z,null,"Categoria"),n(z,null,"Código"),n(z,null,"Qtd mínima"),n(z,null,"Qtd atual"),n(z,null,"Peso"))),n(D,null,a.map(e=>n(O,{key:e.code,hover:!0,onClick:()=>(e=>{i(e),c(!0)})(e)},n(z,null,e.currency),n(z,null,xe[e.category]),n(z,null,e.code),n(z,null,e.minimum),n(z,null,e.quantity),n(z,null,e.weight))))),l&&n(Ie,{selectedAsset:r,assetUpdated:u,dismissAssetEdition:s},null)):null},Te=(e,t,a)=>{t("update_asset_allocation",{user_id:a}).then(()=>{e("Portfólio atualizado com sucesso")}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t)})},_e=()=>{const{showMessage:e}=React.useContext(G),{user:{identityId:t}}=React.useContext(H),{invokeLambda:a}=React.useContext(Z);return n("div",{},n(p,{variant:"contained",onClick:()=>{Te(e,a,t)},disabled:!a},"Atualizar Portfólio"))},Ee=()=>{const{showMessage:e}=React.useContext(G),{user:{identityId:t}}=React.useContext(H),{invokeLambda:a}=React.useContext(Z),o=React.useRef(),r=n=>{const o=n.target.result;let r;try{r=o.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,n]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[a]:n}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&a("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),Te(e,a,t)}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return n("form",{ref:o},n("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>o.current.reset(),t.readAsText(e.target.files[0])},disabled:!a},null),n("label",{htmlFor:"contained-button-file"},n(p,{disabled:!a,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(n(()=>{const[e,t]=React.useState(!1),a=[{name:"main",label:"Main",path:"/",search:"?login-page=:page&code=:code",component:ie,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:Pe},{name:"position",label:"Posição",path:"/position",component:Ae},{name:"suggestedAllocation",label:"Alocação Sugerida",path:"/suggested-allocation",component:ve},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",component:_e},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:Ee},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:le}];return n(te,null,n(o,null,n(oe,{setDrawerOpen:t,routes:a},null),n(re,{routes:a,drawerOpen:e,setDrawerOpen:t}),n(W,null,null),n(l,null,a.map(e=>n(i,{key:e.name+"-route",path:e.path,...e.options},n(e.component))))))},null,null),document.getElementById("app_container"))}]);
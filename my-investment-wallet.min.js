!function(e){var t={};function a(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,a),o.l=!0,o.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=0)}([function(e,t,a){const n=React.createElement,{HashRouter:o,NavLink:r,Route:l,Switch:i,useLocation:s,useParams:c,useHistory:u}=window.ReactRouterDOM,{AppBar:d,Backdrop:p,Box:m,Button:y,CircularProgress:g,Container:h,Chip:f,Divider:v,Dialog:b,DialogActions:C,DialogContent:R,DialogTitle:x,Drawer:w,FormControl:k,Icon:I,IconButton:S,InputLabel:P,Grid:E,ListItem:T,ListItemText:A,Menu:D,MenuItem:_,Paper:B,Select:N,Snackbar:O,Table:V,TableBody:z,TableCell:M,TableContainer:W,TableFooter:F,TableHead:L,TablePagination:j,TableRow:U,TextField:$,ThemeProvider:Q,Toolbar:q,Typography:K}=MaterialUI,G="7s3vb9runcfjvgetrvhdfd97at",H="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",J="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",X=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${G}&response_type=code&scope=email+openid+profile&redirect_uri=${J}`,Y=({children:e})=>{const[t]=React.useState(MaterialUI.createMuiTheme({palette:{primary:{main:"#556cd6"}}}));return n(Q,{theme:t},e)},Z=React.createContext(),ee=({children:e})=>{const[t,a]=React.useState(""),[o,r]=React.useState(!1),l=React.useCallback(e=>{a(e),r(!0)},[]),i=()=>{a(""),r(!1)};return n(Z.Provider,{value:{showMessage:l}},e,n(O,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:o,autoHideDuration:5e3,onClose:i,message:t,action:n(S,{color:"inherit",onClick:i},n(I,null,"close"))},null))},te=React.createContext(),ae=({children:e})=>{const[t,a]=React.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[o,r]=React.useState(sessionStorage.getItem("my-investment-wallet-refresh-token")),[l,i]=React.useState(void 0),[s]=React.useState(15e5),[c,u]=React.useState(void 0);React.useEffect(()=>{o?sessionStorage.setItem("my-investment-wallet-refresh-token",o):sessionStorage.removeItem("my-investment-wallet-refresh-token")},[o]);const d=React.useCallback(()=>new Promise(e=>{a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),i(void 0),e()}),[]);React.useEffect(()=>{i(c?e=>e?(e.update({credentials:c}),e):new AWS.Config({region:"us-east-1",credentials:c}):void 0)},[c]);const p=React.useCallback((e,t)=>{const n=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((o,r)=>{n.clearCachedId(),n.getPromise().then(()=>{u(n),a(a=>{const o=e&&JSON.parse(atob(e.split(".")[1]));return a.identityId=n.identityId,a.id=o&&o.sub,a.name=o?o.name:"Usuário não logado",a.email=o&&o.email,a.groups=o&&o["cognito:groups"],a.idToken=e,a.accessToken=t,a}),o()}).catch(e=>{u(void 0),a({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),m=React.useCallback(e=>new Promise((t,a)=>{e?fetch(H,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${G}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{p(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),a(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),a(e)}):(console.warn("No refreshToken available"),a(new Error("No refreshToken available")))}),[p]);((e,t)=>{const a=React.useRef(),n=React.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);React.useEffect(()=>(a.current=setInterval(e,t),n),[e,t,n])})(React.useCallback(()=>{m(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,m]),s);const y=React.useCallback(()=>p(),[p]),g=React.useCallback(e=>new Promise((t,a)=>{fetch(H,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${G}&code=${e}&redirect_uri=${J}`}).then(e=>{e.json().then(e=>{m(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),a(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),a(e)})}),[m]);return React.useEffect(()=>{o&&!c&&m(o).catch(e=>{console.error("Could not refresh tokens",e)})},[o,c,m]),n(te.Provider,{value:{user:t,awsConfig:l,awsCredentials:c,loginAnonymously:y,loginWithAuthorizationCode:g,logoff:d}},e)},ne=React.createContext(),oe=({children:e})=>{const{awsConfig:t,awsCredentials:a}=React.useContext(te),[o,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{a&&r(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),n(ne.Provider,{value:{documentDB:o}},e)},re=React.createContext(),le=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:o}=React.useContext(te),[r,l]=React.useState();React.useEffect(()=>{l(a?new AWS.Lambda(a):void 0)},[a]),React.useEffect(()=>{o&&l(e=>(e&&e.config.update({credentials:o}),e))},[o]);const i=React.useCallback((e,a)=>{const n={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return a&&(n.Payload=JSON.stringify(a)),new Promise((e,t)=>{r.invoke(n).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const n=JSON.parse(a.Payload);n&&n.statusCode&&200===n.statusCode||t(a),e(n.body)}).catch(e=>{t(e)})})},[r,t]);return n(re.Provider,{value:{invokeLambda:r&&i}},e)},ie=({children:e})=>n(Y,null,n(ee,null,n(ae,null,n(oe,null,n(le,null,e))))),se=()=>{const{user:{name:e}}=React.useContext(te);return e?null:n(React.Fragment,null,n(y,{color:"inherit",href:X},"Login"))},ce=()=>{const{showMessage:e}=React.useContext(Z),{user:{name:t},logoff:a}=React.useContext(te),[o,r]=React.useState(!1),l=React.useRef(null);return t?n(React.Fragment,null,n(S,{color:"inherit",ref:l,onClick:()=>{r(!0)}},n(I,null,"account_circle")),n(D,{open:o,onClose:()=>{r(!1)},anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},n(_,{disabled:!0},t),n(v,null,null),n(_,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),r(!1)}},"Logoff"))):null},ue=({setDrawerOpen:e,routes:t})=>{const a=s(),o=t.find(e=>e.path===a.pathname);return n(d,null,n(q,null,n(S,{edge:"start",color:"inherit",onClick:()=>e(!0)},n(I,null,"menu")),n(K,{style:{flexGrow:1}},o?o.label:""),n(se,null,null),n(ce,null,null)))},de=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:o}}=React.useContext(te),l=()=>a(!1);return n(w,{open:t,onClose:l},n(q,{onClick:l,style:{padding:"inherit"}},n(T,{button:!0,style:{justifyContent:"flex-end",height:"100%"}},n(I,null,"chevron_left"))),n(v,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!o&&t.some(e=>o.includes(e));var t}).map(e=>n(T,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:l,...e.options},n(A,{primary:e.label},null))))},pe=()=>n("div",null,null),me=()=>{const{showMessage:e}=React.useContext(Z),{loginWithAuthorizationCode:t}=React.useContext(te),{authorization_code:a}=c(),[o,r]=React.useState(!0),l=MaterialUI.useTheme(),i=u();return React.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),i.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t),r(!1)})},[a,t,e,i]),n(p,{open:o,style:{zIndex:1+l.zIndex.drawer}},n(g,null,null))},ye=(e,t,a=2)=>new Big(e).plus(t).toFixed(null===a?void 0:a),ge=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),he=(e,t,a=2)=>new Big(e).times(new Big(t)).toFixed(null===a?void 0:a),fe=(e,t,a=Big.DP,n=Big.RM)=>new Big(e).div(new Big(t)).round(a,n).toFixed(a),ve=(e,t)=>new Big(e).cmp(new Big(t))>=0?e:t,be=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),Ce=(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})},Re=({setAvailableValue:e})=>{const[t,a]=React.useState(!0);return n("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},n(E,{container:!0,alignItems:"center",spacing:2},n(E,{item:!0,xs:12},n(K,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),n(E,{item:!0},n($,{name:"availableValue",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),a(!0)}catch(e){a(!1)}},error:!t},null)),n(E,{item:!0},n(y,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},xe=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:a}=React.useContext(ne),[n,o]=React.useState(void 0);React.useEffect(()=>{if(a){const n=t.map(t=>`${t}/${e}`);Promise.all(n.map(e=>(async(e,t)=>{const a={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},n=await e.get(a).promise();if(!n.Item||!n.Item.prices)throw new Error("Price data not found");return n.Item.prices[t]})(a,e))).then(e=>{const a=e.reduce((e,a,n)=>({...e,[t[n]]:a}),{});o(a)}).catch(e=>{o(void 0),console.error("Could not get currency exchange rates",e)})}else o(void 0)},[a,e,t]);const r=React.useCallback((t,a)=>a===e?t:he(t,n[a]),[n,e]),l=React.useCallback((t,a)=>a===e?t:he(t,fe("1",n[a])),[n,e]);return{toDefaultCurrency:n&&r,backToAssetCurrency:n&&l}},we=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(ne),[a,o]=React.useState(void 0),[r,l]=React.useState(void 0),[i,s]=React.useState(void 0),[c]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=xe(c);React.useEffect(()=>{t&&e?Ce(t,e).then(e=>{o({assets:e})}).catch(()=>{o(void 0)}):o(void 0)},[t,e]),React.useEffect(()=>{if(a&&a.assets&&a.assets.length&&r&&u&&d){const e=be(a.assets.map(e=>u(e.value,e.currency))),t=ye(e,r),n=[...a.assets];n.forEach(e=>{var a,n;e.idealFutureValue=d((a=t,n=e.targetPercent,he(a,fe(n,100,Big.DP))),e.currency)}),n.forEach(e=>{e.idealInvestment=ve("0.00",ge(e.idealFutureValue,e.value))});const o=be(n.map(e=>u(e.idealInvestment,e.currency)));n.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,a,n=2)=>he(e,fe(t,a,Big.DP),n))(u(e.idealInvestment,e.currency),r,o),e.currency)}),n.forEach(e=>{e.investmentQuantity=he(e.minimum,fe(e.proportionalizedIdealInvestment,he(e.price,e.minimum,Big.DP),0,0),null)}),n.forEach(e=>{e.investment=he(e.investmentQuantity,e.price)});const l=be(n.map(e=>u(e.investment,e.currency))),i=ge(r,l);n.forEach(e=>{e.futureQuantity=ye(e.quantity,e.investmentQuantity,null)}),n.forEach(e=>{e.futureValue=he(e.futureQuantity,e.price)});const c=be(n.map(e=>u(e.futureValue,e.currency)));n.forEach(e=>{e.futurePercent=he("100.00",fe(u(e.futureValue,e.currency),c),4)}),s({assets:n,totalInvestment:l,remainingAvailableValue:i})}else s(void 0)},[a,r,u,d]);const p=i&&i.assets||a&&a.assets;return n(React.Fragment,null,n(Re,{setAvailableValue:l},null),n(v,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),p&&n(W,{component:m,style:{width:"fit-content"}},n(V,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},n(L,null,n(U,null,n(M,{style:{border:0}}),n(M,{style:{border:0}}),n(M,{align:"center",style:{border:0}},"Posição atual"),i&&n(M,{style:{border:0}}),i&&n(M,{align:"center",style:{border:0}},"Novo aporte"),i&&n(M,{style:{border:0}}),i&&n(M,{align:"center",style:{border:0}},"Posição futura"))),n(z,null,p.map(e=>n(U,{key:e.code},n(M,{style:{display:"contents"}},n(m,{component:B,p:2,style:{display:"table-cell",verticalAlign:"middle"}},n(E,{container:!0},n(E,{item:!0,xs:6},n(K,null,e.code)),n(E,{item:!0,xs:6,align:"right"},n(K,{variant:"caption",color:"textSecondary"},e.currency+" "),n(K,{display:"inline"},""+e.price)),n(E,{item:!0,xs:12},n(f,{size:"small",label:e.name}))))),n(M,{style:{display:"contents"}},n(m,{component:B,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(K,{variant:"caption",color:"textSecondary"},"objetivo"),n(K,null,e.targetPercent+"%"))),n(M,{style:{display:"contents"}},n(m,{component:B,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(K,{variant:"caption",display:"block"},e.quantity+" cotas"),n(K,{variant:"caption",color:"textSecondary"},e.currency+" "),n(K,{display:"inline"},""+e.value),n(K,{variant:"body2"},e.currentPercent+"%"))),i&&n(M,{padding:"none",align:"center",style:{border:0}},n(I,null,"chevron_right")),i&&n(M,{style:{display:"contents"}},n(m,{component:B,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},n(K,{variant:"caption"},e.code),n(K,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},e.investmentQuantity+" cotas"),n(K,{variant:"caption",color:"textSecondary"},e.currency+" "),n(K,{variant:"caption"},""+e.investment))),i&&n(M,{padding:"none",align:"center",style:{border:0}},n(I,null,"chevron_right")),i&&n(M,{style:{display:"contents"}},n(m,{component:B,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},n(K,{variant:"caption",display:"block"},e.futureQuantity+" cotas"),n(K,{variant:"caption",color:"textSecondary"},e.currency+" "),n(K,{display:"inline"},""+e.futureValue),n(K,{variant:"body2"},e.futurePercent+"%"))))),n(U,null,n(M,{style:{border:0}}),n(M,{style:{border:0}}),n(M,{style:{border:0}}),i&&n(M,{style:{border:0}}),i&&n(M,{align:"center",padding:"none",style:{border:0}},n(m,{component:B,p:2,elevation:6,align:"center"},n(K,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),n(K,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),n(K,{display:"inline"},""+i.totalInvestment),n(v,{light:!0,variant:"fullWidth"},null),n(K,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),n(K,{variant:"caption",color:"textSecondary"},c.defaultCurrency+" "),n(K,{display:"inline"},""+i.remainingAvailableValue))),i&&n(M,{style:{border:0}}),i&&n(M,{style:{border:0}}))))))},ke=e=>e.reduce((e,t)=>{return void 0===e?t:(a=e,n=t,new Big(a).cmp(new Big(n))<0?a:n);var a,n},void 0),Ie=e=>e.reduce((e,t)=>void 0===e?t:ve(e,t),void 0),Se=e=>{return t=e.map(e=>e.weight),fe(be(t),t.length);var t},Pe=e=>be(e.map(e=>e.weight)),Ee=e=>0===e.length?"0":ve("0",ge(Se(e),he((10/e.length).toFixed(2),(e=>ke(e.map(e=>e.weight)))(e)))),Te={"fixed-income":"renda fixa",reit:"imobiliário","stock-picking":"ações","stocks-fund":"fundo de ações",multistrategy:"multimercado"},Ae=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),De=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:o}=React.useContext(Z),{user:{identityId:r}}=React.useContext(te),{documentDB:l}=React.useContext(ne),i=()=>{a()};return n(b,{open:!0,onClose:i,fullWidth:!0,maxWidth:"md"},n("form",{onSubmit:n=>{n.preventDefault();const i=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:n.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const n={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(n).promise()})(l,r,i).then(()=>{o("Pesos atualizados com sucesso"),t(i),a()}).catch(e=>{o("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},n(x,null,"Alterar Pesos"),n(R,null,Ae(e).map(t=>{const a=e.filter(e=>e.currency===t);return n(m,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},n(K,{variant:"subtitle1"},t),a.map(e=>n(m,{key:e.category,padding:1,width:e.widthPercent+"%"},n($,{name:`weight-${t}-${e.category}`,defaultValue:e.weight,label:Te[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,style:{textAlign:"center"}}},null))))})),n(C,null,n(y,{onClick:i,variant:"contained",color:"secondary"},"Cancelar"),n(y,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},_e=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(ne),[a,o]=React.useState([]),[r,l]=React.useState([]),[i,s]=React.useState([]),[c,u]=React.useState(!1);React.useEffect(()=>{t&&e?(((e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{n(e)})})})(t,e).then(e=>{o(e)}).catch(()=>{o([])}),Ce(t,e).then(e=>{l(e)}).catch(()=>{l([])})):(o([]),l([]))},[t,e]),React.useEffect(()=>{if(a&&r){let e=a.map(e=>({...e,currentPercent:be(r.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const t=Pe(e);e=e.map(e=>({...e,targetPercent:fe(he("100",e.weight),t,2)}));const n=Ae(a),o=n.map(e=>Ee(a.filter(t=>t.currency===e))),l=Ie(o),i=Ie(n.map(e=>{const t=a.filter(t=>t.currency===e);return ye(Pe(t),he(l,t.length.toFixed(2)))}));e=e.map(e=>{const t=ye(e.weight,l),a=fe(he(t,"100"),i,2);return{...e,widthPercent:a}}),s(e)}else s([])},[a,r]);const d=React.useCallback(()=>{u(!1)},[]),p=React.useCallback(e=>{o(e)},[]);return i&&0!==i.length?n(React.Fragment,null,n(h,{maxWidth:!1},n(m,{align:"center",margin:1},n(y,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),Ae(a).map(e=>{const t=i.filter(t=>t.currency===e);return n(m,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},n(K,{variant:"h6"},e),t.map(e=>n(m,{component:B,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},n(K,null,Te[e.category]),n(K,{variant:"subtitle1"},e.weight),n(E,{container:!0,justify:"space-evenly"},n(E,{item:!0},n(K,{variant:"caption"},e.currentPercent+"%"),n(K,{variant:"caption",display:"block",color:"textSecondary"},"atual")),n(E,{item:!0},n(K,{variant:"caption"},e.targetPercent+"%"),n(K,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),c&&n(De,{allocations:i,updatedAllocations:p,dismissAllocationEdition:d},null)):null},Be=({selectedAsset:e,assetUpdated:t,dismissAssetEdition:a})=>{const{showMessage:o}=React.useContext(Z),{user:{identityId:r}}=React.useContext(te),{documentDB:l}=React.useContext(ne),i=()=>{a()};return e?n(b,{open:!0,onClose:i},n("form",{onSubmit:n=>{n.preventDefault();const i={currency:n.target.currency.value,category:n.target.category.value,name:n.target.name.value,minimum:n.target.minimum.value,quantity:n.target.quantity.value,weight:n.target.weight.value};((e,t,a,n)=>{const o={TableName:"position",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":n}};return e.update(o).promise()})(l,r,e.code,i).then(()=>{o("Ativo atualizado com sucesso"),t({code:e.code,...i}),a()}).catch(e=>{o("Não foi possível atualizar o ativo"),console.error("Could not update asset position",e)})}},n(x,null,"Editar ativo: "+e.code),n(R,null,n(E,{container:!0,spacing:2},n(E,{item:!0,xs:2},n($,{name:"currency",defaultValue:e.currency,label:"Moeda",variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:4},n($,{name:"category",defaultValue:e.category,label:"Categoria",variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:6},n($,{name:"name",defaultValue:e.name,label:"Nome",variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:3},n($,{name:"minimum",defaultValue:e.minimum,label:"Qtd mínima",variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:3},n($,{name:"quantity",defaultValue:e.quantity,label:"Qtd atual",variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:2},n($,{name:"weight",defaultValue:e.weight,label:"Peso",variant:"filled",fullWidth:!0},null)))),n(C,null,n(y,{onClick:i,variant:"contained",color:"secondary"},"Cancelar"),n(y,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},Ne=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(ne),[a,o]=React.useState([]),[r,l]=React.useState(),[i,s]=React.useState(!1);React.useEffect(()=>{t&&e?((e,t)=>{const a={TableName:"position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.assets||n(new Error("no position found for this user id")),t(e.Item&&e.Item.assets)}).catch(e=>{n(e)})})})(t,e).then(e=>{o((e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency)))(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{o([])}):o([])},[t,e]);const c=React.useCallback(()=>{s(!1),l(void 0)},[]),u=React.useCallback(e=>{o(t=>t.map(t=>t.code===e.code?e:t))},[]);return a&&0!==a.length?n(W,{component:B,style:{width:"fit-content"}},n(V,{style:{tableLayout:"auto"}},n(L,null,n(U,null,n(M,null,"Moeda"),n(M,null,"Categoria"),n(M,null,"Código"),n(M,null,"Qtd mínima"),n(M,null,"Qtd atual"),n(M,null,"Peso"))),n(z,null,a.map(e=>n(U,{key:e.code,hover:!0,onClick:()=>(e=>{l(e),s(!0)})(e)},n(M,null,e.currency),n(M,null,Te[e.category]),n(M,null,e.code),n(M,null,e.minimum),n(M,null,e.quantity),n(M,null,e.weight))))),i&&n(Be,{selectedAsset:r,assetUpdated:u,dismissAssetEdition:c},null)):null},Oe={buy:"Compra",sell:"Venda"},Ve=e=>e.sort((e,t)=>t.type.localeCompare(e.type)).sort((e,t)=>t.code.localeCompare(e.code)).sort((e,t)=>t.date.localeCompare(e.date)),ze=({selectedOperation:e,operationChanged:t,dismissOperationEdition:a})=>{const{showMessage:o}=React.useContext(Z),{user:{identityId:r}}=React.useContext(te),{documentDB:l}=React.useContext(ne),i=null===e.operationId,s=()=>{a()};return n(b,{open:!0,onClose:s},n("form",{onSubmit:n=>{n.preventDefault();const s={type:n.target.type.value,code:n.target.code.value,date:n.target.date.value,amount:n.target.amount.value,price:n.target.price.value,expenses:n.target.expenses.value},c=i?uuidv4():e.operationId;((e,t,a,n)=>{const o={TableName:"operation",Key:{user_id:t},UpdateExpression:"set operations.#operationId = :operation",ExpressionAttributeNames:{"#operationId":a},ExpressionAttributeValues:{":operation":n}};return e.update(o).promise()})(l,r,c,s).then(()=>{o(`Operação ${i?"adicionada":"atualizada"} com sucesso`),t({operationId:c,...s},i?"DB_INSERT":"DB_UPDATE"),a()}).catch(e=>{o(`Não foi possível ${i?"adicionar":"atualizar"} a operação`),console.error(`Could not ${i?"add":"update"} operation`,e)})}},n(x,null,(i?"Adicionar":"Editar")+" operação"),n(R,null,n(E,{container:!0,spacing:2},n(E,{item:!0,xs:3},n(k,{fullWidth:!0},n(P,{id:"type-label"},"Tipo"),n(N,{name:"type",defaultValue:e.type||"",labelId:"type-label",required:!0,variant:"filled"},Object.entries(Oe).map(([e,t])=>n(_,{key:e,value:e},t))))),n(E,{item:!0,xs:4},n($,{name:"code",defaultValue:e.code,label:"Código",required:!0,variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:5},n($,{name:"date",defaultValue:e.date,label:"Data",required:!0,variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:3},n($,{name:"amount",defaultValue:e.amount,label:"Quantidade",required:!0,variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:3},n($,{name:"price",defaultValue:e.price,label:"Preço",required:!0,variant:"filled",fullWidth:!0},null)),n(E,{item:!0,xs:3},n($,{name:"expenses",defaultValue:e.expenses,label:"Despesas",required:!0,variant:"filled",fullWidth:!0},null)))),n(C,null,n(m,{style:{flex:"auto"}},n(y,{onClick:()=>{((e,t,a)=>{const n={TableName:"operation",Key:{user_id:t},UpdateExpression:"REMOVE operations.#operationId",ExpressionAttributeNames:{"#operationId":a}};return e.update(n).promise()})(l,r,e.operationId).then(()=>{o("Operação excluída com sucesso"),t(e,"DB_DELETE"),a()}).catch(e=>{o("Não foi possível excluir a operação"),console.error("Could not delete operation",e)})},variant:"outlined",color:"secondary"},"Excluir")),n(y,{onClick:s,variant:"contained",color:"secondary"},"Cancelar"),n(y,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Me=()=>{const{user:{identityId:e}}=React.useContext(te),{documentDB:t}=React.useContext(ne),[a,o]=React.useState([]),[r,l]=React.useState(30),[i,s]=React.useState();React.useEffect(()=>{t&&e?((e,t)=>{const a={TableName:"operation",Key:{user_id:t},AttributesToGet:["operations"]};return new Promise((t,n)=>{e.get(a).promise().then(e=>{e.Item&&e.Item.operations||n(new Error("no operations found for this user id")),t(e.Item&&e.Item.operations)}).catch(e=>{n(e)})})})(t,e).then(e=>{o(Ve(Object.entries(e).map(([e,t])=>({operationId:e,...t}))))}).catch(e=>{console.error("Could not retrieve operations",e),o([])}):o([])},[t,e]);const c=React.useCallback(()=>{s(void 0)},[]),u=React.useCallback((e,t)=>{"DB_INSERT"===t?o(t=>Ve([...t,e])):"DB_UPDATE"===t?o(t=>Ve(t.map(t=>t.operationId===e.operationId?e:t))):"DB_DELETE"===t&&o(t=>t.filter(t=>t.operationId!==e.operationId))},[]);return n(React.Fragment,null,n(m,{margin:1},n(y,{onClick:()=>{s({operationId:null})},variant:"contained"},"Nova operação")),a&&a.length>0&&n(W,{component:B,style:{width:"fit-content",maxHeight:"600px"},onScroll:e=>{e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&l(e=>Math.min(a.length,e+30))}},n(V,{stickyHeader:!0,style:{tableLayout:"auto"}},n(L,null,n(U,null,n(M,null,"Tipo"),n(M,null,"Código"),n(M,null,"Data"),n(M,null,"Quantidade"),n(M,null,"Preço"),n(M,null,"Despesas"))),n(z,null,a.slice(0,r).map(e=>n(U,{key:e.operationId,hover:!0,onClick:()=>(e=>{s(e)})(e)},n(M,null,Oe[e.type]),n(M,null,e.code),n(M,null,e.date),n(M,null,e.amount),n(M,null,e.price),n(M,null,e.expenses)))))),r>30&&r<a.length&&n(m,{margin:1},n(y,{onClick:()=>{l(a.length)}},"Exibir todas")),i&&n(ze,{selectedOperation:i,operationChanged:u,dismissOperationEdition:c},null))},We=(e,t,a)=>{t("update_asset_allocation",{user_id:a}).then(()=>{e("Portfólio atualizado com sucesso")}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t)})},Fe=()=>{const{showMessage:e}=React.useContext(Z),{user:{identityId:t}}=React.useContext(te),{invokeLambda:a}=React.useContext(re);return n("div",null,n(y,{variant:"contained",onClick:()=>{We(e,a,t)},disabled:!a},"Atualizar Portfólio"))},Le=()=>{const{showMessage:e}=React.useContext(Z),{user:{identityId:t}}=React.useContext(te),{invokeLambda:a}=React.useContext(re),o=React.useRef(),r=n=>{const o=n.target.result;let r;try{r=o.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,n]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[a]:n}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&a("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),We(e,a,t)}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return n("form",{ref:o},n("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>o.current.reset(),t.readAsText(e.target.files[0])},disabled:!a},null),n("label",{htmlFor:"contained-button-file"},n(y,{disabled:!a,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(n(()=>{const[e,t]=React.useState(!1),a=[{name:"main",label:"Main",path:"/",search:"?login-page=:page&code=:code",component:pe,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:_e},{name:"operations",label:"Operações",path:"/operations",component:Me},{name:"position",label:"Posição",path:"/position",component:Ne},{name:"suggestedAllocation",label:"Alocação Sugerida",path:"/suggested-allocation",component:we},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",component:Fe},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:Le},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:me}];return n(ie,null,n(o,null,n(ue,{setDrawerOpen:t,routes:a},null),n(de,{routes:a,drawerOpen:e,setDrawerOpen:t}),n(q,null,null),n(i,null,a.map(e=>n(l,{key:e.name+"-route",path:e.path,...e.options},n(e.component))))))},null,null),document.getElementById("app_container"))}]);
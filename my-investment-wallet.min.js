!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const o=React.createElement,{HashRouter:a,NavLink:r,Route:l,Switch:i,useLocation:c,useParams:s,useHistory:u}=window.ReactRouterDOM,{AppBar:d,Box:p,Button:m,createMuiTheme:v,Chip:h,Divider:y,Drawer:f,Icon:g,IconButton:b,Grid:C,ListItem:R,ListItemText:w,Menu:x,MenuItem:k,Paper:S,Snackbar:P,Table:T,TableBody:_,TableCell:A,TableContainer:I,TableHead:B,TableRow:E,TextField:z,ThemeProvider:O,Toolbar:D,Typography:N}=MaterialUI,M="7s3vb9runcfjvgetrvhdfd97at",L="https://carteira-investimentos.auth.us-east-1.amazoncognito.com/oauth2/token",F="https://seuvitor.github.io/my-investment-wallet/?auth-redirect",j=`https://carteira-investimentos.auth.us-east-1.amazoncognito.com/login?client_id=${M}&response_type=code&scope=email+openid+profile&redirect_uri=${F}`,V=({children:e})=>{const[t]=React.useState(v({palette:{primary:{main:"#556cd6"},secondary:{main:"#19857b"}}}));return o(O,{theme:t},e)},$=React.createContext(),Q=({children:e})=>{const[t,n]=React.useState(""),[a,r]=React.useState(!1),l=React.useCallback(e=>{n(e),r(!0)},[]),i=()=>{n(""),r(!1)};return o($.Provider,{value:{showMessage:l}},e,o(P,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:a,autoHideDuration:5e3,onClose:i,message:t,action:o(b,{color:"inherit",onClick:i},o(g,null,"close"))},null))},W=React.createContext(),U=({children:e})=>{const[t,n]=React.useState({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[a,r]=React.useState(void 0),[l,i]=React.useState(void 0),[c]=React.useState(15e5),[s,u]=React.useState(void 0),d=React.useCallback(()=>new Promise(e=>{n({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),r(void 0),i(void 0),e()}),[]);React.useEffect(()=>{i(s?e=>e?(e.update({credentials:s}),e):new AWS.Config({region:"us-east-1",credentials:s}):void 0)},[s]);const p=React.useCallback((e,t)=>{const o=new AWS.CognitoIdentityCredentials({IdentityPoolId:"us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",...e&&{Logins:{"cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX":e}}},{region:"us-east-1"});return new Promise((a,r)=>{o.clearCachedId(),o.getPromise().then(()=>{u(o),n(n=>{const o=e&&JSON.parse(atob(e.split(".")[1]));return n.id=o&&o.sub,n.name=o?o.name:"Usuário não logado",n.email=o&&o.email,n.groups=o&&o["cognito:groups"],n.idToken=e,n.accessToken=t,n}),a()}).catch(e=>{u(void 0),n({id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),r(e)})})},[]),m=React.useCallback(e=>new Promise((t,n)=>{e?fetch(L,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${M}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{p(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),n(e)})}).catch(e=>{console.error("Could not decode authentication response",e),n(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),n(e)}):(console.warn("No refreshToken available"),n(new Error("No refreshToken available")))}),[p]);((e,t)=>{const n=React.useRef(),o=React.useCallback(()=>{const e=n.current;e&&(n.current=void 0,clearInterval(e))},[n]);React.useEffect(()=>(n.current=setInterval(e,t),o),[e,t,o])})(React.useCallback(()=>{m(a).catch(e=>{console.error("Could not refresh tokens",e)})},[a,m]),c);const v=React.useCallback(()=>p(),[p]),h=React.useCallback(e=>new Promise((t,n)=>{fetch(L,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${M}&code=${e}&redirect_uri=${F}`}).then(e=>{e.json().then(e=>{m(e.refresh_token).then(()=>{r(e.refresh_token),t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),r(void 0),n(e)})}).catch(e=>{console.error("Could not decode authentication response",e),r(void 0),n(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),r(void 0),n(e)})}),[m]);return o(W.Provider,{value:{user:t,awsConfig:l,awsCredentials:s,loginAnonymously:v,loginWithAuthorizationCode:h,logoff:d}},e)},G=React.createContext(),q=({children:e})=>{const{awsConfig:t,awsCredentials:n}=React.useContext(W),[a,r]=React.useState();return React.useEffect(()=>{r(t?new AWS.DynamoDB.DocumentClient(t):void 0)},[t]),React.useEffect(()=>{n&&r(e=>(e&&e.service.config.update({credentials:n}),e))},[n]),o(G.Provider,{value:{documentDB:a}},e)},H=React.createContext(),J=({children:e})=>{const{user:{accessToken:t},awsConfig:n,awsCredentials:a}=React.useContext(W),[r,l]=React.useState();React.useEffect(()=>{l(n?new AWS.Lambda(n):void 0)},[n]),React.useEffect(()=>{a&&l(e=>(e&&e.config.update({credentials:a}),e))},[a]);const i=React.useCallback((e,n)=>{const o={FunctionName:e,ClientContext:btoa(JSON.stringify({accessToken:t}))};return n&&(o.Payload=JSON.stringify(n)),new Promise((e,t)=>{r.invoke(o).promise().then(n=>{n.StatusCode&&200===n.StatusCode&&n.Payload||t(n);const o=JSON.parse(n.Payload);o&&o.statusCode&&200===o.statusCode||t(n),e(o.body)}).catch(e=>{t(e)})})},[r,t]);return o(H.Provider,{value:{invokeLambda:r&&i}},e)},K=({children:e})=>o(V,null,o(Q,null,o(U,null,o(q,null,o(J,null,e))))),X=()=>{const{user:{name:e}}=React.useContext(W);return e?null:o(React.Fragment,null,o(m,{color:"inherit",href:j},"Login"))},Y=()=>{const{showMessage:e}=React.useContext($),{user:{name:t},logoff:n}=React.useContext(W),[a,r]=React.useState(!1),l=React.useRef(null);return t?o(React.Fragment,null,o(b,{color:"inherit",ref:l,onClick:()=>{r(!0)}},o(g,null,"account_circle")),o(x,{open:a,onClose:()=>{r(!1)},anchorEl:l.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o(k,{disabled:!0},t),o(y,null,null),o(k,{onClick:()=>{n().then(()=>{e("Logoff succesful")}).catch(()=>{e("Logoff failed")}),r(!1)}},"Logoff"))):null},Z=({setDrawerOpen:e,routes:t})=>{const n=c(),a=t.find(e=>e.path===n.pathname);return o(d,null,o(D,null,o(b,{edge:"start",color:"inherit",onClick:()=>e(!0)},o(g,null,"menu")),o(N,{style:{flexGrow:1}},a?a.label:""),o(X,null,null),o(Y,null,null)))},ee=({routes:e,drawerOpen:t,setDrawerOpen:n})=>{const{user:{groups:a}}=React.useContext(W),l=()=>n(!1);return o(f,{open:t,onClose:l},o(D,{onClick:l,style:{padding:"inherit"}},o(R,{button:!0,style:{justifyContent:"flex-end",height:"100%"}},o(g,null,"chevron_left"))),o(y,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!a&&t.some(e=>a.includes(e));var t}).map(e=>o(R,{key:e.name+"-route-drawer-item",button:!0,component:r,activeClassName:"Mui-selected",to:e.path,onClick:l,...e.options},o(w,{primary:e.label},null))))},te=()=>o("div",null,null),ne=()=>{const{showMessage:e}=React.useContext($),{loginWithAuthorizationCode:t}=React.useContext(W),{authorization_code:n}=s(),a=u();return React.useEffect(()=>{t(n).then(()=>{e("Usuário logado com sucesso"),a.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Não foi possível completar o login",t)})},[n,t,e,a]),o("div",null,null)},oe=(e,t,n=2)=>new Big(e).plus(t).toFixed(null===n?void 0:n),ae=(e,t)=>new Big(e).minus(new Big(t)).toFixed(2),re=(e,t,n=2)=>new Big(e).times(new Big(t)).toFixed(null===n?void 0:n),le=(e,t,n=Big.DP,o=Big.RM)=>new Big(e).div(new Big(t)).round(n,o).toFixed(n),ie=e=>e.map(e=>new Big(e)).reduce((e,t)=>e.plus(t),new Big(0)).toFixed(2),ce=({setAvailableValue:e})=>{const[t,n]=React.useState(!0);return o("form",{onSubmit:t=>{t.preventDefault(),e(t.target.availableValue.value)}},o(C,{container:!0,alignItems:"center",spacing:2},o(C,{item:!0,xs:12},o(N,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),o(C,{item:!0},o(z,{name:"availableValue",label:"Valor disponível",variant:"filled",onChange:e=>{try{Big(e.target.value),n(!0)}catch(e){n(!1)}},error:!t},null)),o(C,{item:!0},o(m,{type:"submit",variant:"contained",color:"primary",disabled:!t},"Calcular aportes"))))},se=({defaultCurrency:e,otherCurrencies:t})=>{const{documentDB:n}=React.useContext(G),[o,a]=React.useState(void 0);React.useEffect(()=>{if(n){const o=t.map(t=>`${t}/${e}`);Promise.all(o.map(e=>(async(e,t)=>{const n={TableName:"price",Key:{timestamp:"now"},ProjectionExpression:"prices.#assetCode",ExpressionAttributeNames:{"#assetCode":t}},o=await e.get(n).promise();if(!o.Item||!o.Item.prices)throw new Error("Price data not found");return o.Item.prices[t]})(n,e))).then(e=>{const n=e.reduce((e,n,o)=>({...e,[t[o]]:n}),{});a(n)}).catch(e=>{a(void 0),console.error("Could not get currency exchange rates",e)})}else a(void 0)},[n,e,t]);const r=React.useCallback((t,n)=>n===e?t:re(t,o[n]),[o,e]),l=React.useCallback((t,n)=>n===e?t:re(t,le("1",o[n])),[o,e]);return{toDefaultCurrency:o&&r,backToAssetCurrency:o&&l}},ue=()=>{const{user:{id:e}}=React.useContext(W),{documentDB:t}=React.useContext(G),[n,a]=React.useState(void 0),[r,l]=React.useState(void 0),[i,c]=React.useState(void 0),[s]=React.useState({defaultCurrency:"BRL",otherCurrencies:["USD"]}),{toDefaultCurrency:u,backToAssetCurrency:d}=se(s);React.useEffect(()=>{t&&e?((e,t)=>{const n={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]};return new Promise((t,o)=>{e.get(n).promise().then(e=>{t(e.Item&&e.Item.assets)}).catch(e=>{o(e)})})})(t,e).then(e=>{a({assets:e})}).catch(()=>{a(void 0)}):a(void 0)},[t,e]),React.useEffect(()=>{if(n&&n.assets&&n.assets.length&&r&&u&&d){const e=ie(n.assets.map(e=>u(e.value,e.currency))),t=oe(e,r),o=[...n.assets];o.forEach(e=>{var n,o;e.idealFutureValue=d((n=t,o=e.targetPercent,re(n,le(o,100,Big.DP))),e.currency)}),o.forEach(e=>{var t,n;e.idealInvestment=(t="0.00",n=ae(e.idealFutureValue,e.value),new Big(t).cmp(new Big(n))>=0?t:n)});const a=ie(o.map(e=>u(e.idealInvestment,e.currency)));o.forEach(e=>{e.proportionalizedIdealInvestment=d(((e,t,n,o=2)=>re(e,le(t,n,Big.DP),o))(u(e.idealInvestment,e.currency),r,a),e.currency)}),o.forEach(e=>{e.investmentQuantity=re(e.minimum,le(e.proportionalizedIdealInvestment,re(e.price,e.minimum,Big.DP),0,0),null)}),o.forEach(e=>{e.investment=re(e.investmentQuantity,e.price)});const l=ie(o.map(e=>u(e.investment,e.currency))),i=ae(r,l);o.forEach(e=>{e.futureQuantity=oe(e.quantity,e.investmentQuantity,null)}),o.forEach(e=>{e.futureValue=re(e.futureQuantity,e.price)});const s=ie(o.map(e=>u(e.futureValue,e.currency)));o.forEach(e=>{e.futurePercent=re("100.00",le(u(e.futureValue,e.currency),s),4)}),c({assets:o,totalInvestment:l,remainingAvailableValue:i})}else c(void 0)},[n,r,u,d]);const m=i&&i.assets||n&&n.assets;return o(React.Fragment,null,o(ce,{setAvailableValue:l},null),o(y,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),m&&o(I,{component:p,style:{width:"fit-content"}},o(T,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},o(B,null,o(E,null,o(A,{style:{border:0}}),o(A,{style:{border:0}}),o(A,{align:"center",style:{border:0}},"Posição atual"),i&&o(A,{style:{border:0}}),i&&o(A,{align:"center",style:{border:0}},"Novo aporte"),i&&o(A,{style:{border:0}}),i&&o(A,{align:"center",style:{border:0}},"Posição futura"))),o(_,null,m.map(e=>o(E,{key:e.code},o(A,{style:{display:"contents"}},o(p,{component:S,p:2,style:{display:"table-cell",verticalAlign:"middle"}},o(C,{container:!0},o(C,{item:!0,xs:6},o(N,null,e.code)),o(C,{item:!0,xs:6,align:"right"},o(N,{variant:"caption",color:"textSecondary"},e.currency+" "),o(N,{display:"inline"},""+e.price)),o(C,{item:!0,xs:12},o(h,{size:"small",label:e.name}))))),o(A,{style:{display:"contents"}},o(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(N,{variant:"caption",color:"textSecondary"},"objetivo"),o(N,null,e.targetPercent+"%"))),o(A,{style:{display:"contents"}},o(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(N,{variant:"caption",display:"block"},e.quantity+" cotas"),o(N,{variant:"caption",color:"textSecondary"},e.currency+" "),o(N,{display:"inline"},""+e.value),o(N,{variant:"body2"},e.currentPercent+"%"))),i&&o(A,{padding:"none",align:"center",style:{border:0}},o(g,null,"chevron_right")),i&&o(A,{style:{display:"contents"}},o(p,{component:S,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},o(N,{variant:"caption"},e.code),o(N,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},e.investmentQuantity+" cotas"),o(N,{variant:"caption",color:"textSecondary"},e.currency+" "),o(N,{variant:"caption"},""+e.investment))),i&&o(A,{padding:"none",align:"center",style:{border:0}},o(g,null,"chevron_right")),i&&o(A,{style:{display:"contents"}},o(p,{component:S,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},o(N,{variant:"caption",display:"block"},e.futureQuantity+" cotas"),o(N,{variant:"caption",color:"textSecondary"},e.currency+" "),o(N,{display:"inline"},""+e.futureValue),o(N,{variant:"body2"},e.futurePercent+"%"))))),o(E,null,o(A,{style:{border:0}}),o(A,{style:{border:0}}),o(A,{style:{border:0}}),i&&o(A,{style:{border:0}}),i&&o(A,{align:"center",padding:"none",style:{border:0}},o(p,{component:S,p:2,elevation:6,align:"center"},o(N,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),o(N,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),o(N,{display:"inline"},""+i.totalInvestment),o(y,{light:!0,variant:"fullWidth"},null),o(N,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),o(N,{variant:"caption",color:"textSecondary"},s.defaultCurrency+" "),o(N,{display:"inline"},""+i.remainingAvailableValue))),i&&o(A,{style:{border:0}}),i&&o(A,{style:{border:0}}))))))},de=()=>{const{user:{id:e}}=React.useContext(W),{documentDB:t}=React.useContext(G),[n,a]=React.useState([]);return React.useEffect(()=>{t&&e?((e,t)=>{const n={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]};return new Promise((t,o)=>{e.get(n).promise().then(e=>{t(e.Item&&e.Item.allocations)}).catch(e=>{o(e)})})})(t,e).then(e=>{a(e)}).catch(()=>{a([])}):a([])},[t,e]),n&&0!==n.length?o(I,{component:S,style:{width:"fit-content"}},o(T,{style:{tableLayout:"auto"}},o(B,null,o(E,null,o(A,null,"Categoria"),o(A,null,"Moeda"),o(A,null,"Objetivo"))),o(_,null,n.map(({category:e,currency:t,percent:n})=>o(E,{key:`${e}|${t}`},o(A,null,e),o(A,null,t),o(A,null,n+"%")))))):null},pe=(e,t,n)=>{t("update_asset_allocation",{user_id:n}).then(()=>{e("Portfólio atualizado com sucesso")}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Não foi possível atualizar o portfólio",t)})},me=()=>{const{showMessage:e}=React.useContext($),{user:t}=React.useContext(W),{invokeLambda:n}=React.useContext(H);return o("div",{},o(m,{variant:"contained",onClick:()=>{pe(e,n,t.id)},disabled:!n},"Atualizar Portfólio"))},ve=()=>{const{showMessage:e}=React.useContext($),{user:t}=React.useContext(W),{invokeLambda:n}=React.useContext(H),a=React.useRef(),r=o=>{const a=o.target.result;let r;try{r=a.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[n,o]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return{...e,[n]:o}},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("Não foi possível carregar o arquivo",t)}r&&n("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),pe(e,n,t.id)}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Não foi possível atualizar os preços",t)})};return o("form",{ref:a},o("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=r,t.onloadend=()=>a.current.reset(),t.readAsText(e.target.files[0])},disabled:!n},null),o("label",{htmlFor:"contained-button-file"},o(m,{disabled:!n,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))};if("/my-investment-wallet/"===window.location.pathname){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"","/my-investment-wallet/#/authentication/"+e.get("code"))}ReactDOM.render(o(()=>{const[e,t]=React.useState(!1),n=[{name:"main",label:"Main",path:"/",search:"?login-page=:page&code=:code",component:te,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:de},{name:"suggestedAllocation",label:"Alocação Sugerida",path:"/suggested-allocation",component:ue},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",component:me},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:ve},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:ne}];return o(K,null,o(a,null,o(Z,{setDrawerOpen:t,routes:n},null),o(ee,{routes:n,drawerOpen:e,setDrawerOpen:t}),o(D,null,null),o(i,null,n.map(e=>o(l,{key:e.name+"-route",path:e.path,...e.options},o(e.component))))))},null,null),document.getElementById("app_container"))}]);
!function(e){var t={};function a(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=t,a.d=function(e,t,o){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(a.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(o,n,function(t){return e[t]}.bind(null,n));return o},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=6)}([function(e,t){e.exports=React},function(e,t){e.exports=MaterialUI},function(e,t){e.exports=Big},function(e,t){e.exports=AWS},function(e,t){e.exports=ReactDOM},function(e,t){e.exports=uuidv4},function(e,t,a){"use strict";a.r(t);var o={};a.r(o),a.d(o,"APP_AUTH_REDIRECT",(function(){return ge})),a.d(o,"APP_AUTH_URL",(function(){return pe})),a.d(o,"APP_BASE_PATH",(function(){return le})),a.d(o,"APP_CLIENT_ID",(function(){return me})),a.d(o,"APP_IDENTITY_POOL_ID",(function(){return de})),a.d(o,"APP_REGION",(function(){return ce})),a.d(o,"APP_USER_POOL_ID",(function(){return ue})),a.d(o,"EXTERNAL_LOGIN_URL",(function(){return ye})),a.d(o,"REFRESH_TOKEN_STORAGE_KEY",(function(){return he}));var n=a(0),r=a.n(n),i=a(4),l=a.n(i),s=a(1);const c=r.a.createElement,{ThemeProvider:u}=s;var d=({children:e})=>{const[t]=r.a.useState(s.createMuiTheme({palette:{primary:{main:"#556cd6"}}}));return c(u,{theme:t},e)};const p=r.a.createElement,{Icon:m,IconButton:g,Snackbar:y}=s,h=r.a.createContext(),v=({children:e})=>{const[t,a]=r.a.useState([]),[o,n]=r.a.useState(void 0),[i,l]=r.a.useState(!1);r.a.useEffect(()=>{t.length&&!o?(n(t[0]),a(e=>e.slice(1)),l(!0)):t.length&&o&&i&&l(!1)},[t,o,i]);const s=r.a.useCallback(e=>{a(t=>[...t,e])},[]),c=(e,t)=>{"clickaway"!==t&&l(!1)};return p(h.Provider,{value:{showMessage:s}},e,p(y,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:i,autoHideDuration:5e3,onClose:c,onExited:()=>{n(void 0)},message:o,action:p(g,{color:"inherit",onClick:c},p(m,null,"close"))},null))};var f=h,b=a(3),C=a.n(b);const x=r.a.createElement,E=r.a.createContext(),I=({appConfig:e,children:t})=>x(E.Provider,{value:{appConfig:e}},t);var P=E;const w=r.a.createElement,k=r.a.createContext(),T=({children:e})=>{const{appConfig:{APP_AUTH_REDIRECT:t,APP_AUTH_URL:a,APP_CLIENT_ID:o,APP_IDENTITY_POOL_ID:n,APP_REGION:i,APP_USER_POOL_ID:l,REFRESH_TOKEN_STORAGE_KEY:s}}=r.a.useContext(P),[c,u]=r.a.useState({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),[d,p]=r.a.useState(sessionStorage.getItem(s)),[m,g]=r.a.useState(void 0),[y]=r.a.useState(15e5),[h,v]=r.a.useState(void 0);r.a.useEffect(()=>{d?sessionStorage.setItem(s,d):sessionStorage.removeItem(s)},[d,s]);const f=r.a.useCallback(()=>new Promise(e=>{u({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),p(void 0),g(void 0),e()}),[]);r.a.useEffect(()=>{g(h?e=>e?(e.update({credentials:h}),e):new C.a.Config({region:i,credentials:h}):void 0)},[h,i]);const b=r.a.useCallback((e,t)=>{const a=new C.a.CognitoIdentityCredentials({IdentityPoolId:n,...e&&{Logins:{[l]:e}}},{region:i});return new Promise((o,n)=>{a.clearCachedId(),a.getPromise().then(()=>{v(a),u(o=>{const n=e&&JSON.parse(atob(e.split(".")[1]));return o.identityId=a.identityId,o.id=n&&n.sub,o.name=n?n.name:"Usuário não logado",o.email=n&&n.email,o.groups=n&&n["cognito:groups"],o.idToken=e,o.accessToken=t,o}),o()}).catch(e=>{v(void 0),u({identityId:void 0,id:void 0,name:void 0,email:void 0,groups:void 0,idToken:void 0,accessToken:void 0}),console.warn("Could not validate credentials",e),n(e)})})},[n,i,l]),x=r.a.useCallback(e=>new Promise((t,n)=>{e?fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=refresh_token&client_id=${o}&refresh_token=${e}`}).then(e=>{e.json().then(e=>{b(e.id_token,e.access_token).then(()=>{t()}).catch(e=>{console.error("Could not login with refreshed tokens",e),n(e)})}).catch(e=>{console.error("Could not decode authentication response",e),n(e)})}).catch(e=>{console.error("Could not get refreshed tokens",e),n(e)}):(console.warn("No refreshToken available"),n(new Error("No refreshToken available")))}),[b,a,o]);((e,t)=>{const a=r.a.useRef(),o=r.a.useCallback(()=>{const e=a.current;e&&(a.current=void 0,clearInterval(e))},[a]);r.a.useEffect(()=>(a.current=setInterval(e,t),o),[e,t,o])})(r.a.useCallback(()=>{x(d).catch(e=>{console.error("Could not refresh tokens",e)})},[d,x]),y);const E=r.a.useCallback(()=>b(),[b]),I=r.a.useCallback(e=>new Promise((n,r)=>{fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`grant_type=authorization_code&client_id=${o}&code=${e}&redirect_uri=${t}`}).then(e=>{e.json().then(e=>{x(e.refresh_token).then(()=>{p(e.refresh_token),n()}).catch(e=>{console.error("Could not login with refreshed tokens",e),p(void 0),r(e)})}).catch(e=>{console.error("Could not decode authentication response",e),p(void 0),r(e)})}).catch(e=>{console.error("Could not get identification tokens with this authorization code",e),p(void 0),r(e)})}),[x,t,a,o]);return r.a.useEffect(()=>{d&&!h&&x(d).catch(e=>{console.error("Could not refresh tokens",e)})},[d,h,x]),w(k.Provider,{value:{user:c,awsConfig:m,awsCredentials:h,loginAnonymously:E,loginWithAuthorizationCode:I,logoff:f}},e)};var A=k;const _=r.a.createElement,S=r.a.createContext(),D=({children:e})=>{const{awsConfig:t,awsCredentials:a}=r.a.useContext(A),[o,n]=r.a.useState();return r.a.useEffect(()=>{n(t?new C.a.DynamoDB.DocumentClient(t):void 0)},[t]),r.a.useEffect(()=>{a&&n(e=>(e&&e.service.config.update({credentials:a}),e))},[a]),_(S.Provider,{value:{documentDB:o}},e)};var O=S;const N=r.a.createElement,R=r.a.createContext(),B=({children:e})=>{const{user:{accessToken:t},awsConfig:a,awsCredentials:o}=r.a.useContext(A);console.log("accessToken",t);const[n,i]=r.a.useState();r.a.useEffect(()=>{i(a?new C.a.Lambda(a):void 0)},[a]),r.a.useEffect(()=>{o&&i(e=>(e&&e.config.update({credentials:o}),e))},[o]);const l=r.a.useCallback((e,a)=>{const o={FunctionName:e,ClientContext:btoa(JSON.stringify({custom:{accessToken:t}}))};return a&&(o.Payload=JSON.stringify(a)),new Promise((e,t)=>{n.invoke(o).promise().then(a=>{a.StatusCode&&200===a.StatusCode&&a.Payload||t(a);const o=JSON.parse(a.Payload);o&&o.statusCode&&200===o.statusCode||t(a),e(o.body)}).catch(e=>{t(e)})})},[n,t]);return N(R.Provider,{value:{invokeLambda:n&&l}},e)};var F=R;const L=r.a.createElement,{useLocation:M}=window.ReactRouterDOM,{AppBar:V,Button:z,Divider:j,Icon:$,IconButton:U,Menu:W,MenuItem:G,Toolbar:H,Typography:K}=s,q=()=>{const{appConfig:{EXTERNAL_LOGIN_URL:e}}=r.a.useContext(P),{user:{name:t}}=r.a.useContext(A);return t?null:L(r.a.Fragment,null,L(z,{color:"inherit",href:e},"Login"))},Q=()=>{const{showMessage:e}=r.a.useContext(f),{user:{name:t},logoff:a}=r.a.useContext(A),[o,n]=r.a.useState(!1),i=r.a.useRef(null);return t?L(r.a.Fragment,null,L(U,{color:"inherit",ref:i,onClick:()=>{n(!0)}},L($,null,"account_circle")),L(W,{open:o,onClose:()=>{n(!1)},anchorEl:i.current,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},L(G,{disabled:!0},t),L(j,null,null),L(G,{onClick:()=>{a().then(()=>{e("Usuário deslogado com sucesso")}).catch(t=>{e("Não foi possível deslogar o usuário"),console.error("Logoff failed",t)}),n(!1)}},"Logoff"))):null};var J=({setDrawerOpen:e,routes:t})=>{const a=M(),o=t.find(e=>e.path===a.pathname);return L(V,null,L(H,null,L(U,{edge:"start",color:"inherit",onClick:()=>e(!0)},L($,null,"menu")),L(K,{style:{flexGrow:1}},o?o.label:""),L(q,null,null),L(Q,null,null)))};const X=r.a.createElement,{NavLink:Y}=window.ReactRouterDOM,{Box:Z,Divider:ee,Drawer:te,Icon:ae,ListItem:oe,ListItemText:ne,Toolbar:re}=s;var ie=({routes:e,drawerOpen:t,setDrawerOpen:a})=>{const{user:{groups:o}}=r.a.useContext(A),n=()=>a(!1);return X(te,{open:t,onClose:n},X(re,{onClick:n,style:{padding:"inherit"}},X(oe,{button:!0,style:{justifyContent:"space-between",height:"100%"}},X(Z,{style:{flex:"auto",textAlign:"center"}},X("img",{src:"https://d3oia8etllorh5.cloudfront.net/us-east-1_SjfN8ExVX/ALL/20200706011733/assets/images/image.jpg",width:"70px",height:"70px"},null)),X(ae,null,"chevron_left"))),X(ee,null,null),e.filter(e=>!e.hideFromMenu).filter(e=>{return!(t=e.authorizedGroups)||!!o&&t.some(e=>o.includes(e));var t}).map(e=>X(oe,{key:e.name+"-route-drawer-item",button:!0,component:Y,activeClassName:"Mui-selected",to:e.path,onClick:n,...e.options},X(ne,{primary:e.label},null))))};const le="/my-investment-wallet/",se="https://carteira-investimentos.auth.us-east-1.amazoncognito.com",ce="us-east-1",ue="cognito-idp.us-east-1.amazonaws.com/us-east-1_SjfN8ExVX",de="us-east-1:874c45d2-0eb6-4d04-92f0-b8769dcbcc54",pe=se+"/oauth2/token",me="7s3vb9runcfjvgetrvhdfd97at",ge=`https://seuvitor.github.io${le}?auth-redirect`,ye=`${se}/login?client_id=${me}&response_type=code&scope=email+openid+profile&redirect_uri=${ge}`,he="my-investment-wallet-refresh-token";var ve=()=>{const{showMessage:e}=r.a.useContext(f),{user:{identityId:t}}=r.a.useContext(A),{invokeLambda:a}=r.a.useContext(F),o=r.a.useCallback(()=>new Promise((o,n)=>{a("update_asset_allocation",{user_id:t}).then(()=>{e("Portfólio atualizado com sucesso"),o()}).catch(t=>{e("Não foi possível atualizar o portfólio"),console.error("Portfolio update failed",t),n(t)})}),[e,t,a]),n=r.a.useCallback(()=>new Promise((n,r)=>{a("update_target_allocation",{user_id:t}).then(()=>{e("Macro-alocação atualizada com sucesso"),o().then(()=>{n()}).catch(e=>{r(e)})}).catch(t=>{e("Não foi possível atualizar a macro-alocação"),console.error("Target allocation update failed",t),r(t)})}),[e,t,a,o]),i=r.a.useCallback(()=>new Promise((n,r)=>{a("update_position",{user_id:t}).then(()=>{e("Posição atualizada com sucesso"),o().then(()=>{n()}).catch(e=>{r(e)})}).catch(t=>{e("Não foi possível atualizar a posição"),console.error("Position update failed",t),r(t)})}),[e,t,a,o]);return{updatePosition:a&&i,updateTargetAllocation:a&&n,updatePortofolio:a&&o}};const fe=r.a.createElement,{Redirect:be}=window.ReactRouterDOM;var Ce=()=>{const{user:{identityId:e}}=r.a.useContext(A),{updatePortofolio:t}=ve();return r.a.useEffect(()=>{t&&t()},[t]),e?fe(be,{to:"/target-allocation"},null):null};const xe=r.a.createElement,{useParams:Ee,useHistory:Ie}=window.ReactRouterDOM,{Backdrop:Pe,CircularProgress:we}=s;var ke=()=>{const{showMessage:e}=r.a.useContext(f),{loginWithAuthorizationCode:t}=r.a.useContext(A),{authorization_code:a}=Ee(),[o,n]=r.a.useState(!0),i=s.useTheme(),l=Ie();return r.a.useEffect(()=>{t(a).then(()=>{e("Usuário logado com sucesso"),l.replace("/")}).catch(t=>{e("Não foi possível completar o login"),console.error("Login failed",t),n(!1)})},[a,t,e,l]),xe(Pe,{open:o,style:{zIndex:1+i.zIndex.drawer}},xe(we,null,null))},Te=a(2),Ae=a.n(Te);const _e=async(e,t)=>{const a={TableName:"priced_position",Key:{user_id:t},AttributesToGet:["assets"]},o=await e.get(a).promise();return o.Item&&o.Item.assets||{}},Se=async(e,t)=>{const a={TableName:"asset",Key:{user_id:t},AttributesToGet:["assets"]},o=await e.get(a).promise();return o.Item&&o.Item.assets||{}},De=e=>e.replaceAll("-",""),Oe=e=>e.startsWith("0")?"0":e.startsWith("1")?"1":e.startsWith("2")?"2":e[0]>="3"&&e[0]<="9"?"3-9":"a-z",Ne=async(e,t)=>{const a=[t];return(await(async(e,t)=>{const a=t.map(e=>Oe(e)),o=[...new Set(a)];return(await Promise.all(o.map(a=>(async(e,t,a)=>{const o={TableName:"price",Key:{partition:t},ProjectionExpression:a.map((e,t)=>"prices.#"+t).join(","),ExpressionAttributeNames:a.reduce((e,t,a)=>(e["#"+a]=t,e),{})},n=await e.get(o).promise();return n.Item&&n.Item.prices})(e,a,t.filter(e=>Oe(e)===a))))).reduce((e,t)=>({...e,...t}),{})})(e,a))[t]},Re=(e,t,a=2)=>new Ae.a(e).plus(t).toFixed(null===a?void 0:a),Be=(e,t)=>new Ae.a(e).minus(new Ae.a(t)).toFixed(2),Fe=(e,t,a=2)=>new Ae.a(e).times(new Ae.a(t)).toFixed(null===a?void 0:a),Le=(e,t,a=Ae.a.DP,o=Ae.a.RM)=>new Ae.a(e).div(new Ae.a(t)).round(a,o).toFixed(a),Me=(e,t)=>new Ae.a(e).cmp(new Ae.a(t))>=0?e:t,Ve=e=>e.map(e=>new Ae.a(e)).reduce((e,t)=>e.plus(t),new Ae.a(0)).toFixed(2),ze=(e,t)=>Fe(e,Le(t,100,Ae.a.DP)),je=(e,t)=>new Ae.a(e).cmp(new Ae.a(t))<0?e:t,$e=e=>e.reduce((e,t)=>void 0===e?t:Me(e,t),void 0);var Ue=({defaultCurrency:e,currencies:t})=>{const{documentDB:a}=r.a.useContext(O),[o,n]=r.a.useState(void 0);r.a.useEffect(()=>{if(a&&e&&t&&t.length){const o=t.filter(t=>t!==e).map(t=>`${t}/${e}`);Promise.all(o.map(e=>Ne(a,e))).then(e=>{const a=e.reduce((e,a,o)=>(e[t[o]]=a,e),{});n(a)}).catch(e=>{n(void 0),console.error("Could not get currency exchange rates",e)})}else n(void 0)},[a,e,t]);return{toDefaultCurrency:r.a.useMemo(()=>{if(o&&e&&t&&(t.includes(e)||Object.keys(o).length))return(t,a)=>a===e?t:Fe(t,o[a])},[o,e,t]),backToAssetCurrency:r.a.useMemo(()=>{if(o&&e&&t&&(t.includes(e)||Object.keys(o).length))return(t,a)=>a===e?t:Fe(t,Le("1",o[a]))},[o,e,t])}};const We=(e,t)=>parseFloat(e).toLocaleString("pt-BR",{maximumFractionDigits:20,minimumFractionDigits:t&&t}),Ge={"fixed-income":"Renda Fixa",reit:"Imobiliário","stock-picking":"Ações","stocks-fund":"Fundo de Ações",multistrategy:"Multimercado","bdr-stock":"BDR de Stock","bdr-reit":"BDR de REIT"},He={buy:"Compra",sell:"Venda"},Ke=["BRL","USD","EUR"],qe=r.a.createElement,{Box:Qe,Button:Je,Chip:Xe,Divider:Ye,Icon:Ze,FormControl:et,Grid:tt,InputLabel:at,MenuItem:ot,Paper:nt,Select:rt,Table:it,TableBody:lt,TableCell:st,TableContainer:ct,TableHead:ut,TableRow:dt,TextField:pt,Typography:mt}=s,gt=({setAvailableValue:e,setDefaultCurrency:t})=>{const[a,o]=r.a.useState(!0);return qe("form",{onSubmit:a=>{a.preventDefault(),e(a.target.availableValue.value),t(a.target.currency.value)}},qe(tt,{container:!0,alignItems:"center",spacing:2},qe(tt,{item:!0,xs:12},qe(mt,{variant:"body1"},"Informe o valor disponível para calcular a alocação proporcional")),qe(tt,{item:!0},qe(et,{fullWidth:!0},qe(at,{id:"currency-label"},"Moeda"),qe(rt,{name:"currency",defaultValue:"BRL",labelId:"currency-label",required:!0,variant:"filled"},Ke.map(e=>qe(ot,{key:e,value:e},e))))),qe(tt,{item:!0},qe(pt,{name:"availableValue",type:"number",label:"Valor disponível",variant:"filled",onChange:e=>{try{Ae()(e.target.value),o(!0)}catch(e){o(!1)}},error:!a,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)),qe(tt,{item:!0},qe(Je,{type:"submit",variant:"contained",color:"primary",disabled:!a},"Calcular aportes"))))},yt=(e,t,a,o)=>{const n=Ve(e.assets.map(e=>a(e.value,e.currency))),r=Re(n,t),i=[...e.assets];let l=i.reduce((e,t)=>{const a=`${t.currency}|${t.category}`;return e[a]||(e[a]={targetPercent:"0.0000",value:"0.00"}),e[a].targetPercent=Re(e[a].targetPercent,t.targetPercent),e[a].value=Re(e[a].value,t.value),e},{});l=Object.entries(l).reduce((e,[t,a])=>{const[n]=t.split("|");return a.idealFutureValue=o(ze(r,a.targetPercent),n),a.idealInvestment=Me("0.00",Be(a.idealFutureValue,a.value)),e},l);const s=Ve(Object.entries(l).map(([e,t])=>{const[o]=e.split("|");return a(t.idealInvestment,o)}));l=Object.entries(l).reduce((e,[n,r])=>{const[i]=n.split("|");return r.proportionalizedIdealInvestment="0.00"===s?"0.00":o(((e,t,a,o=2)=>Fe(e,Le(t,a,Ae.a.DP),o))(a(r.idealInvestment,i),t,s),i),e},l),i.forEach(e=>{const t=`${e.currency}|${e.category}`,a=l[t],n=Re(a.value,a.proportionalizedIdealInvestment);e.idealFutureValue="0.00"===a.targetPercent?"0.00":o(ze(n,Le(Fe("100.00",e.targetPercent),a.targetPercent)),e.currency),e.idealInvestment=Me("0.00",Be(e.idealFutureValue,e.value))}),l=i.reduce((e,t)=>{const a=`${t.currency}|${t.category}`,o=l[a];return o.totalAssetIdealInvestment||(o.totalAssetIdealInvestment="0.00"),o.totalAssetIdealInvestment=Re(o.totalAssetIdealInvestment,t.idealInvestment),e},l),Object.entries(l).forEach(([e,t])=>{((e,t,a,o)=>{const n=e,r=[...t].sort((e,t)=>e.idealInvestment-e.price-(t.idealInvestment-t.price)).slice(0).map(e=>({...e}));r.forEach(e=>{e.maxAffordableQuantity=Fe(e.minimum,Le(n.proportionalizedIdealInvestment,Fe(e.price,e.minimum,Ae.a.DP),0,0),null)});const i=r.reduce((e,t)=>{const a=Le(t.maxAffordableQuantity,t.minimum,0,0),o=je(a,"5"),r=[];return e.forEach(e=>{for(let i=1;i<=parseInt(o,10);i+=1){const l=Fe(t.minimum,Le(Fe(a,i.toFixed(0)),parseInt(o,10),0,0)),s=Re(e.cost,Fe(t.price,l));if(!(Ae()(s).cmp(Ae()(n.proportionalizedIdealInvestment))<=0))break;r.push({assets:{...e.assets,[t.code]:l},cost:s})}}),e.push(...r),e},[{assets:[],cost:"0.00"}]);i.forEach(e=>{let t="0.00";r.forEach(a=>{const o=e.assets[a.code]||"0.00",n=Fe(o,a.price),r=Ae()(Be(a.idealInvestment,n)).abs().toFixed(2);t=Re(t,r)}),e.investmentAbsDeviation=t,e.categoryInvestmentDeviation=Ae()(Be(n.proportionalizedIdealInvestment,e.cost)).abs().toFixed(2),e.score=Re(e.investmentAbsDeviation,Fe("3.50",e.categoryInvestmentDeviation))}),i.sort((e,t)=>Ae()(e.score).cmp(Ae()(t.score)));const l=i[0];t.forEach(e=>{e.investmentQuantity=l.assets[e.code]||"0",e.investment=Fe(e.investmentQuantity,e.price)})})(t,i.filter(t=>`${t.currency}|${t.category}`===e))});const c=Ve(i.map(e=>a(e.investment,e.currency))),u=Be(t,c);i.forEach(e=>{e.futureQuantity=Re(e.quantity,e.investmentQuantity,null)}),i.forEach(e=>{e.futureValue=Fe(e.futureQuantity,e.price)});const d=Ve(i.map(e=>a(e.futureValue,e.currency)));return i.forEach(e=>{e.futurePercent="0.00"===d?"0.0000":Fe("100.00",Le(a(e.futureValue,e.currency),d),4)}),{assets:i,totalInvestment:c,remainingAvailableValue:u,currencyCategorySummary:l}};var ht=()=>{const{user:{identityId:e}}=r.a.useContext(A),{documentDB:t}=r.a.useContext(O),[a,o]=r.a.useState(void 0),[n,i]=r.a.useState(void 0),[l,s]=r.a.useState(void 0),[c,u]=r.a.useState(void 0),[d,p]=r.a.useState(void 0),{toDefaultCurrency:m,backToAssetCurrency:g}=Ue({defaultCurrency:c,currencies:d});r.a.useEffect(()=>{t&&e?_e(t,e).then(e=>{o({assets:e})}).catch(()=>{o(void 0)}):o(void 0)},[t,e]),r.a.useEffect(()=>{if(a&&a.assets&&a.assets.length&&c&&n&&m&&g){const e=yt(a,n,m,g);s(e)}else s(void 0)},[a,c,n,m,g]),r.a.useEffect(()=>{p(a?[...new Set(Object.values(a.assets).map(({currency:e})=>e))]:void 0)},[a]);const y=l&&l.assets||a&&a.assets;return qe(r.a.Fragment,null,qe(gt,{setDefaultCurrency:u,setAvailableValue:i},null),qe(Ye,{absolute:!1,style:{marginTop:"0.5em",marginBottom:"0.5em"}},null),y&&qe(ct,{component:Qe,style:{width:"fit-content"}},qe(it,{style:{tableLayout:"auto",borderCollapse:"separate",borderSpacing:"10px"}},qe(ut,null,qe(dt,null,qe(st,{style:{border:0}}),qe(st,{style:{border:0}}),qe(st,{align:"center",style:{border:0}},"Posição atual"),l&&qe(st,{style:{border:0}}),l&&qe(st,{align:"center",style:{border:0}},"Novo aporte"),l&&qe(st,{style:{border:0}}),l&&qe(st,{align:"center",style:{border:0}},"Posição futura"))),qe(lt,null,y.map(e=>qe(dt,{key:e.code},qe(st,{style:{display:"contents"}},qe(Qe,{component:nt,p:2,style:{display:"table-cell",verticalAlign:"middle"}},qe(tt,{container:!0},qe(tt,{item:!0,xs:6},qe(mt,null,e.code)),qe(tt,{item:!0,xs:6,align:"right"},qe(mt,{variant:"caption",color:"textSecondary"},e.currency+" "),qe(mt,{display:"inline"},""+We(e.price))),qe(tt,{item:!0,xs:12},qe(Xe,{size:"small",label:e.name}))))),qe(st,{style:{display:"contents"}},qe(Qe,{component:nt,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},qe(mt,{variant:"caption",color:"textSecondary"},"objetivo"),qe(mt,null,We(e.targetPercent)+"%"))),qe(st,{style:{display:"contents"}},qe(Qe,{component:nt,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},qe(mt,{variant:"caption",display:"block"},We(e.quantity)+" cotas"),qe(mt,{variant:"caption",color:"textSecondary"},e.currency+" "),qe(mt,{display:"inline"},""+We(e.value,2)),qe(mt,{variant:"body2"},We(e.currentPercent)+"%"))),l&&qe(st,{padding:"none",align:"center",style:{border:0}},qe(Ze,null,"chevron_right")),l&&qe(st,{style:{display:"contents"}},qe(Qe,{component:nt,p:2,align:"center",elevation:"0"===e.investmentQuantity?1:6,style:{display:"table-cell",verticalAlign:"middle",..."0"!==e.investmentQuantity&&{backgroundColor:"lightblue"}}},qe(mt,{variant:"caption"},e.code),qe(mt,{style:{..."0"!==e.investmentQuantity&&{fontWeight:"bold"}}},We(e.investmentQuantity)+" cotas"),qe(mt,{variant:"caption",color:"textSecondary"},e.currency+" "),qe(mt,{variant:"caption"},""+We(e.investment,2)))),l&&qe(st,{padding:"none",align:"center",style:{border:0}},qe(Ze,null,"chevron_right")),l&&qe(st,{style:{display:"contents"}},qe(Qe,{component:nt,p:2,align:"center",style:{display:"table-cell",verticalAlign:"middle"}},qe(mt,{variant:"caption",display:"block"},We(e.futureQuantity)+" cotas"),qe(mt,{variant:"caption",color:"textSecondary"},e.currency+" "),qe(mt,{display:"inline"},""+We(e.futureValue,2)),qe(mt,{variant:"body2"},We(e.futurePercent)+"%"))))),qe(dt,null,qe(st,{style:{border:0}}),qe(st,{style:{border:0}}),qe(st,{style:{border:0}}),l&&qe(st,{style:{border:0}}),l&&qe(st,{align:"center",padding:"none",style:{border:0}},qe(Qe,{component:nt,p:2,elevation:6,align:"center"},qe(mt,{variant:"caption",color:"textSecondary",display:"block"},"aporte efetivo"),qe(mt,{variant:"caption",color:"textSecondary"},c+" "),qe(mt,{display:"inline"},""+We(l.totalInvestment,2)),qe(Ye,{light:!0,variant:"fullWidth"},null),qe(mt,{variant:"caption",color:"textSecondary",display:"block"},"valor restante"),qe(mt,{variant:"caption",color:"textSecondary"},c+" "),qe(mt,{display:"inline"},""+We(l.remainingAvailableValue,2)))),l&&qe(st,{style:{border:0}}),l&&qe(st,{style:{border:0}}))))))};const vt=r.a.createElement,{Box:ft,Button:bt,Container:Ct,Dialog:xt,DialogActions:Et,DialogContent:It,DialogTitle:Pt,Grid:wt,Paper:kt,TextField:Tt,Typography:At}=s,_t=e=>{return t=e.map(e=>e.weight),Le(Ve(t),t.length);var t},St=e=>Ve(e.map(e=>e.weight)),Dt=e=>e.map(e=>e.weight).reduce((e,t)=>void 0===e?t:je(e,t),void 0),Ot=e=>e.reduce((e,t)=>e.includes(t.currency)?e:[...e,t.currency],[]),Nt=({allocations:e,updatedAllocations:t,dismissAllocationEdition:a})=>{const{showMessage:o}=r.a.useContext(f),{user:{identityId:n}}=r.a.useContext(A),{documentDB:i}=r.a.useContext(O),{updatePortofolio:l}=ve(),s=()=>{a()};return vt(xt,{open:!0,onClose:s,fullWidth:!0,maxWidth:"md"},vt("form",{onSubmit:r=>{r.preventDefault();const s=e.map(({currency:e,category:t})=>({currency:e,category:t,weight:r.target[`weight-${e}-${t}`].value}));((e,t,a)=>{const o={TableName:"target_allocation",Key:{user_id:t},UpdateExpression:"set allocations = :allocations",ExpressionAttributeValues:{":allocations":a}};return e.update(o).promise()})(i,n,s).then(()=>{o("Pesos atualizados com sucesso"),t(s),a(),l()}).catch(e=>{o("Não foi possível alterar os pesos"),console.error("Could not update allocations",e)})}},vt(Pt,null,"Alterar Pesos"),vt(It,null,Ot(e).map(t=>{const a=e.filter(e=>e.currency===t);return vt(ft,{key:t,margin:2,style:{display:"flex",alignItems:"center"}},vt(At,{variant:"subtitle1"},t),a.map(e=>vt(ft,{key:e.category,padding:1,width:e.widthPercent+"%"},vt(Tt,{name:`weight-${t}-${e.category}`,type:"number",defaultValue:e.weight,label:Ge[e.category],variant:"outlined",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"center"}}},null))))})),vt(Et,null,vt(bt,{onClick:s,variant:"contained",color:"secondary"},"Cancelar"),vt(bt,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Rt=(e,t)=>{let a=e.map(e=>({...e,currentPercent:Ve(t.filter(t=>t.category===e.category&&t.currency===e.currency).map(e=>e.currentPercent))}));const o=St(a);a=a.map(e=>({...e,targetPercent:"0.00"===o?"0.00":Le(Fe("100",e.weight),o,2)}));const n=Ot(e),r=n.map(t=>(e=>0===e.length?"0":Me("0",Be(_t(e),Fe((10/e.length).toFixed(2),Dt(e)))))(e.filter(e=>e.currency===t))),i=$e(r),l=$e(n.map(t=>{const a=e.filter(e=>e.currency===t);return Re(St(a),Fe(i,a.length.toFixed(2)))}));return a=a.map(e=>{const t=Le(Fe(n.length.toFixed(2),"100"),a.length.toFixed(2),2),o=Re(e.weight,i),r=Me("10.00","0.00"===l?t:Le(Fe(o,"100"),l,2));return{...e,widthPercent:r}}),a};var Bt=()=>{const{user:{identityId:e}}=r.a.useContext(A),{documentDB:t}=r.a.useContext(O),[a,o]=r.a.useState([]),[n,i]=r.a.useState([]),[l,s]=r.a.useState([]),[c,u]=r.a.useState(!1);r.a.useEffect(()=>{t&&e?((async(e,t)=>{const a={TableName:"target_allocation",Key:{user_id:t},AttributesToGet:["allocations"]},o=await e.get(a).promise();return o.Item&&o.Item.allocations||[]})(t,e).then(e=>{o(e)}).catch(()=>{o([])}),_e(t,e).then(e=>{i(e)}).catch(()=>{i([])})):(o([]),i([]))},[t,e]),r.a.useEffect(()=>{s(a&&n?Rt(a,n):[])},[a,n]);const d=r.a.useCallback(()=>{u(!1)},[]),p=r.a.useCallback(e=>{o(e)},[]);return l&&0!==l.length?vt(r.a.Fragment,null,vt(Ct,{maxWidth:!1},vt(ft,{align:"center",margin:1},vt(bt,{onClick:()=>{u(!0)},variant:"contained"},"Alterar pesos")),Ot(l).map(e=>{const t=l.filter(t=>t.currency===e);return vt(ft,{key:e,margin:2,style:{display:"flex",alignItems:"center"}},vt(At,{variant:"h6"},e),t.map(e=>vt(ft,{component:kt,key:e.category,padding:1,margin:1,width:e.widthPercent+"%",align:"center"},vt(At,null,Ge[e.category]),vt(At,{variant:"subtitle1"},We(e.weight)),vt(wt,{container:!0,justify:"space-evenly"},vt(wt,{item:!0},vt(At,{variant:"caption"},We(e.currentPercent)+"%"),vt(At,{variant:"caption",display:"block",color:"textSecondary"},"atual")),vt(wt,{item:!0},vt(At,{variant:"caption"},We(e.targetPercent)+"%"),vt(At,{variant:"caption",display:"block",color:"textSecondary"},"objetivo"))))))})),c&&vt(Nt,{allocations:l,updatedAllocations:p,dismissAllocationEdition:d},null)):null};const Ft=r.a.createElement,{Box:Lt,Button:Mt,Dialog:Vt,DialogActions:zt,DialogContent:jt,DialogTitle:$t,DialogContentText:Ut,FormControl:Wt,InputLabel:Gt,Grid:Ht,MenuItem:Kt,Paper:qt,Select:Qt,Table:Jt,TableBody:Xt,TableCell:Yt,TableContainer:Zt,TableHead:ea,TableRow:ta,TextField:aa}=s,oa=({selectedAsset:e,allAssetCodes:t,assetChanged:a,dismissAssetEdition:o})=>{const{showMessage:n}=r.a.useContext(f),{user:{identityId:i}}=r.a.useContext(A),{documentDB:l}=r.a.useContext(O),[s,c]=r.a.useState(!1),{updateTargetAllocation:u,updatePosition:d}=ve(),p=null===e.code,m=()=>{o()};return e?Ft(Vt,{open:!0,onClose:m},Ft("form",{onSubmit:t=>{t.preventDefault();const r={currency:t.target.currency.value,category:t.target.category.value,name:t.target.name.value,minimum:t.target.minimum.value,weight:t.target.weight.value},s=p?t.target.code.value:e.code;(async(e,t,a,o)=>{const n={TableName:"asset",Key:{user_id:t},UpdateExpression:"set assets.#assetCode = :asset",ExpressionAttributeNames:{"#assetCode":a},ExpressionAttributeValues:{":asset":o}};try{return await e.update(n).promise()}catch(n){if(n.message&&"The document path provided in the update expression is invalid for update"===n.message){const n={TableName:"asset",Key:{user_id:t},UpdateExpression:"set assets = :assets",ExpressionAttributeValues:{":assets":{[a]:o}}};return e.update(n).promise()}throw n}})(l,i,s,r).then(()=>{n(`Ativo ${p?"adicionado":"atualizado"} com sucesso`),a({code:s,...r},p?"DB_INSERT":"DB_UPDATE"),o(),u(),d()}).catch(e=>{n(`Não foi possível ${p?"adicionar":"atualizar"} o ativo`),console.error(`Could not ${p?"add":"update"} asset`,e)})}},Ft($t,null,""+(p?"Adicionar ativo":"Editar ativo: "+e.code)),Ft(jt,null,Ft(Ht,{container:!0,spacing:2},p&&Ft(Ht,{item:!0,xs:6},Ft(aa,{name:"code",defaultValue:"",label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(t.includes(e.target.value)?"Código já existente":""),e.target.reportValidity()}},null)),Ft(Ht,{item:!0,xs:2},Ft(Wt,{fullWidth:!0},Ft(Gt,{id:"currency-label"},"Moeda"),Ft(Qt,{name:"currency",defaultValue:e.currency,labelId:"currency-label",required:!0,variant:"filled"},Ke.map(e=>Ft(Kt,{key:e,value:e},e))))),Ft(Ht,{item:!0,xs:4},Ft(Wt,{fullWidth:!0},Ft(Gt,{id:"category-label"},"Categoria"),Ft(Qt,{name:"category",defaultValue:e.category||"",labelId:"category-label",required:!0,variant:"filled"},Object.entries(Ge).map(([e,t])=>Ft(Kt,{key:e,value:e},t))))),Ft(Ht,{item:!0,xs:6},Ft(aa,{name:"name",defaultValue:e.name,label:"Nome",required:!0,variant:"filled",fullWidth:!0},null)),Ft(Ht,{item:!0,xs:4},Ft(aa,{name:"minimum",type:"number",defaultValue:e.minimum,label:"Qtd mínima",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.00000000000001",style:{textAlign:"right"}}},null)),Ft(Ht,{item:!0,xs:2},Ft(aa,{name:"weight",type:"number",defaultValue:e.weight,label:"Peso",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:"0.01",style:{textAlign:"right"}}},null)))),Ft(zt,null,Ft(Lt,{style:{flex:"auto"}},!p&&Ft(Mt,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&Ft(Vt,{open:!0,onClose:()=>c(!1)},Ft(jt,null,Ft(Ut,null,`Confirma exclusão do ativo ${e.code}?`)),Ft(zt,null,Ft(Mt,{onClick:()=>c(!1)},"Não"),Ft(Mt,{onClick:()=>{((e,t,a)=>{const o={TableName:"asset",Key:{user_id:t},UpdateExpression:"REMOVE assets.#assetCode",ExpressionAttributeNames:{"#assetCode":a}};return e.update(o).promise()})(l,i,e.code).then(()=>{n("Ativo excluído com sucesso"),a(e,"DB_DELETE"),o(),u(),d()}).catch(e=>{n("Não foi possível excluir o ativo"),console.error("Could not delete asset",e)})},autoFocus:!0},"Sim")))),Ft(Mt,{onClick:m,variant:"contained",color:"secondary"},"Cancelar"),Ft(Mt,{type:"submit",variant:"contained",color:"primary"},"Salvar")))):null},na=e=>e.sort((e,t)=>e.code.localeCompare(t.code)).sort((e,t)=>e.category.localeCompare(t.category)).sort((e,t)=>e.currency.localeCompare(t.currency));var ra=()=>{const{user:{identityId:e}}=r.a.useContext(A),{documentDB:t}=r.a.useContext(O),[a,o]=r.a.useState([]),[n,i]=r.a.useState(),l=s.useTheme();r.a.useEffect(()=>{t&&e?Se(t,e).then(e=>{o(na(Object.entries(e).map(([e,t])=>({code:e,...t}))))}).catch(()=>{o([])}):o([])},[t,e]);const c=r.a.useCallback(()=>{i(void 0)},[]),u=r.a.useCallback((e,t)=>{"DB_INSERT"===t?o(t=>na([...t,e])):"DB_UPDATE"===t?o(t=>na(t.map(t=>t.code===e.code?e:t))):"DB_DELETE"===t&&o(t=>t.filter(t=>t.code!==e.code))},[]);return Ft(r.a.Fragment,null,Ft(Lt,{margin:1},Ft(Mt,{onClick:()=>{i({code:null})},variant:"contained"},"Novo ativo")),a&&0!==a.length?Ft(Zt,{component:qt,style:{width:"fit-content"}},Ft(Jt,{style:{tableLayout:"auto"}},Ft(ea,{style:{backgroundColor:l.palette.background.default}},Ft(ta,null,Ft(Yt,null,"Moeda"),Ft(Yt,null,"Categoria"),Ft(Yt,null,"Código"),Ft(Yt,null,"Nome"),Ft(Yt,{align:"right"},"Qtd mínima"),Ft(Yt,{align:"right"},"Peso"))),Ft(Xt,null,a.map(e=>Ft(ta,{key:e.code,hover:!0,onClick:()=>(e=>{i(e)})(e)},Ft(Yt,null,e.currency),Ft(Yt,null,Ge[e.category]),Ft(Yt,null,e.code),Ft(Yt,null,e.name),Ft(Yt,{align:"right"},We(e.minimum)),Ft(Yt,{align:"right"},We(e.weight))))))):null,n&&Ft(oa,{selectedAsset:n,allAssetCodes:a.map(({code:e})=>e),assetChanged:u,dismissAssetEdition:c},null))},ia=a(5),la=a.n(ia);const sa=r.a.createElement,{Box:ca,Button:ua,Checkbox:da,Dialog:pa,DialogActions:ma,DialogContent:ga,DialogTitle:ya,DialogContentText:ha,FormControl:va,InputLabel:fa,Grid:ba,MenuItem:Ca,Paper:xa,Select:Ea,Table:Ia,TableBody:Pa,TableCell:wa,TableContainer:ka,TableHead:Ta,TableRow:Aa,TextField:_a}=s,Sa=e=>e.sort((e,t)=>t.type.localeCompare(e.type)).sort((e,t)=>t.code.localeCompare(e.code)).sort((e,t)=>t.date.localeCompare(e.date)),Da=({selectedOperation:e,operationChanged:t,dismissOperationEdition:a,assets:o})=>{const{showMessage:n}=r.a.useContext(f),{user:{identityId:i}}=r.a.useContext(A),{documentDB:l}=r.a.useContext(O),[s,c]=r.a.useState(!1),[u,d]=r.a.useState(),[p,m]=r.a.useState(),{updatePosition:g}=ve(),y=null===e.operationId,h=r.a.useCallback(e=>{const t=Object.keys(o).includes(e)?o[e].minimum:"1";d(t),m(parseFloat(t)<1?t:"0.01")},[o]);r.a.useEffect(()=>{h(e.code)},[e.code,h]);const v=()=>{a()};return sa(pa,{open:!0,onClose:v},sa("form",{onSubmit:o=>{o.preventDefault();const r={type:o.target.type.value,code:o.target.code.value,date:o.target.date.value,amount:o.target.amount.value,price:o.target.price.value,expenses:o.target.expenses.value},s=y?la()():e.operationId;(async(e,t,a,o)=>{const n={TableName:"operation",Key:{user_id:t},UpdateExpression:"set operations.#operationId = :operation",ExpressionAttributeNames:{"#operationId":a},ExpressionAttributeValues:{":operation":o}};try{return await e.update(n).promise()}catch(n){if(n.message&&"The document path provided in the update expression is invalid for update"===n.message){const n={TableName:"operation",Key:{user_id:t},UpdateExpression:"set operations = :operations",ExpressionAttributeValues:{":operations":{[a]:o}}};return e.update(n).promise()}throw n}})(l,i,s,r).then(()=>{n(`Operação ${y?"adicionada":"atualizada"} com sucesso`),t({operationId:s,...r},y?"DB_INSERT":"DB_UPDATE"),a(),g()}).catch(e=>{n(`Não foi possível ${y?"adicionar":"atualizar"} a operação`),console.error(`Could not ${y?"add":"update"} operation`,e)})}},sa(ya,null,(y?"Adicionar":"Editar")+" operação"),sa(ga,null,sa(ba,{container:!0,spacing:2},sa(ba,{item:!0,xs:3},sa(va,{fullWidth:!0},sa(fa,{id:"type-label"},"Tipo"),sa(Ea,{name:"type",defaultValue:e.type||"",labelId:"type-label",required:!0,variant:"filled"},Object.entries(He).map(([e,t])=>sa(Ca,{key:e,value:e},t))))),sa(ba,{item:!0,xs:5},sa(_a,{name:"code",defaultValue:e.code,label:"Código",required:!0,variant:"filled",fullWidth:!0,onChange:e=>{e.target.setCustomValidity(Object.keys(o).includes(e.target.value)?"":"Código inexistente"),h(e.target.value)}},null)),sa(ba,{item:!0,xs:4},sa(_a,{name:"date",type:"date",defaultValue:e.date,label:"Data",InputLabelProps:{shrink:!0},required:!0,variant:"filled",fullWidth:!0},null)),sa(ba,{item:!0,xs:12},sa(_a,{name:"amount",type:"number",defaultValue:e.amount,label:"Quantidade",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:u,style:{textAlign:"right"}}},null)),sa(ba,{item:!0,xs:12},sa(_a,{name:"price",type:"number",defaultValue:e.price,label:"Preço",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)),sa(ba,{item:!0,xs:12},sa(_a,{name:"expenses",type:"number",defaultValue:e.expenses,label:"Despesas",required:!0,variant:"filled",fullWidth:!0,inputProps:{min:0,step:p,style:{textAlign:"right"}}},null)))),sa(ma,null,sa(ca,{style:{flex:"auto"}},!y&&sa(ua,{onClick:()=>c(!0),variant:"outlined",color:"secondary"},"Excluir"),s&&sa(pa,{open:!0,onClose:()=>c(!1)},sa(ga,null,sa(ha,null,"Confirma exclusão da operação?")),sa(ma,null,sa(ua,{onClick:()=>c(!1)},"Não"),sa(ua,{onClick:()=>{((e,t,a)=>{const o={TableName:"operation",Key:{user_id:t},UpdateExpression:"REMOVE operations.#operationId",ExpressionAttributeNames:{"#operationId":a}};return e.update(o).promise()})(l,i,e.operationId).then(()=>{n("Operação excluída com sucesso"),t(e,"DB_DELETE"),a(),g()}).catch(e=>{n("Não foi possível excluir a operação"),console.error("Could not delete operation",e)})},autoFocus:!0},"Sim")))),sa(ua,{onClick:v,variant:"contained",color:"secondary"},"Cancelar"),sa(ua,{type:"submit",variant:"contained",color:"primary"},"Salvar"))))},Oa=({fullRefreshOperations:e})=>{const{showMessage:t}=r.a.useContext(f),{invokeLambda:a}=r.a.useContext(F),{user:{identityId:o}}=r.a.useContext(A),n=r.a.useRef(),{updatePosition:i}=ve(),l=n=>{const r=n.target.result;a("post_operations",{user_id:o,csv_file_contents_b64:btoa(r)}).then(()=>{t("Operações adicionadas com sucesso"),i(),e()}).catch(e=>{t("Não foi possível adicionar as operações"),console.error("Batch add operations failed",e)})};return sa("form",{ref:n,style:{display:"inline"}},sa("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=l,t.onloadend=()=>n.current.reset(),t.readAsText(e.target.files[0])},disabled:!a},null),sa("label",{htmlFor:"contained-button-file"},sa(ua,{disabled:!a,variant:"contained",color:"primary",component:"span"},"Upload Operações")))},Na=({selectedBoxes:e,operationChanged:t})=>{const{showMessage:a}=r.a.useContext(f),{user:{identityId:o}}=r.a.useContext(A),{documentDB:n}=r.a.useContext(O),[i,l]=r.a.useState(!1),{updatePosition:s}=ve();return e&&e.length>0&&sa(r.a.Fragment,null,sa(ua,{onClick:()=>l(!0),variant:"contained"},"Delete all selected"),i&&sa(pa,{open:!0,onClose:()=>l(!1)},sa(ga,null,sa(ha,null,"Confirma exclusão de todas as operações selecionadas?")),sa(ma,null,sa(ua,{onClick:()=>l(!1)},"Não"),sa(ua,{onClick:()=>{((e,t,a)=>{const o={TableName:"operation",Key:{user_id:t},UpdateExpression:"REMOVE "+a.map(e=>"operations.#"+De(e)).join(", "),ExpressionAttributeNames:a.reduce((e,t)=>(e["#"+De(t)]=t,e),{})};return e.update(o).promise()})(n,o,e).then(()=>{a("Operação excluída com sucesso"),e.forEach(e=>{t({operationId:e},"DB_DELETE")}),l(!1),s()}).catch(e=>{a("Não foi possível excluir as operações selecionadas"),console.error("Could not delete all selected operation",e)})},autoFocus:!0},"Sim"))))};var Ra=()=>{const{invokeLambda:e}=r.a.useContext(F),{showMessage:t}=r.a.useContext(f),{user:{identityId:a}}=r.a.useContext(A),{documentDB:o}=r.a.useContext(O),[n,i]=r.a.useState([]),[l,s]=r.a.useState([]),[c,u]=r.a.useState(30),[d,p]=r.a.useState(),[m,g]=r.a.useState([]),y=r.a.useCallback(()=>{(async(e,t)=>{const a={TableName:"operation",Key:{user_id:t},AttributesToGet:["operations"]},o=await e.get(a).promise();return o.Item&&o.Item.operations||{}})(o,a).then(e=>{s(Sa(Object.entries(e).map(([e,t])=>({operationId:e,...t}))))}).catch(e=>{console.error("Could not retrieve operations",e),s([])})},[o,a]);r.a.useEffect(()=>{o&&a?(y(),Se(o,a).then(e=>{i(e)}).catch(e=>{console.error("Could not retrieve assets",e),i([])})):(s([]),i([]))},[o,a,y]);const h=r.a.useCallback(()=>{p(void 0)},[]),v=e=>g(t=>t.filter(t=>t!==e.operationId)),b=r.a.useCallback((e,t)=>{"DB_INSERT"===t?s(t=>Sa([...t,e])):"DB_UPDATE"===t?s(t=>Sa(t.map(t=>t.operationId===e.operationId?e:t))):"DB_DELETE"===t&&(s(t=>t.filter(t=>t.operationId!==e.operationId)),v(e))},[]),C=e=>{p(e)};return sa(r.a.Fragment,null,sa(ca,{margin:1},sa(ua,{onClick:()=>{p({operationId:null})},variant:"contained"},"Nova operação"),sa(ua,{onClick:()=>{e("post_operations","value4").then(()=>{t("Operações adicionadas em lote com sucesso")}).catch(e=>{t("Não foi possível adicionar operações em lote"),console.error("Batch add operations failed",e)})},variant:"contained"},"Upload CSV"),sa(Oa,{fullRefreshOperations:y}),sa(Na,{selectedBoxes:m,operationChanged:b})),l&&l.length>0&&sa(ka,{component:xa,style:{width:"fit-content",maxHeight:"600px"},onScroll:e=>{e.target.scrollTop+e.target.clientHeight===e.target.scrollHeight&&u(e=>Math.min(l.length,e+30))}},sa(Ia,{stickyHeader:!0,style:{tableLayout:"auto"}},sa(Ta,null,sa(Aa,null,sa(wa,null,null),sa(wa,null,"Tipo"),sa(wa,null,"Código"),sa(wa,null,"Data"),sa(wa,{align:"right"},"Quantidade"),sa(wa,{align:"right"},"Preço"),sa(wa,{align:"right"},"Despesas"))),sa(Pa,null,l.slice(0,c).map(e=>{return sa(Aa,{key:e.operationId,hover:!0},sa(wa,null,sa(da,{onClick:t=>((e,t)=>{const a=m.findIndex(e=>e===t.operationId);e.target.checked&&-1===a?g(e=>[...e,t.operationId]):e.target.checked||-1===a||v(t)})(t,e)},null)),sa(wa,{onClick:()=>C(e)},He[e.type]),sa(wa,{onClick:()=>C(e)},e.code),sa(wa,{onClick:()=>C(e)},(t=e.date,new Date(t).toLocaleDateString())),sa(wa,{align:"right",onClick:()=>C(e)},We(e.amount)),sa(wa,{align:"right",onClick:()=>C(e)},We(e.price)),sa(wa,{align:"right",onClick:()=>C(e)},We(e.expenses)));var t})))),c>30&&c<l.length&&sa(ca,{margin:1},sa(ua,{onClick:()=>{u(l.length)}},"Exibir todas")),d&&sa(Da,{selectedOperation:d,operationChanged:b,dismissOperationEdition:h,assets:n},null))};const Ba=r.a.createElement,{Button:Fa,Grid:La}=s;var Ma=()=>{const{updatePosition:e,updatePortofolio:t}=ve();return Ba(La,{container:!0,spacing:1},Ba(La,{item:!0},Ba(Fa,{variant:"contained",onClick:()=>{e()},disabled:!e},"Atualizar Posição")),Ba(La,{item:!0},Ba(Fa,{variant:"contained",onClick:()=>{t()},disabled:!t},"Atualizar Portfólio")))};const Va=r.a.createElement,{Button:za}=s;var ja=[{name:"main",label:"Main",path:"/",hideFromMenu:!0,component:Ce,options:{exact:!0}},{name:"target-allocation",label:"Macro-Alocação",path:"/target-allocation",component:Bt},{name:"assets",label:"Meus Ativos",path:"/assets",component:ra},{name:"suggestedAllocation",label:"Novo Aporte",path:"/suggested-allocation",component:ht},{name:"operations",label:"Registro de Operações",path:"/operations",component:Ra},{name:"update-allocation",label:"Atualização do Portfólio",path:"/update-allocation",authorizedGroups:["admin"],component:Ma},{name:"upload-prices",label:"Upload Prices",path:"/upload-prices",authorizedGroups:["admin"],component:()=>{const{showMessage:e}=r.a.useContext(f),{invokeLambda:t}=r.a.useContext(F),a=r.a.useRef(),{updatePortofolio:o}=ve(),n=a=>{const n=a.target.result;let r;try{r=n.split(/\r\n|\n/).slice(1).map(e=>[...e.matchAll(/"[^"]*"|[^,]+/g)]).reduce((e,t)=>{const[a,o]=t.map(e=>e[0]).map(e=>e.replace(/^"(.*)"$/,"$1")).map(e=>e.replace(",","."));return e[a]=o,e},{})}catch(t){e("Não foi possível carregar o arquivo"),console.error("File loading failed",t)}r&&t("update_prices",{prices:r}).then(()=>{e("Preços atualizados com sucesso"),o()}).catch(t=>{e("Não foi possível atualizar os preços"),console.error("Prices update failed",t)})};return Va("form",{ref:a},Va("input",{id:"contained-button-file",accept:".csv",type:"file",style:{display:"none"},onChange:e=>{const t=new FileReader;t.onload=n,t.onloadend=()=>a.current.reset(),t.readAsText(e.target.files[0])},disabled:!t},null),Va("label",{htmlFor:"contained-button-file"},Va(za,{disabled:!t,variant:"contained",color:"primary",component:"span"},"Upload Preços Atualizados")))}},{name:"authentication",label:"Athentication",path:"/authentication/:authorization_code",hideFromMenu:!0,component:ke}];const $a=r.a.createElement,{HashRouter:Ua,Route:Wa,Switch:Ga}=window.ReactRouterDOM,{Toolbar:Ha}=s,Ka=({children:e})=>$a(d,null,$a(v,null,$a(I,{appConfig:o},$a(T,null,$a(D,null,$a(B,null,e))))));if(window.location.pathname===le){const e=new URLSearchParams(window.location.search);null!==e.get("auth-redirect")&&null!==e.get("code")&&window.history.replaceState({},"",`${le}#/authentication/${e.get("code")}`)}l.a.render($a(()=>{const[e,t]=r.a.useState(!1);return $a(Ka,null,$a(Ua,null,$a(J,{setDrawerOpen:t,routes:ja},null),$a(ie,{routes:ja,drawerOpen:e,setDrawerOpen:t}),$a(Ha,null,null),$a(Ga,null,ja.map(e=>$a(Wa,{key:e.name+"-route",path:e.path,...e.options},$a(e.component))))))},null,null),document.getElementById("app_container"))}]);